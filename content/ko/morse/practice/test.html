<!DOCType HTML>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:fb="http://ogp.me/ns/fb#" manifest="cache.manifest">
<head>
<meta http-equiv="content-type" content="text/html;charset=UTF-8" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="viewport" content="width=device-width" />
<title>QSO코흐법</title>
<link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.8/codemirror.css'>
<script>
window.console = window.console || function(t) {};
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.8/codemirror.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.8/mode/xml/xml.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.8/addon/selection/mark-selection.js'></script>
<script type="text/javascript">
/*! hangul-js 2019-12-10 */
!function(){"use strict";var r,d,g,l,t,e,h=["ㄱ",["ㄱ","ㄱ"],"ㄴ","ㄷ",["ㄷ","ㄷ"],"ㄹ","ㅁ","ㅂ",["ㅂ","ㅂ"],"ㅅ",["ㅅ","ㅅ"],"ㅇ","ㅈ",["ㅈ","ㅈ"],"ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"],p=["ㅏ","ㅐ","ㅑ",["ㅑ","ㅣ"],"ㅓ","ㅔ","ㅕ",["ㅕ","ㅣ"],"ㅗ",["ㅗ","ㅏ"],["ㅗ","ㅐ"],["ㅗ","ㅣ"],"ㅛ","ㅜ",["ㅜ","ㅓ"],["ㅜ","ㅔ"],["ㅜ","ㅣ"],"ㅠ","ㅡ",["ㅡ","ㅣ"],"ㅣ"],C=["","ㄱ",["ㄱ","ㄱ"],["ㄱ","ㅅ"],"ㄴ",["ㄴ","ㅈ"],["ㄴ","ㅎ"],"ㄷ","ㄹ",["ㄹ","ㄱ"],["ㄹ","ㅁ"],["ㄹ","ㅂ"],["ㄹ","ㅅ"],["ㄹ","ㅌ"],["ㄹ","ㅍ"],["ㄹ","ㅎ"],"ㅁ","ㅂ",["ㅂ","ㅅ"],"ㅅ",["ㅅ","ㅅ"],"ㅇ","ㅈ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"],A=44032;function n(n){for(var r=n.length,t={0:0},e=0;e<r;e++)n[e]&&(t[n[e].charCodeAt(0)]=e);return t}function o(n){for(var r,t,e=n.length,o={},i=0;i<e;i++)r=n[i][0].charCodeAt(0),t=n[i][1].charCodeAt(0),void 0===o[r]&&(o[r]={}),o[r][t]=n[i][2].charCodeAt(0);return o}function v(n){return void 0!==r[n]}function y(n){return void 0!==d[n]}function m(n){return void 0!==g[n]}function u(n){return void 0!==l[n]}function j(n){return 44032<=n&&n<=55203}function b(n,r){return!(!e[n]||!e[n][r])&&e[n][r]}function S(n,r){return!(!t[n]||!t[n][r])&&t[n][r]}r=n(["ㄱ","ㄲ","ㄳ","ㄴ","ㄵ","ㄶ","ㄷ","ㄸ","ㄹ","ㄺ","ㄻ","ㄼ","ㄽ","ㄾ","ㄿ","ㅀ","ㅁ","ㅂ","ㅃ","ㅄ","ㅅ","ㅆ","ㅇ","ㅈ","ㅉ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"]),d=n(["ㄱ","ㄲ","ㄴ","ㄷ","ㄸ","ㄹ","ㅁ","ㅂ","ㅃ","ㅅ","ㅆ","ㅇ","ㅈ","ㅉ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"]),g=n(["ㅏ","ㅐ","ㅑ","ㅒ","ㅓ","ㅔ","ㅕ","ㅖ","ㅗ","ㅘ","ㅙ","ㅚ","ㅛ","ㅜ","ㅝ","ㅞ","ㅟ","ㅠ","ㅡ","ㅢ","ㅣ"]),l=n(["","ㄱ","ㄲ","ㄳ","ㄴ","ㄵ","ㄶ","ㄷ","ㄹ","ㄺ","ㄻ","ㄼ","ㄽ","ㄾ","ㄿ","ㅀ","ㅁ","ㅂ","ㅄ","ㅅ","ㅆ","ㅇ","ㅈ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"]),t=o([["ㄱ","ㅅ","ㄳ"],["ㄴ","ㅈ","ㄵ"],["ㄴ","ㅎ","ㄶ"],["ㄹ","ㄱ","ㄺ"],["ㄹ","ㅁ","ㄻ"],["ㄹ","ㅂ","ㄼ"],["ㄹ","ㅅ","ㄽ"],["ㄹ","ㅌ","ㄾ"],["ㄹ","ㅍ","ㄿ"],["ㄹ","ㅎ","ㅀ"],["ㅂ","ㅅ","ㅄ"],["ㄱ","ㄱ","ㄲ"],["ㄷ","ㄷ","ㄸ"],["ㅂ","ㅂ","ㅃ"],["ㅅ","ㅅ","ㅆ"],["ㅈ","ㅈ","ㅉ"]]),e=o([["ㅗ","ㅏ","ㅘ"],["ㅗ","ㅐ","ㅙ"],["ㅗ","ㅣ","ㅚ"],["ㅜ","ㅓ","ㅝ"],["ㅜ","ㅔ","ㅞ"],["ㅜ","ㅣ","ㅟ"],["ㅡ","ㅣ","ㅢ"]]);function w(n,r){if(null===n)throw new Error("Arguments cannot be null");"object"==typeof n&&(n=n.join(""));for(var t,e,o,i,u,f=[],c=n.length,a=0;a<c;a++){var s=[];j(i=n.charCodeAt(a))?(e=((i-=A)-(o=i%28))/28%21,t=parseInt((i-o)/28/21),"object"==typeof h[t]?s=s.concat(h[t]):s.push(h[t]),"object"==typeof p[e]?s=s.concat(p[e]):s.push(p[e]),0<o&&("object"==typeof C[o]?s=s.concat(C[o]):s.push(C[o]))):v(i)?"string"==typeof(u=y(i)?h[d[i]]:C[l[i]])?s.push(u):s=s.concat(u):m(i)?"string"==typeof(u=p[g[i]])?s.push(u):s=s.concat(u):s.push(n.charAt(a)),r?f.push(s):f=f.concat(s)}return f}function i(n){return"string"!=typeof n?"":(n=w(n)).join("")}function f(c){"string"==typeof c&&(c=w(c));var n,r,a=[],t=c.length,e=0,s=-1,h=!1;function o(n){var r,t,e,o,i=0,u="";if(h=!1,!(n<s+1))for(var f=1;;f++){if(1===f){if(m(r=c[s+f].charCodeAt(0)))return s+f+1<=n&&m(t=c[s+f+1].charCodeAt(0))?a.push(String.fromCharCode(b(r,t))):a.push(c[s+f]),void(s=n);if(!y(r))return a.push(c[s+f]),void(s=n);u=c[s+f]}else if(2===f){if(y(t=c[s+f].charCodeAt(0)))return r=S(r,t),u=String.fromCharCode(r),a.push(u),void(s=n);u=String.fromCharCode(28*(21*d[r]+g[t])+A)}else 3===f?(b(t,e=c[s+f].charCodeAt(0))?t=b(t,e):i=e,u=String.fromCharCode(28*(21*d[r]+g[t])+l[i]+A)):4===f?(i=S(i,o=c[s+f].charCodeAt(0))?S(i,o):o,u=String.fromCharCode(28*(21*d[r]+g[t])+l[i]+A)):5===f&&(i=S(i,o=c[s+f].charCodeAt(0)),u=String.fromCharCode(28*(21*d[r]+g[t])+l[i]+A));if(n<=s+f)return a.push(u),void(s=n)}}for(var i=0;i<t;i++)y(n=c[i].charCodeAt(0))||m(n)||u(n)?(0===e?y(n)?e=1:m(n)&&(e=4):1==e?m(n)?e=2:S(r,n)?e=5:o(i-1):2==e?u(n)?e=3:m(n)?b(r,n)||(o(i-1),e=4):(o(i-1),e=1):3==e?u(n)?!h&&S(r,n)?h=!0:(o(i-1),e=1):y(n)?(o(i-1),e=1):m(n)&&(o(i-2),e=2):4==e?m(n)?b(r,n)?(o(i),e=0):o(i-1):(o(i-1),e=1):5==e&&(e=m(n)?(o(i-2),2):(o(i-1),1)),r=n):(o(i-1),o(i),e=0);return o(i-1),a.join("")}function c(n){this.string=n,this.disassembled=w(n).join("")}c.prototype.search=function(n){return w(n).join("").indexOf(this.disassembled)};var a={disassemble:w,d:w,disassembleToString:i,ds:i,assemble:f,a:f,search:function(n,r){var t=w(n).join(""),e=w(r).join("");return t.indexOf(e)},rangeSearch:function(n,r){var t,e=w(n).join(""),o=w(r).join(""),i=w(n,!0),u=new RegExp(o,"gi"),f=[];if(!r.length)return[];for(;t=u.exec(e);)f.push(t.index);return f.map(function(n){return[function(n){for(var r=0,t=0;r<i.length;++r)if(n<(t+=i[r].length))return r}(n),function(n){for(var r=0,t=0;r<i.length;++r)if(t+=i[r].length,n+o.length<=t)return r}(n)]})},Searcher:c,endsWithConsonant:function(n){"object"==typeof n&&(n=n.join(""));var r=n.charCodeAt(n.length-1);if(j(r)){if(0<(r-=A)%28)return!0}else if(v(r))return!0;return!1},endsWith:function(n,r){return w(n).pop()===r},isHangul:function(n){return"string"==typeof n&&(n=n.charCodeAt(0)),j(n)},isComplete:function(n){return"string"==typeof n&&(n=n.charCodeAt(0)),j(n)},isConsonant:function(n){return"string"==typeof n&&(n=n.charCodeAt(0)),v(n)},isVowel:function(n){return"string"==typeof n&&(n=n.charCodeAt(0)),m(n)},isCho:function(n){return"string"==typeof n&&(n=n.charCodeAt(0)),y(n)},isJong:function(n){return"string"==typeof n&&(n=n.charCodeAt(0)),u(n)},isHangulAll:function(n){if("string"!=typeof n)return!1;for(var r=0;r<n.length;r++)if(!j(n.charCodeAt(r)))return!1;return!0},isCompleteAll:function(n){if("string"!=typeof n)return!1;for(var r=0;r<n.length;r++)if(!j(n.charCodeAt(r)))return!1;return!0},isConsonantAll:function(n){if("string"!=typeof n)return!1;for(var r=0;r<n.length;r++)if(!v(n.charCodeAt(r)))return!1;return!0},isVowelAll:function(n){if("string"!=typeof n)return!1;for(var r=0;r<n.length;r++)if(!m(n.charCodeAt(r)))return!1;return!0},isChoAll:function(n){if("string"!=typeof n)return!1;for(var r=0;r<n.length;r++)if(!y(n.charCodeAt(r)))return!1;return!0},isJongAll:function(n){if("string"!=typeof n)return!1;for(var r=0;r<n.length;r++)if(!u(n.charCodeAt(r)))return!1;return!0}};"function"==typeof define&&define.amd?define(function(){return a}):"undefined"!=typeof module?module.exports=a:window.Hangul=a}();
</script>
<style>
body {
    background-color: white ;
    font-family: 'Helvetica', 'sans serif';
    font-size: medium;
	line-height: 1.5;
    min-width: 760px;
    margin: 0 auto;
}
.page {
    width: 90%;
    margin-left: auto;
    margin-right: auto;
    padding: 1em;
}
p {
    padding: 4px;
    background: white;
    color: black;
}
input {
    padding: 4px;
    border: 1px solid lightsalmon;
    transition: box-shadow 0.3s;
    background: lightyellow;
    border-radius: 5px;
    color: black;
    font-family: 'Helvetica', 'sans serif';
    font-size: large;
}

input:focus { 
    border: 1px solid teal;
    box-shadow: 0 0 5px 1px powderblue;
}
button {
    color: black;
    font-family: 'Helvetica', 'sans serif';
    font-size: large;
    font-weight: bold;
    margin-top: 6px;
}
#play {
    color: blue;
}
#stop {
    color: red;
}
#freq { 
    width: 3em;
}
#speed {
    width: 3em;
}
#volume {
    width: 3em;
}
textarea {
    width : 100%;
    height : auto;
    padding: 10px;
    border: 1px solid lightsalmon;
    transition: box-shadow 0.3s;
    background: lightyellow;
    border-radius: 5px;
    color: black;
    font-family: 'Helvetica', 'sans serif';
    font-size: x-large;
    font-weight: bold;
    line-height: 1.5;
}
#counter {
    float: right;
}
.font_medium {
    font-size : medium;
}
.setting {
    line-height: 2;
    margin-top: 0px;    
}
.setting_bold {
    font-weight: 600;
}
.setting_group {
    padding: 4px 0px 4px 10px;
    margin-right: 10px;
    border: 1px dotted teal;
    white-space: nowrap;
}
.setting_group_2 {
    margin-right: 10px;
    white-space: nowrap;
}
.sample_group > button {
    margin-top: 7px;
    margin-bottom: 4px;
}
::selection {
    background-color: rgba(255, 0, 0, 0.5);
}
.hidden_sample {
    display : none;
}

.CodeMirror {
    width : 100%;
    height : 12em;
    padding: 10px;
    border: 1px solid lightsalmon;
    transition: box-shadow 0.3s;
    background: lightyellow;
    border-radius: 5px;
    color: black;
    font-family: 'Helvetica', 'sans serif';
    font-size: x-large;
    font-weight: bold;
    line-height: 1.5;
    margin-top: 20px;
}
.CodeMirror-selected { background-color: rgba(255, 0, 0, 0.5); }
.CodeMirror-focused .CodeMirror-selected { background-color: rgba(255, 0, 0, 0.5); }
.hide_markText { background-color: black; }
.show_markText { background-color: inherit; }

.log_container_ditdah {
    width : 100%;
    height : 12px;
    overflow: hidden;
    padding: 10px;
    border: 1px solid lightsalmon;
    transition: box-shadow 0.3s;
    background: lightyellow;
    border-radius: 5px;
    color: black;
    font-family: 'monospace';
    font-size: small;
    white-space: nowrap;
    margin-top: 0px;
}
#ditdah {
    height:10px;
    float: right;
}
.ditdah_bar {
    background: green;
    height: 10px;
    display: inline-block;
}
.ditdah_gap {
    height: 10px;
    display: inline-block;
}
#keyer_setting {
    display: none;
    line-height: 2;
}
#connect {
    color: blue;
}
#disconnect {
    color: red;
}
#mp3 {
	display: inline-block;
	margin: auto;
	padding-left: 10px;
}
audio {
	height: 1em;
	margin-bottom: -3px;
}
</style>
</head>
<body>
<div class="page">
<h2>QSO 코흐법 (영문)</h2> 
<div class="setting">
    <span class="setting_group_2">
        <button id="play">PLAY</button>&nbsp;
        <button id="stop">STOP</button>
        <label id="make"></label>
        <label id="make_tze"></label>
        <!--span id="mp3"> </span>
        <a id="tze"></a-->
        </span>   

<span class="setting_group_2">
<span class="setting_bold">음색</span> <input type="number" id="freq" value="650" step="10" size="4" min="200" max="1200" /> Hz
&nbsp;
<span class="setting_bold">속도</span> <input type="number" id="speed" value="20" size="2" min="5" max="50" /> WPM
&nbsp;
<span class="setting_bold">음량</span> <input type="number" id="volume" value="100" size="3" min="1" max="100" step="1" /> %
</span>
<span class="setting_group">
<span class="setting_bold">부호간격</span> : 
<label><input type="radio" name="key" value="computer" checked /> 정상</label>&nbsp;
<label><input type="radio" name="key" value="space_1" /> 1></label>&nbsp;
<label><input type="radio" name="key" value="space_2" /> 2>></label>&nbsp;
<label><input type="radio" name="key" value="space_3" /> 3>>></label>&nbsp;
<label><input type="radio" name="key" value="space_4" /> 4>>>></label>&nbsp;
<label><input type="radio" name="key" value="space_5" /> 5>>>>></label>&nbsp;
<!--label><input type="radio" name="key" value="elmer" /> Small</label>
<label><input type="radio" name="key" value="farnsworth" /> Large</label>
<label><input type="radio" name="key" value="straightmed" /> Random - Medium</label>
<label><input type="radio" name="key" value="straightbad" /> Random - Bad</label>
<label><input type="radio" name="key" value="straightvbad" /> Random - Very Bad</label-->
</span>

&nbsp;&nbsp;&nbsp;

<span class="setting_group">
<span class="setting_bold">옵션</span> : 
<label id="selection_only" ></label>
<label id="highlight_slowly" ></label>
<label><input type="checkbox" id="hide_text" checked="checked" /> 글자숨기기</label>&nbsp;&nbsp;
<label><input type="checkbox" id="repeat" /> 연속반복</label>
<label id="flute"></label>
<label id="noise"></label>
<label id="fading"></label>&nbsp;
</span>
</div>

<!--div id="keyer_setting"-->
<!--span class="setting_bold">CW Keyer*</span> : -->
<label id="connect"></label>
<label id="disconnect"></label>
<!--&nbsp;
<(IC-7300,7610 : <span class="setting_bold">USB Keying(CW) - DTR</span>)
</span>
</div-->

<div>
<span class="sample_group">
<button style="background-color:rgb(240, 250, 200);" onClick="location.href='http://127.0.0.1:1313/morse/test-1.html'">&nbsp;1단계&nbsp;</button>&nbsp;
<button style="color:rgb(80, 80, 80);" onClick="location.href='http://127.0.0.1:1313/morse/test-1.html'">&nbsp;2단계&nbsp;</button>&nbsp;
<button style="color:rgb(80, 80, 80);" onClick="location.href='http://127.0.0.1:1313/morse/test-1.html'">&nbsp;3단계&nbsp;</button>&nbsp;
<button style="color:rgb(80, 80, 80);" onClick="location.href='http://127.0.0.1:1313/morse/test-1.html'">&nbsp;4단계&nbsp;</button>&nbsp;
<button style="color:rgb(80, 80, 80);" onClick="location.href='http://127.0.0.1:1313/morse/test-1.html'">&nbsp;5단계&nbsp;</button>&nbsp;
<button style="color:rgb(80, 80, 80);" onClick="location.href='http://127.0.0.1:1313/morse/test-1.html'">&nbsp;6단계&nbsp;</button>&nbsp;
<button style="color:rgb(80, 80, 80);" onClick="location.href='http://127.0.0.1:1313/morse/test-1.html'">&nbsp;7단계&nbsp;</button>&nbsp;
<button style="color:rgb(80, 80, 80);" onClick="location.href='http://127.0.0.1:1313/morse/test-1.html'">&nbsp;8단계&nbsp;</button>&nbsp;
<button style="color:rgb(80, 80, 80);" onClick="location.href='http://127.0.0.1:1313/morse/test-1.html'">&nbsp;9단계&nbsp;</button>&nbsp;
<button style="color:rgb(80, 80, 80);" onClick="location.href='http://127.0.0.1:1313/morse/test-1.html'">&nbsp;10단계&nbsp;</button>&nbsp;
<button style="color:rgb(80, 80, 80);" onClick="location.href='http://127.0.0.1:1313/morse/test-1.html'">&nbsp;11단계&nbsp;</button>&nbsp;
<button style="color:rgb(80, 80, 80);" onClick="location.href='http://127.0.0.1:1313/morse/test-1.html'">&nbsp;12단계&nbsp;</button>&nbsp;
<button style="color:rgb(80, 80, 80);" onClick="location.href='http://127.0.0.1:1313/morse/test-1.html'">&nbsp;13단계&nbsp;</button>&nbsp;
<button style="color:rgb(80, 80, 80);" onClick="location.href='http://127.0.0.1:1313/morse/test-1.html'">&nbsp;14단계&nbsp;</button>




<!-- keep the lines bleow -->
<label id="hangul_qso_1"></label>
<label id="user_qso"></label>
<label id="random_qso"></label>
<label id="hangul_syllable"></label>
</span>
</div>


<div class="log_container_ditdah"><span id="ditdah"></span></div>


<button id="sub_menu_1" style="background-color:rgb(240, 250, 200);">알파벳연습 (10wpm/1)</button>&nbsp;
<button id="sub_menu_2" style="background-color:rgb(240, 250, 200);">단어연습 1 (10wpm/2)</button>&nbsp;
<button id="sub_menu_3" style="background-color:rgb(240, 250, 200);">단어연습 2 (10wpm/2)</button>&nbsp;
<button id="sub_menu_4" style="background-color:rgb(240, 250, 200);">호출부호연습 (10wpm/3)</button>

<!--  hangul_txt_1         -->
<textarea id="hangul_txt_1" rows="10">

</textarea>
<div id="hangul_txt_1_caption"></div>


<!--  user_txt         -->
<textarea id="user_txt" rows="16" class="hidden_sample">

</textarea>
<div id="user_txt_caption" class="hidden_sample"></div>


<!--  random_txt         -->
<textarea id="random_txt" rows="16" class="hidden_sample">

</textarea>
<div id="random_txt_caption" class="hidden_sample">

<span class="setting_group">
    <span class="setting_bold"></span>
    <label><input type="radio" name="repeat_count" value="1" checked /></label>
    <label><input type="radio" name="repeat_count" value="2" /></label>
    <label><input type="radio" name="repeat_count" value="3" /></label>
</span>
    <label id="random_hl_callsigns"></label>
    <label id="random_ja_callsigns"></label>
    <label id="random_babv_callsigns"></label>
    <label id="random_hljababv_callsigns"></label>
    <label id="random_qso_elements"></label>
    <label id="random_qso_basic_elements"></label>
    <label id="random_stamp_qso"></label>
    <label id="random_hl_words"></label>
    <label id="random_hl_phrases"></label>
    <label id="random_kdn"></label>
    <label id="random_kdn_city"></label>
</div>


<!--  hangul_txt         -->
<textarea id="hangul_txt" rows="16" class="hidden_sample">

</textarea>
<div id="hangul_txt_caption" class="hidden_sample">

<label input type="checkbox" id="random" checked="checked" ></label>&nbsp;
<label input type="checkbox" id="extend" ></label>&nbsp;&nbsp;

<label id="hangul_initial_consonants"></label>
<label id="hangul_simple_vowels"></label>
<label id="hangul_simple_syllables"></label>
<label id="hangul_final_consonants"></label>
<label id="hangul_syllables"></label>
<label id="hangul_complex_vowels"></label>
<label id="hangul_complex_syllables"></label>
<label id="hangul_random_syllables"></label>
<label id="hangul_frequent_syllables"></label>
</div>


<button style="color:rgb(70, 70, 70);" onClick="location.href='/morse/practice'">&nbsp;홈페이지로 돌아가기&nbsp;</button>


<h3> ◆ 프로그램 정보</h3>
<span class="font_medium">
▶ 프로그램의 제작 : DS1TZE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CW Trainer - <a href="https://shingiru.github.io/hangul_cw_trainer.html" target="_blank">https://shingiru.github.io/hangul_cw_trainer.html</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;한글 CW Decoder - <a href="http://shingiru.github.io/hangul_cw_decoder.html" target="_blank">http://shingiru.github.io/hangul_cw_decoder.html</a><br />
<br />
▶ QSO코흐법을 위한 재구성 : HL5KY<br />
<br>
❤ 프로그램의 사용을 허용해 주신 DS1TZE님께 감사드립니다.
<br /><br />
</span>



</div>
</body>
<!--script>Mp3LameEncoderConfig = { memoryInitializerPrefixURL: "" };</script-->
<script src="Mp3LameEncoder.min.js"></script>
<script type="text/javascript">
(function(AudioContext) {
    AudioContext.prototype.createEffect = function() {
        var bufferSize = 4096;
        var node = this.createScriptProcessor(bufferSize, 1, 1);
        node.onaudioprocess = function(e) {
            const inputBuffer = e.inputBuffer;
            const outputBuffer = e.outputBuffer;

            // Loop through the output channels (in this case there is only one)
            for (let channel = 0; channel < outputBuffer.numberOfChannels; channel++) {
                const inputData = inputBuffer.getChannelData(channel);
                const outputData = outputBuffer.getChannelData(channel);

                // Loop through the 4096 samples
                for (let sample = 0; sample < inputBuffer.length; sample++) {
                    // make output equal to the same as the input
                    outputData[sample] = inputData[sample];

                    // add noise to each output sample
                    if (useNoise) outputData[sample] += ((Math.random() * 2) - 1) * 0.9; //  white noise. 0.2 noise strength 
                }
            }
        }
        return node;
    };
    
    AudioContext.prototype.createWhiteNoise = function(bufferSize) {
        bufferSize = bufferSize || 4096;
        var node = this.createScriptProcessor(bufferSize, 1, 1);
        node.onaudioprocess = function(e) {
            var output = e.outputBuffer.getChannelData(0);
            for (var i = 0; i < bufferSize; i++) {
                output[i] = Math.random() * 2 - 1;
            }
        }
        return node;
    };

    AudioContext.prototype.createPinkNoise = function(bufferSize) {
        bufferSize = bufferSize || 4096;
        var b0, b1, b2, b3, b4, b5, b6;
        b0 = b1 = b2 = b3 = b4 = b5 = b6 = 0.0;
        var node = this.createScriptProcessor(bufferSize, 1, 1);
        node.onaudioprocess = function(e) {
            var output = e.outputBuffer.getChannelData(0);
            for (var i = 0; i < bufferSize; i++) {
                var white = Math.random() * 2 - 1;
                b0 = 0.99886 * b0 + white * 0.0555179;
                b1 = 0.99332 * b1 + white * 0.0750759;
                b2 = 0.96900 * b2 + white * 0.1538520;
                b3 = 0.86650 * b3 + white * 0.3104856;
                b4 = 0.55000 * b4 + white * 0.5329522;
                b5 = -0.7616 * b5 - white * 0.0168980;
                output[i] = b0 + b1 + b2 + b3 + b4 + b5 + b6 + white * 0.5362;
                output[i] *= 0.11; // (roughly) compensate for gain
                b6 = white * 0.115926;
            }
        }
        return node;
    };

    AudioContext.prototype.createBrownNoise = function(bufferSize) {
        bufferSize = bufferSize || 4096;
        var lastOut = 0.0;
        var node = this.createScriptProcessor(bufferSize, 1, 1);
        node.onaudioprocess = function(e) {
            var output = e.outputBuffer.getChannelData(0);
            for (var i = 0; i < bufferSize; i++) {
                var white = Math.random() * 2 - 1;
                output[i] = (lastOut + (0.02 * white)) / 1.02;
                lastOut = output[i];
                output[i] *= 3.5; // (roughly) compensate for gain
            }
        }
        return node;
    };
})(window.AudioContext);

</script>
<script type="text/javascript">
MorseNode.prototype.MORSE = {
    "A": ".-",
    "B": "-...",
    "C": "-.-.",
    "D": "-..",
    "E": ".",
    "F": "..-.",
    "G": "--.",
    "H": "....",
    "I": "..",
    "J": ".---",
    "K": "-.-",
    "L": ".-..",
    "M": "--",
    "N": "-.",
    "O": "---",
    "P": ".--.",
    "Q": "--.-",
    "R": ".-.",
    "S": "...",
    "T": "-",
    "U": "..-",
    "V": "...-",
    "W": ".--",
    "X": "-..-",
    "Y": "-.--",
    "Z": "--..",

    "1": ".----",
    "2": "..---",
    "3": "...--",
    "4": "....-",
    "5": ".....",
    "6": "-....",
    "7": "--...",
    "8": "---..",
    "9": "----.",
    "0": "-----",
    
    ".": ".-.-.-",
    ",": "--..--",
    "?": "..--..",
    "/": "-..-.",
    "+": ".-.-.",
    "-": "-....-",
    "=": "-...-",
    ":": "---...",
    ";": "-.-.-.",
    "(": "-.--.",
    ")": "-.--.-",
    "'": ".----.",
    "\"": ".-..-.",
    "@": ".--.-.",
    
    "ㄱ": ".-..",
    "ㄴ": "..-.",
    "ㄷ": "-...",
    "ㄹ": "...-",
    "ㅁ": "--",
    "ㅂ": ".--",
    "ㅅ": "--.",
    "ㅇ": "-.-",
    "ㅈ": ".--.",
    "ㅊ": "-.-.",
    "ㅋ": "-..-",
    "ㅌ": "--..",
    "ㅍ": "---",
    "ㅎ": ".---",
    "ㅏ": ".",
    "ㅑ": "..",
    "ㅓ": "-",
    "ㅕ": "...",
    "ㅗ": ".-",
    "ㅛ": "-.",
    "ㅜ": "....",
    "ㅠ": ".-.",
    "ㅡ": "-..",
    "ㅣ": "..-",
    "ㅔ": "-.--",
    "ㅐ": "--.-",
    
    // for prosign
    "&" : ".-...",
    "Ŝ" : "...-.",
    // non-standard
    "[" : "-...-.-",
    "]" : "...-.-",
    "^" : "-.-.-",
    "※" : "........"
};

MorseNode.prototype.PROSIGN = {
    "<AR>" : "+",
    "<KN>" : "(",
    "<AS>" : "&",
    "<BT>" : "=",
    "<SN>" : "Ŝ",
    // non-standard
    "<BK>" : "[",
    "<SK>" : "]",
    "<VA>" : "]",
    "<KA>" : "^",
    "<HH>" : "※"
};

function MorseNode(ac, rate) {
    // ac is an audio context.
    this._oscillator = ac.createOscillator();
    this._gain = ac.createGain();

    this._gain.gain.value = 0;
    this._oscillator.type = 'sine';
    this._oscillator.frequency.value = 600;
    
    this._oscillator.connect(this._gain);
    this.key = 'computer';

    if ("undefined" == typeof rate)
        rate = 20;
    this._dot = 1.2 / rate; // formula from Wikipedia.

    this._oscillator.start(0);
	this._moved = 0;
}

MorseNode.prototype.connect = function(target) {
    return this._gain.connect(target);
}

MorseNode.prototype.timeMove = function(sec) {
	if (ac.currentTime + this._moved + sec < queue[0][0]) sec = queue[0][0] - ac.currentTime - this._moved;
	else if (ac.currentTime + this._moved + sec > queue[queue.length - 1][0]) sec = queue[queue.length - 1][0] - ac.currentTime - this._moved;
	this._moved += sec;
	
	console.log(sec);
	
	var i = 0;
	for (; i < queue.length; i++)
		if (queue[i][0] > ac.currentTime + this._moved) break;
	
	this._gain.disconnect(filter);
	this._oscillator.disconnect(this._gain);
	this._gain = ac.createGain();
	this._gain.gain.value = 0;
	this._oscillator.connect(this._gain);
	this._gain.connect(filter);
	
	for (; i < queue.length; i++)
		this._gain.gain.setValueAtTime(queue[i][1], queue[i][0] - this._moved);
	
	var min = timestamp[0];
	timestamp.forEach((el, idx, ary) => { ary[idx] = el - sec; });
}

MorseNode.prototype.dotfac = function(t) {
    switch (this.key) {
            // t is type of dotvalue. l=letter int. i=inter el. s=spaces .=dit -=dah 
        case 'computer':
            return 1;
		case 'straightmed': //i and . are rather too long than too short, s the inverse rest is random
            if (t=='.' || t=='i') return Math.random()*0.33+0.95;
            if (t=='s') return Math.random()*0.2+0.85;
            return Math.random()*0.3+0.85;
        case 'straightbad':
            if (t=='.' || t=='i') return Math.random()*0.6+0.8;
            if (t=='s') return Math.random()*0.4+0.7;
            return Math.random()*0.5+0.75;
        case 'straightvbad':
            if (t=='.' || t=='i') return Math.random()*1.6+0.8;
            if (t=='s') return Math.random()*0.85+0.4;
            return Math.random()*0.8+0.6;
        case 'space_1':
			if (t=='s') return 1.4;
            if (t=='l') return 1.4;
        case 'space_2':
			if (t=='s') return 2.2;
            if (t=='l') return 2.2;
        case 'space_3':
			if (t=='s') return 3;
            if (t=='l') return 3;
        case 'space_4':
			if (t=='s') return 4;
            if (t=='l') return 4;            
        case 'space_5':
			if (t=='s') return 5;
            if (t=='l') return 5;            
        case 'farnsworth': //uses farnsworth
            if (t=='s') return 6;
            if (t=='l') return 4;
        case 'elmer': //uses farnsworth
            if (t=='s') return 4;
            if (t=='l') return 1.5;
            return 1;
        }

}

var smoothingDuration = 0.004;  // 10ms is very soft, icom default 4ms;
MorseNode.prototype.playChar = function(queueOnly, t, c, v) {
    for (var i = 0; i < c.length; i++) {
        switch(c[i]) {
        case '.':
            if (!queueOnly) {
				this._gain.gain.setValueAtTime(0, t - smoothingDuration);
				this._gain.gain.linearRampToValueAtTime(1.0 * v, t);
			}
			enQueue(1.0 * v, t);
            t += this._dot * this.dotfac('.');
            if (!queueOnly) {
				this._gain.gain.setValueAtTime(1.0 * v, t - smoothingDuration);
				this._gain.gain.linearRampToValueAtTime(0.0, t);
			}
			enQueue(0.0, t)
            break;
        case '-':
            if (!queueOnly) {
				this._gain.gain.setValueAtTime(0, t - smoothingDuration);
				this._gain.gain.linearRampToValueAtTime(1.0 * v, t);
			}
			enQueue(1.0 * v, t);
            t += 3 * this._dot * this.dotfac('-');
            if (!queueOnly) {
				this._gain.gain.setValueAtTime(1.0 * v, t - smoothingDuration);
				this._gain.gain.linearRampToValueAtTime(0.0, t);
			}
			enQueue(0.0, t)
            break;
        }
        t += this._dot * this.dotfac('i');
    }
    return t;
}

var timestamp = [];
var queue = [];
function enQueue(v, t) {
	queue.push([t, v]);
}
var hasHangul = false;

MorseNode.prototype.playString = function(queueOnly, t, w, v, k, fade) {
    this.key = k;
    
    w = this.convertHangulAndProsign(w.toUpperCase());
    timestamp = [];
	queue = [];
	enQueue(0, 0);
	hasHangul = false;
    
    var start = t, fv = v;
    for (var n = 0; n < w.length; n++) {
        if (fade && (t - start) > 0) { // skip face effect during first 10s
            var pointOneSec = parseInt((t - start) * 10) % 150;
            if (pointOneSec < 75) fv = v * (100 - pointOneSec) * 0.01; // gradually goes down to the quarter volume for 7.5 sec
            else fv = v * (pointOneSec - 50) * 0.01; // gradually goes up to the normal volume for 7.5 sec
        }
        if (!highlightSlowly.checked) timestamp.push(t);
        var c = w[n];
        var hangul = (c.length > 1);
        for (var i = 0; i < c.length; i++) {
            if (c[i] == ' ' || c[i] == '\u00A0') {
                t += 4 * this._dot * this.dotfac('s'); // 3 dots gap already added after ending letter before
            }
            else if ("undefined" != typeof this.MORSE[c[i]]) {
                t = this.playChar(queueOnly, t, this.MORSE[c[i]], fv); // 1 gap after dit/dah
                t += 2 * this._dot * this.dotfac('l'); // with this 2 more gap, whole gap between letter is 3
            }
        }
        if (hangul) {
            t += (2+2) * this._dot * this.dotfac('l');
			hasHangul = true;
        }
        if (highlightSlowly.checked) timestamp.push(t);
    }
    timestamp.push(t);
    
    return t;
}

MorseNode.prototype.convertHangulAndProsign = function(w) {
    // convert prosign
    for (var key in this.PROSIGN) {
        w = w.replace(new RegExp(key.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g'), this.PROSIGN[key]);
    }
    return Hangul.disassemble(w, true);
}

MorseNode.prototype.getSpaceDelayInMills = function() {
    return 1000 * this._dot * (this.dotfac('i') + 2 * this.dotfac('l') + 4 * this.dotfac('s'));
}


var ac, filter, morse = null, vol = 1.0, cwPort = null, cwPortInitialized = false, cwPortOpen = false;

var ua = navigator.userAgent.toLowerCase();
var isIOS = (ua.indexOf("iphone") > -1 || ua.indexOf("ipad") > -1 || ua.indexOf("ipod") > -1);
var isAndroid = ua.indexOf("android") > -1;
var isMobile = (isIOS || isAndroid);

var freq = document.querySelector("#freq")
var wpm = document.querySelector("#speed");
var volume = document.querySelector("#volume");
var play = document.querySelector("#play");
var stop = document.querySelector("#stop");
var make = document.querySelector("#make");
var makeTze = document.querySelector("#make_tze");
var keyComputer = document.querySelector('input[name="key"][value="computer"]');
//var keyElmer = document.querySelector('input[name="key"][value="elmer"]');
//var keyFarnsworth = document.querySelector('input[name="key"][value="farnsworth"]');
var keySpace1 = document.querySelector('input[name="key"][value="space_1"]');
var keySpace2 = document.querySelector('input[name="key"][value="space_2"]');
var keySpace3 = document.querySelector('input[name="key"][value="space_3"]');
var keySpace4 = document.querySelector('input[name="key"][value="space_4"]');
var keySpace5 = document.querySelector('input[name="key"][value="space_5"]');
//var keyStraightMed = document.querySelector('input[name="key"][value="straightmed"]');
//var keyStraightBad = document.querySelector('input[name="key"][value="straightbad"]');
//var keyStraightVBad = document.querySelector('input[name="key"][value="straightvbad"]');
var flute = document.querySelector("#flute");
var noise = document.querySelector("#noise");
var fading = document.querySelector("#fading");
var selectionOnly = document.querySelector("#selection_only");
var highlightSlowly = document.querySelector("#highlight_slowly");
var hideText = document.querySelector("#hide_text");
var repeat = document.querySelector("#repeat");
var connect = document.querySelector("#connect");
var disconnect = document.querySelector("#disconnect");

connect.addEventListener("click", async () => {
	if (isAndroid || isIOS) {
        alert("Mobile devices don't support serial communication.");
        return;
    }
	
	var options = { baudRate: 115200, flowControl: 'hardware' };
	if (!cwPortInitialized) {
		navigator.serial.requestPort().then(async (port) => {
			cwPort = port;
			await cwPort.open(options); // DTR should be set on the radio
			await cwPort.setSignals({dataTerminalReady:false});
			toggleConnectButtons(true);
			cwPortInitialized = true;
			cwPortOpen = true;
		}).catch((e) => {
		});
	} else if (!cwPortOpen) {
		await cwPort.open(options);
		await cwPort.setSignals({dataTerminalReady:false});
		toggleConnectButtons(true);
		cwPortOpen = true;
	}
}, false);
disconnect.addEventListener("click", async () => {
	if (cwPort != null && cwPortOpen) {
		await cwPort.setSignals({dataTerminalReady:false});
		await cwPort.close();
		toggleConnectButtons(false);
		cwPortOpen = false;
	}
}, false);
function toggleConnectButtons(connected) {
	connect.replaceChild(document.createTextNode(connected ? "CONNECTED!" : "CONNECT"), connect.firstChild);
	disconnect.replaceChild(document.createTextNode(connected ? "DISCONNECT" : "DISCONNECTED!"), disconnect.firstChild);
}

function renewMorse() {
    ac = (ac || new AudioContext());
    if (ac.state != "running") ac.resume();

    if (morse != null) morse._oscillator.stop(0);
    morse = new MorseNode(ac, parseInt(wpm.value));
    
    filter = ac.createBiquadFilter(); 
    filter.frequency.value = freq.value;
    filter.Q.value = 0;
    
    morse.connect(filter);
    filter.connect(ac.destination);
    
    morse._dot = 1.2 / parseFloat(wpm.value);
    morse._oscillator.frequency.value = parseInt(freq.value);
}
var stopped = true, paused = false;
var cm, doc, txtValue, cursorFrom = null, cursorTo, cursorTempFrom, cursorTempTo, cursorTempEnd, highlightStart, hightlightEnd, repeatId = -1, marker = null;
var DELAY_AMOUNT = 1; // seconds
stop.onclick = function() {
    try { clearTimeout(repeatId); repeatId = -1;}
    catch (e) {}
    
    renewMorse();
    if (noiseNode) noiseGain.disconnect();
    morse.playString(false, ac.currentTime, " ", vol, document.querySelector('input[name="key"]:checked').value, fading.checked);
    doc.readOnly = false;
    
    addDitdah(false, 1); // this also manage cw port
	
	clearMarker();
	cm.setOption("extraKeys", {});
    cm.focus();
    if (cursorFrom != null) {
        doc.setSelection(cursorFrom, cursorTo);
        cm.refresh();
    }
    stopped = true;

    play.replaceChild(document.createTextNode("PLAY"), play.firstChild);
    paused = false;
}
var bufferSource = noiseNode = noiseGain = null;
play.onclick = function() {
    if (paused) {
        play.replaceChild(document.createTextNode("PAUSE"), play.firstChild);
        paused = false;
        ac.resume();
        return;
    } else if (stopped == false && repeatId == -1) {
        play.replaceChild(document.createTextNode("RESUME"), play.firstChild);
        paused = true;
        ac.suspend();
        return;
    } else {
        play.replaceChild(document.createTextNode("PAUSE"), play.firstChild);
        paused = false;
    }
    
    try { clearTimeout(repeatId); repeatId = -1;}
    catch (e) {}

    renewMorse();
    
    if (noise.checked) {
        if (bufferSource == null) {
            bufferSource = ac.createBufferSource();
            noiseNode = ac.createWhiteNoise();
            bufferSource.connect(noiseNode);
            noiseGain = ac.createGain();
            noiseNode.connect(noiseGain);
            bufferSource.start(0);
        }
        noiseGain.gain.value = vol * 0.5;
        noiseGain.connect(ac.destination);
    }
    
    clearMarker();
    cm.focus();
    if (cursorFrom != null && !stopped) {
        doc.setSelection(cursorFrom, cursorTo);
        cm.refresh();
        previousTime = 0;
    } else clearDitdah();
    
    cursorFrom = doc.getCursor("from");
    cursorTo = doc.getCursor("to");
    txtValue = doc.getSelection();
    
    var lastLine = doc.lastLine();
    var lastLineLength = doc.getLine(lastLine).length;
    
    if (selectionOnly.checked) {
        if (txtValue == '') { // when no selection  
            if (cursorTo.line == lastLine && cursorTo.ch == lastLineLength) { // when caret is at the end, start from first letter
                txtValue = doc.getValue();
                cursorTempFrom = {line: 0, ch: 0};
                cursorTempTo = {line: 0, ch: 0};
                cursorTempEnd = {line: lastLine, ch: lastLineLength};
            } else { // when caret is in the middle, start from caret position
                doc.setSelection(cursorFrom, {line: lastLine, ch: lastLineLength});
                txtValue = doc.getSelection();
                doc.setSelection(cursorFrom, cursorTo);
                cursorTempFrom = {line: cursorFrom.line, ch: cursorFrom.ch};
                cursorTempTo = {line: cursorFrom.line, ch: cursorFrom.ch};
                cursorTempEnd = {line: lastLine, ch: lastLineLength}
            }
        } else { // play selection
            cursorTempFrom = {line: cursorFrom.line, ch: cursorFrom.ch};
            cursorTempTo = {line: cursorFrom.line, ch: cursorFrom.ch};
            cursorTempEnd = {line: cursorTo.line, ch: cursorTo.ch};
        }
    } else {
        txtValue = doc.getValue();
        cursorTempFrom = {line: 0, ch: 0};
        cursorTempTo = {line: 0, ch: 0};
        cursorTempEnd = {line: lastLine, ch: lastLineLength};
    }
    highlightStart = highlightEnd = 0;
    
    morse.playString(false, ac.currentTime + DELAY_AMOUNT, 
        txtValue, 
        vol * (noise.checked ? 0.5 : 1), 
        document.querySelector('input[name="key"]:checked').value,
        fading.checked);
    
    doc.readOnly = true;

    window.localStorage.setItem('user_txt', userTxt.CodeMirror.doc.getValue());
    
    stopped = false;
    
    cm.focus();
    if (highlightSlowly.checked) doc.setSelection(cursorTempFrom, cursorTempFrom);
    if (hideText.checked) setMarker(cursorTempFrom, cursorTempEnd);
	cm.setOption("extraKeys", { Left: function() {rollback(true);}, Right: function() {rollback(false);} });
    cm.focus();
    
	/*if (selectionOnly.checked == false) repeatId = setTimeout(highlight, DELAY_AMOUNT * 1000);
    else */highlight();
}

function delayedRepeat() {
    if (!stopped) play.click();
}
var previousTime = 0;
function highlight() {
    if (timestamp.length == 0) {
        stop.click();
        if (repeat.checked) {
            stopped = false;
            repeatId = setTimeout(delayedRepeat, 2 * morse.getSpaceDelayInMills());
        }
        return;
    }
    
    if (previousTime != 0) addDitdah(morse._gain.gain.value > 0, parseInt((ac.currentTime - previousTime)*1000));
    previousTime = ac.currentTime;
    
    if (ac.currentTime > timestamp[0]) {
        timestamp.shift();
        
        highlightStart = highlightEnd;
        cursorTempFrom.line = cursorTempTo.line, cursorTempFrom.ch = cursorTempTo.ch;
        
        if (txtValue[highlightStart] == '<' && txtValue.length > highlightStart + 3 
            && !!morse.PROSIGN[txtValue.substring(highlightStart, highlightStart + 4).toUpperCase()]) {
            highlightEnd = highlightStart + 4;
            cursorTempTo.ch = cursorTempFrom.ch + 4;
        } else if (txtValue.length > highlightStart) {
            highlightEnd = highlightStart + 1;
            if (txtValue[highlightStart] == '\n') {
                cursorTempTo.line++;
                cursorTempTo.ch = 0;
            } else {
                cursorTempTo.ch = cursorTempFrom.ch + 1;
            }
        }

        if (!stopped && cursorTempTo.ch != 0) {
            cm.focus();
            doc.setSelection(cursorTempFrom, cursorTempTo);
                
            if (hideText.checked) {
                setMarker(cursorTempTo, cursorTempEnd);
            }
            
            cm.refresh();
        }
    }
    
    if (!stopped) setTimeout(highlight, 7); // 7ms is based on the sampling rate
}
function setMarker(start, end) {
    clearMarker();
    marker = cm.markText(start, end, {className: "hide_markText"});
}
function clearMarker() {
    if (marker == null) return;
    
    marker.clear();
    marker = null;
}

function rollback(back) {
	if (stopped || morse == null) return;
	morse.timeMove(back ? -5 : 5);
}

var MP3_SAMPLE_RATE = 16000; //(isMobile ? 16000 : 44100);
var MP3_BIT_RATE = 32; //(isMobile ? 32 : 128);
var MP3_SAMPLE_BLOCK_SIZE = 1152;
make.onclick = function() {
	stop.click();
	
	var mp3 = document.querySelector("#mp3");
	mp3.replaceChild(document.createTextNode(" Generating.. Please wait a few minutes."), mp3.firstChild);
	
	setTimeout(makeMp3, 1);
};
async function makeMp3() {
	morse.playString(true, DELAY_AMOUNT, 
		doc.getValue(), 
		vol, 
		document.querySelector('input[name="key"]:checked').value,
		fading.checked);
		
	var encoder = new Mp3LameEncoder(MP3_SAMPLE_RATE, MP3_BIT_RATE);
	var duration = makeBufferAndEncode(encoder, noise.checked, vol);
	saveRecording(encoder.finish(), duration);
}
function makeBufferAndEncode(encoder, withNoise, noiseVolume) {
	if (queue.length == 0) return;
	
	var queueLen = queue.length;
	var duration = Math.ceil(queue[queueLen - 1][0]);
	var sampleLen = parseInt((duration + DELAY_AMOUNT) * MP3_SAMPLE_RATE);
	//sampleLen = Math.ceil(sampleLen / MP3_SAMPLE_BLOCK_SIZE) * MP3_SAMPLE_BLOCK_SIZE;
	var buffer = new Float32Array(MP3_SAMPLE_BLOCK_SIZE);
	var angular_frequency = freq.value * 2 * Math.PI;
	var angular_frequency_factor = angular_frequency / MP3_SAMPLE_RATE;
	var rising_step = rising_start_volume = rising_end_volume = 0;
	var rising_steps = MP3_SAMPLE_RATE * smoothingDuration;
	
	var queueIndex = 0, sampleIndex = 0, volume = 0.0, nextVolume = 0.0;
	for ( ; queueIndex < queueLen; queueIndex++) {
		var item = queue[queueIndex];
		if (item[1] > 0) {
			sampleIndex = parseInt(item[0] * MP3_SAMPLE_RATE);
			nextVolume = item[1];
			break;
		}
	}
	for (var i = 0, j = 0; i < sampleLen; i++, j++) {
		if (j == MP3_SAMPLE_BLOCK_SIZE) {
			encoder.encode([buffer, buffer]);
			buffer.fill(0);
			j = 0;
		}
		
		if (i > sampleIndex) {
			if (queueIndex < queueLen - 1) queueIndex++;
			sampleIndex = parseInt(queue[queueIndex][0] * MP3_SAMPLE_RATE);
			if (volume != nextVolume) {
				rising_step = rising_steps;
				rising_start_volume = volume;
				rising_end_volume = nextVolume;
			}
			volume = nextVolume;
			nextVolume = queue[queueIndex][1];
		}
		
		if (rising_step-- > 0) {
			if (rising_start_volume > rising_end_volume) volume = rising_end_volume + (rising_start_volume - rising_end_volume) * rising_step / rising_steps;
			else volume = rising_start_volume + (rising_end_volume - rising_start_volume) * (rising_steps - rising_step) / rising_steps;
		}
		buffer[j] = Math.sin(i * angular_frequency_factor) * volume; // https://teropa.info/blog/2016/08/04/sine-waves.html
		if (withNoise) buffer[j] = buffer[j] * Math.cos(0.5*0.5*Math.PI) + ((Math.random() * 2) - 1) * noiseVolume * Math.cos(0.5*0.5*Math.PI); // half + half
	}
	encoder.encode([buffer, buffer]);
	
	return duration;
}
function saveRecording(blob, duration) {
	var url = URL.createObjectURL(blob);
	
	var sound = document.createElement("AUDIO");
	sound.controls = 'controls';
	sound.src = url;
	sound.type = 'audio/mpeg';
	
	var link = document.createElement("A");
	link.href = url;
	link.appendChild(document.createTextNode("[MP3 DOWN]"));
	var filename = (new Date()).toISOString().replace(/[\-\:T]/ig, '').substring(0, 12);
	filename += "_" + wpm.value + "wpm_" + parseInt(duration + 2) + "s_" + MP3_BIT_RATE + "kbps";
	link.download = filename + ".mp3";
	
	var div = document.createElement("DIV");
	div.appendChild(sound);
	div.appendChild(link);
	
	var mp3 = document.querySelector("#mp3");
	mp3.replaceChild(div, mp3.firstChild);
}

makeTze.onclick = function() {
	stop.click();
	morse.playString(true, DELAY_AMOUNT, 
		doc.getValue(), 
		1.0, 
		document.querySelector('input[name="key"]:checked').value,
		false);
	queue.push([queue[queue.length - 1][0] + 1, 0]);
	saveTzeFile();
}
function saveTzeFile() {
	var data = packTzeFile();
	var blob = new Blob([JSON.stringify(data)], {type:"application/json"});
	var url = URL.createObjectURL(blob);
	
	var link = document.createElement("A");
	link.href = url;
	link.appendChild(document.createTextNode("[1TZE DOWN]"));
	var filename = (new Date()).toISOString().replace(/[\-\:T]/ig, '').substring(0, 14);
	link.download = filename + ".tze";
	
	var anchor = document.querySelector("#tze");
    link.id = anchor.id;
    anchor.parentNode.replaceChild(link, anchor);
}
function packTzeFile() {
	return {
		version: 1,
		creatdAt: (new Date()).toISOString(),
		wpm: parseInt(wpm.value),
		hangul: hasHangul,
		queue: queue.map(x => [x[0].toFixed(3),parseInt(x[1])])
	};
}

var ditdah = document.querySelector("#ditdah");
var last = false, lastWidth = 0;
function addDitdah(bar, len) {
    if (bar == last && ditdah.childNodes.length > 0 && lastWidth < 8192) {
        var span = ditdah.lastChild;
        lastWidth += len;
        span.style.width = (parseInt(lastWidth) >> 3) + "px";
        return;
    }
    var span = document.createElement("SPAN");
    span.className = bar ? "ditdah_bar" : "ditdah_gap";  
    span.style.width = parseInt(len >> 3) + "px";
    ditdah.appendChild(span);
    if (ditdah.childNodes.length > 256) ditdah.removeChild(ditdah.firstChild);
    last = bar;
    lastWidth = len;
	
	if (cwPortOpen) cwPort.setSignals({dataTerminalReady:bar});
}
function clearDitdah() {
    var len = ditdah.childNodes.length;
    for (var i = 0; i < len; i++) ditdah.removeChild(ditdah.firstChild);
    
    previousTime = 0;
}

freq.onchange = function() {
    window.localStorage.setItem('freq', freq.value);
}
wpm.onchange = function() {
    window.localStorage.setItem('wpm', wpm.value);
}
volume.onchange = function() {
    vol = volume.value / 100.0;
    window.localStorage.setItem('volume', volume.value);
}
keyComputer.onchange = function() {
    window.localStorage.setItem('key', document.querySelector('input[name="key"]:checked').value);
}
/*keyElmer.onchange = function() {
    window.localStorage.setItem('key', document.querySelector('input[name="key"]:checked').value);
}
keyFarnsworth.onchange = function() {
    window.localStorage.setItem('key', document.querySelector('input[name="key"]:checked').value);
}*/
keySpace1.onchange = function() {
    window.localStorage.setItem('key', document.querySelector('input[name="key"]:checked').value);
}
keySpace2.onchange = function() {
    window.localStorage.setItem('key', document.querySelector('input[name="key"]:checked').value);
}
keySpace3.onchange = function() {
    window.localStorage.setItem('key', document.querySelector('input[name="key"]:checked').value);
}
keySpace4.onchange = function() {
    window.localStorage.setItem('key', document.querySelector('input[name="key"]:checked').value);
}
keySpace5.onchange = function() {
    window.localStorage.setItem('key', document.querySelector('input[name="key"]:checked').value);
}
/*keyStraightMed.onchange = function() {
    window.localStorage.setItem('key', document.querySelector('input[name="key"]:checked').value);
}
keyStraightBad.onchange = function() {
    window.localStorage.setItem('key', document.querySelector('input[name="key"]:checked').value);
}
keyStraightVBad.onchange = function() {
    window.localStorage.setItem('key', document.querySelector('input[name="key"]:checked').value);
}*/
flute.onchange = function() {
	smoothingDuration = flute.checked ? 0.02 : 0.004;
    window.localStorage.setItem('flute', flute.checked);
}
noise.onchange = function() {
    window.localStorage.setItem('noise', noise.checked);
}
fading.onchange = function() {
    window.localStorage.setItem('fading', fading.checked);
}
selectionOnly.onchange = function() {
    window.localStorage.setItem('selection_only', selectionOnly.checked);
}
highlightSlowly.onchange = function() {
    window.localStorage.setItem('highlight_slowly', highlightSlowly.checked);
}
hideText.onchange = function() {
    window.localStorage.setItem('hide_text', hideText.checked);
}
repeat.onchange = function() {
    window.localStorage.setItem('repeat', repeat.checked);
}
window.addEventListener('DOMContentLoaded', function() {
    try {
        if (window.localStorage.getItem('freq')) freq.value = parseInt(window.localStorage.getItem('freq'));
        if (window.localStorage.getItem('wpm')) wpm.value = parseInt(window.localStorage.getItem('wpm'));
        if (window.localStorage.getItem('volume')) volume.value = parseInt(window.localStorage.getItem('volume'));
        vol = volume.value / 100.0;
        if (window.localStorage.getItem('flute')) flute.checked = window.localStorage.getItem('flute') == 'true';
		smoothingDuration = flute.checked ? 0.02 : 0.004;
        if (window.localStorage.getItem('noise')) noise.checked = window.localStorage.getItem('noise') == 'true';
        if (window.localStorage.getItem('fading')) fading.checked = window.localStorage.getItem('fading') == 'true';
        if (window.localStorage.getItem('selection_only')) selectionOnly.checked = window.localStorage.getItem('selection_only') == 'true';
        if (window.localStorage.getItem('highlight_slowly')) highlightSlowly.checked = window.localStorage.getItem('highlight_slowly') == 'true';       
        if (window.localStorage.getItem('hide_text')) hideText.checked = window.localStorage.getItem('hide_text') == 'true';
        if (window.localStorage.getItem('repeat')) repeat.checked = window.localStorage.getItem('repeat') == 'true';
        if (window.localStorage.getItem('key')) document.querySelector('input[name="key"][value="'+window.localStorage.getItem('key')+'"]').checked = true;
        if (window.localStorage.getItem('user_txt')) userTxt.CodeMirror.doc.setValue(window.localStorage.getItem('user_txt'));
        if (window.localStorage.getItem('qso_sample')) changeQsoSample(window.localStorage.getItem('qso_sample'));
        else changeQsoSample("hangul_txt_1");
		if (!isAndroid && !isIOS) document.querySelector("#keyer_setting").style.display = "inline";
    } catch (e) {
    }
}, true);

function makeEditor(textArea, display) {
    var editor = CodeMirror(function(el) {
        el.id = textArea.id;
        el.className = el.className + " " + textArea.className;
        textArea.parentNode.replaceChild(el, textArea);
    }, {value: textArea.value, mode: "xml", lineWrapping: true, styleSelectedText: true
		//, extraKeys: { Left: function() {rollback(true);}, Right: function() {rollback(false);} }
	});
}
makeEditor(document.querySelector("#hangul_txt_1"));
makeEditor(document.querySelector("#user_txt"));
makeEditor(document.querySelector("#random_txt"));
makeEditor(document.querySelector("#hangul_txt"));
var txt = document.querySelector("#hangul_txt_1");
var userTxt = document.querySelector("#user_txt");

var hangulQso1 = document.querySelector("#hangul_qso_1");
var userQso = document.querySelector("#user_qso");
var randomQso = document.querySelector("#random_qso");
var hangulSyllable = document.querySelector("#hangul_syllable");


var randomHLCallsigns = document.querySelector("#random_hl_callsigns");
var randomJACallsigns = document.querySelector("#random_ja_callsigns");
var randomBABVCallsigns = document.querySelector("#random_babv_callsigns");
var randomHLJABABVCallsigns = document.querySelector("#random_hljababv_callsigns");
var randomQSOElements = document.querySelector("#random_qso_elements");
var randomQSOBasicElements = document.querySelector("#random_qso_basic_elements");
var randomStampQSO = document.querySelector("#random_stamp_qso");
var randomHLWords = document.querySelector("#random_hl_words");
var randomHLPhrases = document.querySelector("#random_hl_phrases");
var randomKDN = document.querySelector("#random_kdn");
var randomKDNCity = document.querySelector("#random_kdn_city");

var hangulInitialConsonants = document.querySelector("#hangul_initial_consonants");
var hangulSimpleVowels = document.querySelector("#hangul_simple_vowels");
var hangulSimpleSyllables = document.querySelector("#hangul_simple_syllables");
var hangulFinalConsonants = document.querySelector("#hangul_final_consonants");
var hangulSyllables = document.querySelector("#hangul_syllables");
var hangulComplexVowels = document.querySelector("#hangul_complex_vowels");
var hangulComplexSyllables = document.querySelector("#hangul_complex_syllables");
var hangulRandomSyllables = document.querySelector("#hangul_random_syllables");
var hangulFrequentSyllables = document.querySelector("#hangul_frequent_syllables");


var SubMenu1 = document.querySelector("#sub_menu_1");
var SubMenu2 = document.querySelector("#sub_menu_2");
var SubMenu3 = document.querySelector("#sub_menu_3");
var SubMenu4 = document.querySelector("#sub_menu_4");

SubMenu1.onclick = function() {
    stop.click();
    var QSO_ELEMENTS = [
        "d", "e",
    ];
    var repeated = [], repeatCount = getRepeatCount();
    for (var n = 0; n < 70; n++) {
        QSO_ELEMENTS.sort(() => Math.random() - 0.5);
        for (var element of QSO_ELEMENTS)
            repeated.push(Array(repeatCount).fill(element).join(""));
    }
    doc.setValue(repeated.join(""));
}

SubMenu2.onclick = function() {
    stop.click();
    QSO_BASIC_ELEMENTS = [
        "CQ", "DE", "PSE", "K", "<AR>",
        "GM", "GA", "GE", "DR", "OM",
        "TNX", "FER", "CALL", "<BT>",
        "ES", "UR", "RST", "IS", "599", "5NN",
        "HR", "OP", "NAME",
        "HW?",
        "HPE", "CUAGN", "GL", "GB", "73", "TU",
        "RR", "OK", "FB", "<BK>",
        "<KN>", "<VA>"
    ];
    var repeated = [], repeatCount = getRepeatCount();
    for (var n = 0; n < 10; n++) {
        QSO_BASIC_ELEMENTS.sort(() => Math.random() - 0.5);
        for (var element of QSO_BASIC_ELEMENTS)
            repeated.push(Array(repeatCount).fill(element).join(" "));
    }
    doc.setValue(repeated.join("   "));
}

SubMenu3.onclick = function() {
    stop.click();
    QSO_WORDS = [
        /*"안녕하세요", "예", "신호", "599", "5NN",
        "오엠님", "말씀", "잘", "수신", "입니다",
        "고맙습니다", "오늘", "교신", "한글",
        "전신", "대단히", "그동안", "저는", "여기는", "이곳은",
        "패이딩", "운영자", "드립니다",
        "다음", "주말", "즐거운", "저녁", "또",
        "오랜만에", "이곳", "뵙겠습니다", "종료합니다", "이만"*/
        "안녕","신호","오엠","말씀","수신","오늘","교신","한글","전신","여기","이곳","운영","다음","주말","저녁","종료","이만",
        "가게","가격","가구","가방","가수","가슴","가요","가위","가을","가족","간식","간장","갈비","갈색","감기","감동","감자","개인","거기","거리","거실","거울","건물","게임","겨울","결과","경기","경주","경찰","경치","경험","계단","계란","계절","계획","고기","고모","고장","고추","고향","골목","골프","공간","공기","공연","공원","공짜","공책","공항","과거","과일","과자","과학","관계","관심","광고","교수","교실","교통","교회","구두","구름","구월","국내","국립","국수","국어","국적","국제","군인","규칙","그거","그것","그곳","그날","그때","그램","그릇","그림","그분","그쪽","극장","근처","금연","기간","기름","기분","기사","기사","기온","기자","기차","기침","기타","김밥","김치","꽃집",
        "나라","나무","나이","나중","나흘","낚시","날씨","날짜","남녀","남미","남산","남자","남쪽","남편","내과","내년","내용","내일","냄비","냄새","냉면","노래","노트","녹색","녹차","농구","누구","누나","눈물","뉴스","뉴욕","느낌","능력",
        "다리","다리","다음","단어","단점","달러","달력","담배","답장","당근","당신","대학","대화","대회","덕분","도로","도시","도움","도쿄","독서","독일","동네","동물","동생","동안","동양","동전","동쪽","돼지","된장","두부","듣기","등산","딸기","떡국",

    ];
    var repeated = [], repeatCount = getRepeatCount();
    for (var n = 0; n < 1 ; n++) {
        QSO_WORDS.sort(() => Math.random() - 0.5);
        for (var word of QSO_WORDS)
            repeated.push(Array(repeatCount).fill(word).join("  "));
    }
    doc.setValue(repeated.join("   "));
}
SubMenu4.onclick = function() {
    stop.click();
    var QSO_PHRASES = [
        "안녕하세요?",
        "반갑습니다.",
        "예,",
        "오엠님",
        "말씀 잘 수신했습니다.",
        "신호는 599 5NN 입니다.",
        "오늘 교신 고맙습니다.",
        "잘 지내셨나요?",
        "그동안 잘 지내셨는지요?",
        "저는 용인, 용인 에 사는 김대성, 김대성 입니다.",
        "여기는 고양, 고양 이고 운영자는 최영일, 최영일 입니다.",
        "이곳은 성남, 성남 이고 저는 최병태, 최병태 입니다.",
        "이름은 배태원, 배태원 이고 경기광주, 경기광주 에서 신호 드리고 있습니다.",
        "안녕히계세요.",
        "다음에 또 뵙겠습니다.",
        "한글 전신 교신 대단히 감사합니다.",
        "평안한 저녁 되세요.",
        "오랜만에 뵙습니다.",
        "신호 받아주셔서 고맙습니다."
    ];
    var repeated = [];
    for (var n = 0; n < 3; n++) {
        QSO_PHRASES.sort(() => Math.random() - 0.5);
        for (var phrase of QSO_PHRASES)
            repeated.push(phrase);
    }
    doc.setValue(repeated.join("    "));
}


function changeQsoSample(newTxtId) {
    var newTxt = document.querySelector("#" + newTxtId);
    //if (txt == newTxt) return;

    var txtCaption = document.querySelector("#" + txt.id + "_caption");
    var newTxtCaption = document.querySelector("#" + newTxtId + "_caption");
    if (!txtCaption || !newTxtCaption) return;
    
    if (!stopped) stop.click();
    cursorFrom = null;
    
    txt.style.display = "none";
    txtCaption.style.display = "none";
    
    txt = newTxt;
    txtCaption = newTxtCaption;
    
    txt.style.display = "block";
    txtCaption.style.display = "block";
    
    txt.classList.toggle('active');
    cm = txt.CodeMirror;
    doc = cm.doc;
    cm.refresh();

    window.localStorage.setItem('qso_sample', newTxtId);
    window.localStorage.setItem('user_txt', userTxt.CodeMirror.doc.getValue());
}
hangulQso1.onclick = function() {
    changeQsoSample("hangul_txt_1");
}
userQso.onclick = function() {
    changeQsoSample("user_txt");
}
randomQso.onclick = function() {
    changeQsoSample("random_txt");
}
hangulSyllable.onclick = function() {
    changeQsoSample("hangul_txt");
}

var NUM_RANDOM_CALLSIGNS = 200;
function generateSuffix(length) {
    var ALPHABET = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
    var result = ALPHABET[Math.floor(Math.random() * ALPHABET.length)];
    for (var i = 1; i < length; i++)
        result += ALPHABET[Math.floor(Math.random() * ALPHABET.length)];
    return result;
}
function getRepeatCount() {
    return parseInt(document.querySelector('input[name="repeat_count"]:checked').value);
}
function generateHLCallsigns(count, repeatCount) {
    var callsigns = [];
    var PREFIX = [
        "HL1", "HL2", "HL3", "HL4", "HL5",
        "DS1", "DS2", "DS3", "DS4", "DS5",
        "6K2", "6K5", "6L5"
        ];
    for (var i = 0; i < count; i++) {
        var prefix = PREFIX[Math.floor(Math.random() * PREFIX.length)];
        var suffixLength = (prefix.startsWith("HL") ? (Math.random() > 0.2 ? 3 : 2) : 3);
        var callsign = prefix + generateSuffix(suffixLength);
        callsigns.push(Array(repeatCount).fill(callsign).join(" "));
    }
    return callsigns;
}
randomHLCallsigns.onclick = function() {
    stop.click();
    doc.setValue(generateHLCallsigns(NUM_RANDOM_CALLSIGNS, getRepeatCount()).join("   "));
}
function generateJACallsigns(count, repeatCount) {
    var callsigns = [];
    var PREFIX = [];
    var PRE_PREFIX = ["A", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S"].map(x => "J" + x);
    PRE_PREFIX.push("7J", "8J", "8N");
    for (var i = 0; i < 10; i++)
        for (var pre of PRE_PREFIX)
            PREFIX.push(pre + i);
    for (var i = 0; i < count; i++) {
        var prefix = PREFIX[Math.floor(Math.random() * PREFIX.length)];
        var callsign = prefix + generateSuffix(3);
        callsigns.push(Array(repeatCount).fill(callsign).join(" "));
    }
    return callsigns;
}
randomJACallsigns.onclick = function() {
    stop.click();
    doc.setValue(generateJACallsigns(NUM_RANDOM_CALLSIGNS, getRepeatCount()).join("   "));
}
function generateBABVCallsigns(count, repeatCount) {
    var callsigns = [];
    var PREFIX = [];
    var PRE_PREFIX = ["A", "D", "G", "T", "Y", "Z", "V"].map(x => "B" + x);
    for (var i = 0; i < 10; i++)
        for (var pre of PRE_PREFIX)
            PREFIX.push(pre + i);
    for (var i = 0; i < count; i++) {
        var prefix = PREFIX[Math.floor(Math.random() * PREFIX.length)];
        var callsign = prefix + generateSuffix(3);
        callsigns.push(Array(repeatCount).fill(callsign).join(" "));
    }
    return callsigns;
}
randomBABVCallsigns.onclick = function() {
    stop.click();
    doc.setValue(generateBABVCallsigns(NUM_RANDOM_CALLSIGNS, getRepeatCount()).join("   "));
}
randomHLJABABVCallsigns.onclick = function() {
    stop.click();
    var callsigns = generateHLCallsigns(NUM_RANDOM_CALLSIGNS / 2, 1);
    callsigns = callsigns.concat(generateJACallsigns(NUM_RANDOM_CALLSIGNS / 4, 1));
    callsigns = callsigns.concat(generateBABVCallsigns(NUM_RANDOM_CALLSIGNS / 4, 1));
    callsigns.sort(() => Math.random() - 0.5);
    var repeated = [], repeatCount = getRepeatCount();
    for (var callsign of callsigns)
        repeated.push(Array(repeatCount).fill(callsign).join(" "));
    doc.setValue(repeated.join("   "));
}

randomQSOElements.onclick = function() {
    stop.click();
    var QSO_ELEMENTS = [
        "DE", "GM", "GA", "GE", "DR", "OM", "TNX", "TKS", "FER", "CALL", "<BT>",
        "ES", "UR", "RST", "RPRT", "RPT", "IS", "599", "5NN", "579", "57N", "559", "55N",
        "HR", "OP", "NAME", "QTH", "KDN", "HW", "HW?", "CPI", "CPY",
        "QSO", "CU", "AGN", "CUAGN", "HOPE", "HPE", "QSL", "VIA", "BURO",
        "DX", "GL", "GB", "GUD", "73", "88", "PSE", "CQ", "QRL", "QRZ",
        "CFM", "SRI", "TU", "VY", "QRS", "QRP", "QRM", "QSB", "TEST",
        "OK", "FB", "BK", "<BK>", "RR", "ALL", "RIG", "PWR", "ANT", "WX", "TEMP",
        "K", "<KN>", "<AR>", "<VA>", "<AS>", "?"
    ];
    var repeated = [], repeatCount = getRepeatCount();
    for (var n = 0; n < 5; n++) {
        QSO_ELEMENTS.sort(() => Math.random() - 0.5);
        for (var element of QSO_ELEMENTS)
            repeated.push(Array(repeatCount).fill(element).join(" "));
    }
    doc.setValue(repeated.join("   "));
}
randomQSOBasicElements.onclick = function() {
    stop.click();
    QSO_BASIC_ELEMENTS = [
        "CQ", "DE", "PSE", "K", "<AR>",
        "GM", "GA", "GE", "DR", "OM",
        "TNX", "FER", "CALL", "<BT>",
        "ES", "UR", "RST", "IS", "599", "5NN",
        "HR", "OP", "NAME",
        "HW?",
        "HPE", "CUAGN", "GL", "GB", "73", "TU",
        "RR", "OK", "FB", "<BK>",
        "<KN>", "<VA>"
    ];
    var repeated = [], repeatCount = getRepeatCount();
    for (var n = 0; n < 10; n++) {
        QSO_BASIC_ELEMENTS.sort(() => Math.random() - 0.5);
        for (var element of QSO_BASIC_ELEMENTS)
            repeated.push(Array(repeatCount).fill(element).join(" "));
    }
    doc.setValue(repeated.join("   "));
}
randomStampQSO.onclick = function() {
    stop.click();
    GREETINGS = [
        "GM DR OM",
        "GA DR OM",
        "GE DR OM"
    ];
    THANKS = [
        "TNX FER CALL",
        "TKS FER CALL",
        "TNX FER RPRT",
        "TNX FER FB RPRT",
        "TKS FER RPRT",
    ];
    RSTS = [
        "UR RST 599 5NN",
        "UR 599 5NN",
        "UR RST IS 599 5NN",
    ];
    NAMES = [
        "HR OP IS KIM KIM",
        "HR OP CHOI CHOI",
        "OP HR IS KIM KIM",
        "OP OP CHOI CHOI",
        "OP IS KIM KIM",
        "MY NAME IS PARK PARK", 
        "NAME IS KIM KIM",
        "NAME NAME PARK PARK"
    ];
    FINALS = [
        "CUAGN 73 TU EE",
        "HPE CUAGN 73 <VA>",
        "73 TU <VA> EE",
        "HW? <BK>",
        "HW CPI? <BK>",
        "OK? <BK>",
        "<BK>",
        "73 TU TU <VA> EE"
    ];
    
    var qsos = [];
    for (var n = 0; n < 10; n++) {
        var greeting = GREETINGS[Math.floor(Math.random() * GREETINGS.length)];
        var thank = THANKS[Math.floor(Math.random() * THANKS.length)];
        var rst = RSTS[Math.floor(Math.random() * RSTS.length)];
        var name = NAMES[Math.floor(Math.random() * NAMES.length)];
        var final = FINALS[Math.floor(Math.random() * FINALS.length)];

        var qso = (Math.random() > 0.5 ? "  " : "  ") + greeting;
        qso += (Math.random() > 0.5 ? (Math.random() > 0.5 ? " " : " <BT> ") + thank : "");
        qso += (Math.random() > 0.5 ? " ES " : " <BT> ") + rst;
        qso += (name.startsWith("NAME") ? " <BT> " : (Math.random() > 0.5 ? " ES " : " <BT> ")) + name;
        qso += (final.startsWith("<BK>") ? " " : " <BT> ") + final;
        qsos.push(qso);
    }
    doc.setValue(qsos.join("   \n"));
}
randomHLWords.onclick = function() {
    stop.click();
    QSO_WORDS = [
        /*"안녕하세요", "예", "신호", "599", "5NN",
        "오엠님", "말씀", "잘", "수신", "입니다",
        "고맙습니다", "오늘", "교신", "한글",
        "전신", "대단히", "그동안", "저는", "여기는", "이곳은",
        "패이딩", "운영자", "드립니다",
        "다음", "주말", "즐거운", "저녁", "또",
        "오랜만에", "이곳", "뵙겠습니다", "종료합니다", "이만"*/
        "안녕","신호","오엠","말씀","수신","오늘","교신","한글","전신","여기","이곳","운영","다음","주말","저녁","종료","이만",
        "가게","가격","가구","가방","가수","가슴","가요","가위","가을","가족","간식","간장","갈비","갈색","감기","감동","감자","개인","거기","거리","거실","거울","건물","게임","겨울","결과","경기","경주","경찰","경치","경험","계단","계란","계절","계획","고기","고모","고장","고추","고향","골목","골프","공간","공기","공연","공원","공짜","공책","공항","과거","과일","과자","과학","관계","관심","광고","교수","교실","교통","교회","구두","구름","구월","국내","국립","국수","국어","국적","국제","군인","규칙","그거","그것","그곳","그날","그때","그램","그릇","그림","그분","그쪽","극장","근처","금연","기간","기름","기분","기사","기사","기온","기자","기차","기침","기타","김밥","김치","꽃집",
        "나라","나무","나이","나중","나흘","낚시","날씨","날짜","남녀","남미","남산","남자","남쪽","남편","내과","내년","내용","내일","냄비","냄새","냉면","노래","노트","녹색","녹차","농구","누구","누나","눈물","뉴스","뉴욕","느낌","능력",
        "다리","다리","다음","단어","단점","달러","달력","담배","답장","당근","당신","대학","대화","대회","덕분","도로","도시","도움","도쿄","독서","독일","동네","동물","동생","동안","동양","동전","동쪽","돼지","된장","두부","듣기","등산","딸기","떡국",
        "라면","로션",
        "마늘","마음","만두","만화","매일","매주","맥주","머리","머리","메뉴","메모","며칠","면도","명절","모양","모임","모자","목적","몸살","몽골","무료","무릎","무엇","무역","무용","문장","문제","문화","물건","미국","미래","미술",
        "바다","바람","바지","박수","반지","반찬","발음","발표","방법","방송","방학","배구","배달","배우","배탈","버스","번호","벚꽃","병원","볼펜","봉지","봉투","부모","부부","부산","부엌","부인","부탁","북쪽","비누","비밀","빌딩","빨래","빵집",
        "사고","사과","사람","사물","사원","사월","사이","사장","사전","사진","사촌","사탕","사흘","산책","삼월","삼촌","상자","상처","상품","새벽","새우","색깔","생선","생신","생일","생활","샴푸","서류","서양","서울","서점","서쪽","선배","선수","설날","설탕","성격","성함","세계","센터","소리","소설","소식","소파","소포","소풍","손님","송이","수건","수도","수박","수업","수영","수저","수첩","수학","숙제","순서","스키","습관","시간","시계","시골","시내","시디","시민","시설","시외","시월","시작","시장","시청","시험","식당","식사","식탁","신문","신발","실수","쓰기",
        "아기","아내","아들","아래","아빠","아이","아침","아침","악기","안경","야구","야채","약국","약사","약속","양말","양복","양식","양파","어깨","어디","어른","언니","얼굴","얼마","얼음","엄마","여권","여기","여름","여자","여행","역사","연세","연필","연휴","열쇠","열차","엽서","영국","영상","영어","영하","영화","예약","옛날","오리","오빠","오월","오이","오전","오후","올해","옷장","외국","왼쪽","요금","요리","요일","요즘","우리","우산","우유","우표","월급","월세","웬일","위치","유럽","유리","유월","유학","유행","은행","음식","음악","의미","의사","의자","이거","이것","이곳","이름","이모","이번","이분","이사","이월","이유","이쪽","이틀","인구","인기","인도","인삼","인상","인천","인형","일기","일본","일식","일월","읽기","입구","입학",
        "자기","자료","자리","자신","자연","자유","작년","잔치","잡지","장갑","장마","장미","장소","장점","재료","재킷","저거","저것","저곳","저기","저녁","저녁","저분","저쪽","저희","전공","전화","점수","점심","점심","점원","점퍼","정도","정문","정보","제목","제일","조카","종로","종류","종이","종일","주말","주변","주부","주사","주소","주스","주위","주인","중국","중식","중심","증세","지갑","지도","지방","지하","직업","직원","직장","찌개",
        "창문","채소","책상","책장","처음","최고","추석","추억","축구","축제","출구","출장","취미","치과","치마","치약","친구","친척","칠월","칠판","침대","칫솔",
        "카드","카레","카페","커피","코트","코피","콜라","콧물","크기",
        "탁구","태국","태풍","택시","통장","특징",
        "파티","팔월","패션","편지","평일","포도","포장","표현","피자","필름","필통",
        "하늘","하루","하숙","학교","학기","학년","학생","학원","한강","한국","한글","한번","한복","한식","한자","할인","합격","해외","햇빛","행복","행사","허리","현금","현재","형제","호주","호텔","혼자","홍차","화가","환자","회사","회색","회의","후배","휴가","휴일","휴지","흰색"
    ];
    var repeated = [], repeatCount = getRepeatCount();
    for (var n = 0; n < 1 /* 5 */; n++) {
        QSO_WORDS.sort(() => Math.random() - 0.5);
        QSO_WORDS.sort(() => Math.random() - 0.5);
        QSO_WORDS.sort(() => Math.random() - 0.5);
        QSO_WORDS.sort(() => Math.random() - 0.5);
        QSO_WORDS.sort(() => Math.random() - 0.5);
        for (var word of QSO_WORDS)
            repeated.push(Array(repeatCount).fill(word).join("  "));
    }
    doc.setValue(repeated.join("   "));
}
randomHLPhrases.onclick = function() {
    stop.click();
    var QSO_PHRASES = [
        "안녕하세요?",
        "반갑습니다.",
        "예,",
        "오엠님",
        "말씀 잘 수신했습니다.",
        "신호는 599 5NN 입니다.",
        "오늘 교신 고맙습니다.",
        "잘 지내셨나요?",
        "그동안 잘 지내셨는지요?",
        "저는 용인, 용인 에 사는 김대성, 김대성 입니다.",
        "여기는 고양, 고양 이고 운영자는 최영일, 최영일 입니다.",
        "이곳은 성남, 성남 이고 저는 최병태, 최병태 입니다.",
        "이름은 배태원, 배태원 이고 경기광주, 경기광주 에서 신호 드리고 있습니다.",
        "안녕히계세요.",
        "다음에 또 뵙겠습니다.",
        "한글 전신 교신 대단히 감사합니다.",
        "평안한 저녁 되세요.",
        "오랜만에 뵙습니다.",
        "신호 받아주셔서 고맙습니다."
    ];
    var repeated = [];
    for (var n = 0; n < 3; n++) {
        QSO_PHRASES.sort(() => Math.random() - 0.5);
        for (var phrase of QSO_PHRASES)
            repeated.push(phrase);
    }
    doc.setValue(repeated.join("    "));
}
randomKDN.onclick = function() {
    stop.click();
    var KDNs = [
        "A11","A12","A13","A14","A15","A16","A17","A18","A19","A20","A21","A22","A23","A24","A25","A26","A27","A28","A29","A30","A31","A32","A33","A34","A35",
        "B11","B12","B13","B14","B15","B16","B17","B18","B19","B20","B21","B22","B23","B24","B25","B26",
        "C01","C03","C04","C05","C06","C07","C08","C010","C011","C012","C013","C014","C015","C016","C017","C018","C020","C021","C022","C023","C024","C025","C026","C027","C028","C029","C030","C031","C20","C21","C23",
        "D01","D02","D03","D04","D05","D06","D07","D12","D13","D15","D16","D17","D20","D21","D22","D23","D24","D25",
        "E01","E02","E03","E11","E12","E13","E14","E15","E16","E17","E20","E21",
        "F02","F03","F06","F07","F08","F09","F010","F011","F19","F20","F21","F23","F24","F25","F26",
        "G01","G02","G06","G07","G08","G09","G11","G15","G16","G18","G19","G21","G22","G23",
        "H02","H03","H04","H05","H09","H12","H13","H14","H15","H19","H20","H21","H23","H24","H25","H26","H27","H28","H29","H30","H31","H32",
        "K02","K03","K04","K05","K06","K07","K08","K09","K011","K012","K12","K13","K15","K16","K20","K22","K23","K25","K28","K31","K32","K33","K34",
        "L02","L07","L08","L09","L011","L012","L013","L014","L14","L18","L19","L21","L23","L24","L25","L26","L27","L28",
        "M01","M02",
        "N01","N02","N03","N05","N06","N07","N08","N09","N010","N011",
        "P01","P02","P03","P04","P05","P06","P07","P08",
        "Q01","Q02","Q03","Q04","Q05",
        "R01","R02","R03","R04","R05",
        "S01","S02","S03","S04","S05",
        "T01",
        "IS01","IS02","IS03","IS04","IS05"
    ];
    var repeated = [], repeatCount = getRepeatCount();
    for (var n = 0; n < 1; n++) {
        KDNs.sort(() => Math.random() - 0.5);
        KDNs.sort(() => Math.random() - 0.5);
        KDNs.sort(() => Math.random() - 0.5);
        KDNs.sort(() => Math.random() - 0.5);
        KDNs.sort(() => Math.random() - 0.5);
        for (var kdn of KDNs)
            repeated.push(Array(repeatCount).fill(kdn).join(" "));
    }
    doc.setValue(repeated.join("   "));
}
randomKDNCity.onclick = function() {
    stop.click();
    var KDNCities = [
        "서울 종로","서울 중구","서울 성동","서울 동대문","서울 성북","서울 서대문","서울 마포","서울 용산","서울 영등포","서울 관악","서울 도봉","서울 강남","서울 강서","서울 은평","서울 동작","서울 구로","서울 강동","서울 중랑","서울 노원","서울 서초","서울 양천","서울 송파","서울 금천","서울 광진","서울 강북",
        "부산 동구","부산 중구","부산 서구","부산 영도","부산 부산진","부산 동래","부산 남구","부산 북구","부산 해운대","부산 사하","부산 금정","부산 강서","부산 연제","부산 수영","부산 사상","부산 기장",
    ];
    var repeated = [], repeatCount = getRepeatCount();
    for (var n = 0; n < 1; n++) {
        KDNCities.sort(() => Math.random() - 0.5);
        KDNCities.sort(() => Math.random() - 0.5);
        KDNCities.sort(() => Math.random() - 0.5);
        KDNCities.sort(() => Math.random() - 0.5);
        KDNCities.sort(() => Math.random() - 0.5);
        for (var city of KDNCities)
            repeated.push(Array(repeatCount).fill(city).join("  "));
    }
    doc.setValue(repeated.join("   "));
}

function isKSX1001(letter) {
    var ksx1001 = "가각간갇갈갉갊감갑값갓갔강갖갗같갚갛개객갠갤갬갭갯갰갱갸갹갼걀걋걍걔걘걜거걱건걷걸걺검겁것겄겅겆겉겊겋게겐겔겜겝겟겠겡겨격겪견겯결겸겹겻겼경곁계곈곌곕곗고곡곤곧골곪곬곯곰곱곳공곶과곽관괄괆괌괍괏광괘괜괠괩괬괭괴괵괸괼굄굅굇굉교굔굘굡굣구국군굳굴굵굶굻굼굽굿궁궂궈궉권궐궜궝궤궷귀귁귄귈귐귑귓규균귤그극근귿글긁금급긋긍긔기긱긴긷길긺김깁깃깅깆깊까깍깎깐깔깖깜깝깟깠깡깥깨깩깬깰깸깹깻깼깽꺄꺅꺌꺼꺽꺾껀껄껌껍껏껐껑께껙껜껨껫껭껴껸껼꼇꼈꼍꼐꼬꼭꼰꼲꼴꼼꼽꼿꽁꽂꽃꽈꽉꽐꽜꽝꽤꽥꽹꾀꾄꾈꾐꾑꾕꾜꾸꾹꾼꿀꿇꿈꿉꿋꿍꿎꿔꿜꿨꿩꿰꿱꿴꿸뀀뀁뀄뀌뀐뀔뀜뀝뀨끄끅끈끊끌끎끓끔끕끗끙끝끼끽낀낄낌낍낏낑나낙낚난낟날낡낢남납낫났낭낮낯낱낳내낵낸낼냄냅냇냈냉냐냑냔냘냠냥너넉넋넌널넒넓넘넙넛넜넝넣네넥넨넬넴넵넷넸넹녀녁년녈념녑녔녕녘녜녠노녹논놀놂놈놉놋농높놓놔놘놜놨뇌뇐뇔뇜뇝뇟뇨뇩뇬뇰뇹뇻뇽누눅눈눋눌눔눕눗눙눠눴눼뉘뉜뉠뉨뉩뉴뉵뉼늄늅늉느늑는늘늙늚늠늡늣능늦늪늬늰늴니닉닌닐닒님닙닛닝닢다닥닦단닫달닭닮닯닳담답닷닸당닺닻닿대댁댄댈댐댑댓댔댕댜더덕덖던덛덜덞덟덤덥덧덩덫덮데덱덴델뎀뎁뎃뎄뎅뎌뎐뎔뎠뎡뎨뎬도독돈돋돌돎돐돔돕돗동돛돝돠돤돨돼됐되된될됨됩됫됴두둑둔둘둠둡둣둥둬뒀뒈뒝뒤뒨뒬뒵뒷뒹듀듄듈듐듕드득든듣들듦듬듭듯등듸디딕딘딛딜딤딥딧딨딩딪따딱딴딸땀땁땃땄땅땋때땍땐땔땜땝땟땠땡떠떡떤떨떪떫떰떱떳떴떵떻떼떽뗀뗄뗌뗍뗏뗐뗑뗘뗬또똑똔똘똥똬똴뙈뙤뙨뚜뚝뚠뚤뚫뚬뚱뛔뛰뛴뛸뜀뜁뜅뜨뜩뜬뜯뜰뜸뜹뜻띄띈띌띔띕띠띤띨띰띱띳띵라락란랄람랍랏랐랑랒랖랗래랙랜랠램랩랫랬랭랴략랸럇량러럭런럴럼럽럿렀렁렇레렉렌렐렘렙렛렝려력련렬렴렵렷렸령례롄롑롓로록론롤롬롭롯롱롸롼뢍뢨뢰뢴뢸룀룁룃룅료룐룔룝룟룡루룩룬룰룸룹룻룽뤄뤘뤠뤼뤽륀륄륌륏륑류륙륜률륨륩륫륭르륵른를름릅릇릉릊릍릎리릭린릴림립릿링마막만많맏말맑맒맘맙맛망맞맡맣매맥맨맬맴맵맷맸맹맺먀먁먈먕머먹먼멀멂멈멉멋멍멎멓메멕멘멜멤멥멧멨멩며멱면멸몃몄명몇몌모목몫몬몰몲몸몹못몽뫄뫈뫘뫙뫼묀묄묍묏묑묘묜묠묩묫무묵묶문묻물묽묾뭄뭅뭇뭉뭍뭏뭐뭔뭘뭡뭣뭬뮈뮌뮐뮤뮨뮬뮴뮷므믄믈믐믓미믹민믿밀밂밈밉밋밌밍및밑바박밖밗반받발밝밞밟밤밥밧방밭배백밴밸뱀뱁뱃뱄뱅뱉뱌뱍뱐뱝버벅번벋벌벎범법벗벙벚베벡벤벧벨벰벱벳벴벵벼벽변별볍볏볐병볕볘볜보복볶본볼봄봅봇봉봐봔봤봬뵀뵈뵉뵌뵐뵘뵙뵤뵨부북분붇불붉붊붐붑붓붕붙붚붜붤붰붸뷔뷕뷘뷜뷩뷰뷴뷸븀븃븅브븍븐블븜븝븟비빅빈빌빎빔빕빗빙빚빛빠빡빤빨빪빰빱빳빴빵빻빼빽뺀뺄뺌뺍뺏뺐뺑뺘뺙뺨뻐뻑뻔뻗뻘뻠뻣뻤뻥뻬뼁뼈뼉뼘뼙뼛뼜뼝뽀뽁뽄뽈뽐뽑뽕뾔뾰뿅뿌뿍뿐뿔뿜뿟뿡쀼쁑쁘쁜쁠쁨쁩삐삑삔삘삠삡삣삥사삭삯산삳살삵삶삼삽삿샀상샅새색샌샐샘샙샛샜생샤샥샨샬샴샵샷샹섀섄섈섐섕서석섞섟선섣설섦섧섬섭섯섰성섶세섹센셀셈셉셋셌셍셔셕션셜셤셥셧셨셩셰셴셸솅소속솎손솔솖솜솝솟송솥솨솩솬솰솽쇄쇈쇌쇔쇗쇘쇠쇤쇨쇰쇱쇳쇼쇽숀숄숌숍숏숑수숙순숟술숨숩숫숭숯숱숲숴쉈쉐쉑쉔쉘쉠쉥쉬쉭쉰쉴쉼쉽쉿슁슈슉슐슘슛슝스슥슨슬슭슴습슷승시식신싣실싫심십싯싱싶싸싹싻싼쌀쌈쌉쌌쌍쌓쌔쌕쌘쌜쌤쌥쌨쌩썅써썩썬썰썲썸썹썼썽쎄쎈쎌쏀쏘쏙쏜쏟쏠쏢쏨쏩쏭쏴쏵쏸쐈쐐쐤쐬쐰쐴쐼쐽쑈쑤쑥쑨쑬쑴쑵쑹쒀쒔쒜쒸쒼쓩쓰쓱쓴쓸쓺쓿씀씁씌씐씔씜씨씩씬씰씸씹씻씽아악안앉않알앍앎앓암압앗았앙앝앞애액앤앨앰앱앳앴앵야약얀얄얇얌얍얏양얕얗얘얜얠얩어억언얹얻얼얽얾엄업없엇었엉엊엌엎에엑엔엘엠엡엣엥여역엮연열엶엷염엽엾엿였영옅옆옇예옌옐옘옙옛옜오옥온올옭옮옰옳옴옵옷옹옻와왁완왈왐왑왓왔왕왜왝왠왬왯왱외왹왼욀욈욉욋욍요욕욘욜욤욥욧용우욱운울욹욺움웁웃웅워웍원월웜웝웠웡웨웩웬웰웸웹웽위윅윈윌윔윕윗윙유육윤율윰윱윳융윷으윽은을읊음읍읏응읒읓읔읕읖읗의읜읠읨읫이익인일읽읾잃임입잇있잉잊잎자작잔잖잗잘잚잠잡잣잤장잦재잭잰잴잼잽잿쟀쟁쟈쟉쟌쟎쟐쟘쟝쟤쟨쟬저적전절젊점접젓정젖제젝젠젤젬젭젯젱져젼졀졈졉졌졍졔조족존졸졺좀좁좃종좆좇좋좌좍좔좝좟좡좨좼좽죄죈죌죔죕죗죙죠죡죤죵주죽준줄줅줆줌줍줏중줘줬줴쥐쥑쥔쥘쥠쥡쥣쥬쥰쥴쥼즈즉즌즐즘즙즛증지직진짇질짊짐집짓징짖짙짚짜짝짠짢짤짧짬짭짯짰짱째짹짼쨀쨈쨉쨋쨌쨍쨔쨘쨩쩌쩍쩐쩔쩜쩝쩟쩠쩡쩨쩽쪄쪘쪼쪽쫀쫄쫌쫍쫏쫑쫓쫘쫙쫠쫬쫴쬈쬐쬔쬘쬠쬡쭁쭈쭉쭌쭐쭘쭙쭝쭤쭸쭹쮜쮸쯔쯤쯧쯩찌찍찐찔찜찝찡찢찧차착찬찮찰참찹찻찼창찾채책챈챌챔챕챗챘챙챠챤챦챨챰챵처척천철첨첩첫첬청체첵첸첼쳄쳅쳇쳉쳐쳔쳤쳬쳰촁초촉촌촐촘촙촛총촤촨촬촹최쵠쵤쵬쵭쵯쵱쵸춈추축춘출춤춥춧충춰췄췌췐취췬췰췸췹췻췽츄츈츌츔츙츠측츤츨츰츱츳층치칙친칟칠칡침칩칫칭카칵칸칼캄캅캇캉캐캑캔캘캠캡캣캤캥캬캭컁커컥컨컫컬컴컵컷컸컹케켁켄켈켐켑켓켕켜켠켤켬켭켯켰켱켸코콕콘콜콤콥콧콩콰콱콴콸쾀쾅쾌쾡쾨쾰쿄쿠쿡쿤쿨쿰쿱쿳쿵쿼퀀퀄퀑퀘퀭퀴퀵퀸퀼큄큅큇큉큐큔큘큠크큭큰클큼큽킁키킥킨킬킴킵킷킹타탁탄탈탉탐탑탓탔탕태택탠탤탬탭탯탰탱탸턍터턱턴털턺텀텁텃텄텅테텍텐텔템텝텟텡텨텬텼톄톈토톡톤톨톰톱톳통톺톼퇀퇘퇴퇸툇툉툐투툭툰툴툼툽툿퉁퉈퉜퉤튀튁튄튈튐튑튕튜튠튤튬튱트특튼튿틀틂틈틉틋틔틘틜틤틥티틱틴틸팀팁팃팅파팍팎판팔팖팜팝팟팠팡팥패팩팬팰팸팹팻팼팽퍄퍅퍼퍽펀펄펌펍펏펐펑페펙펜펠펨펩펫펭펴편펼폄폅폈평폐폘폡폣포폭폰폴폼폽폿퐁퐈퐝푀푄표푠푤푭푯푸푹푼푿풀풂품풉풋풍풔풩퓌퓐퓔퓜퓟퓨퓬퓰퓸퓻퓽프픈플픔픕픗피픽핀필핌핍핏핑하학한할핥함합핫항해핵핸핼햄햅햇했행햐향허헉헌헐헒험헙헛헝헤헥헨헬헴헵헷헹혀혁현혈혐협혓혔형혜혠혤혭호혹혼홀홅홈홉홋홍홑화확환활홧황홰홱홴횃횅회획횐횔횝횟횡효횬횰횹횻후훅훈훌훑훔훗훙훠훤훨훰훵훼훽휀휄휑휘휙휜휠휨휩휫휭휴휵휸휼흄흇흉흐흑흔흖흗흘흙흠흡흣흥흩희흰흴흼흽힁히힉힌힐힘힙힛힝";
    return ksx1001.indexOf(letter) >= 0;
}
function isRandom() {
    return document.querySelector("#random").checked;
}
function isExtend() {
    return document.querySelector("#extend").checked;
}
hangulInitialConsonants.onclick = function() {
    stop.click();

    var consonants = ["ㄱ","ㄴ","ㄷ","ㄹ","ㅁ","ㅂ","ㅅ","ㅇ","ㅈ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ","ㄲ","ㄸ","ㅃ","ㅆ","ㅉ"];
    var vowels = ["ㅏ","ㅑ","ㅓ","ㅕ"];
    if (isExtend()) vowels = vowels.concat(["ㅗ","ㅛ","ㅜ","ㅠ","ㅡ","ㅣ","ㅔ","ㅐ"]);
    var repeated = [];
    for (var i = 0; i < (isExtend() ? 2 : 5); i++) {
        for (var v of vowels) {
            var syllables = [];
            for (var c of consonants) {
                var letter = Hangul.a([c, v]);
                if (isKSX1001(letter)) syllables.push(letter);
            }
            if (isRandom()) syllables.sort(() => Math.random() - 0.5);
            repeated = repeated.concat(syllables);
        }
    }
    doc.setValue(repeated.join("   "));
}
hangulSimpleVowels.onclick = function() {
    stop.click();

    var consonants = ["ㅇ"];
    if (isExtend()) consonants = ["ㄱ","ㄴ","ㄷ","ㄹ","ㅁ","ㅂ","ㅅ","ㅇ","ㅈ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"];
    var vowels = ["ㅏ","ㅑ","ㅓ","ㅕ","ㅗ","ㅛ","ㅜ","ㅠ","ㅡ","ㅣ","ㅔ","ㅐ"];
    var repeated = [];
    for (var i = 0; i < (isExtend() ? 3 : 30); i++) {
        var syllables = [];
        for (var c of consonants) {
            for (var v of vowels) {
                var letter = Hangul.a([c, v]);
                if (isKSX1001(letter)) syllables.push(letter);
            }
        }
        if (isRandom()) syllables.sort(() => Math.random() - 0.5);
        repeated = repeated.concat(syllables);
    }
    doc.setValue(repeated.join("   "));
}
hangulSimpleSyllables.onclick = function() {
    stop.click();

    var consonants = ["ㄱ","ㄴ","ㄷ","ㄹ","ㅁ","ㅂ","ㅅ","ㅇ","ㅈ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"];
    if (isExtend()) consonants = consonants.concat(["ㄲ","ㄸ","ㅃ","ㅆ","ㅉ"]);
    var vowels = ["ㅏ","ㅑ","ㅓ","ㅕ","ㅗ","ㅛ","ㅜ","ㅠ","ㅡ","ㅣ","ㅔ","ㅐ"];
    var repeated = [];
    for (var i = 0; i < (isExtend() ? 2 : 3); i++) {
        var syllables = [];
        for (var c of consonants) {
            for (var v of vowels) {
                var letter = Hangul.a([c, v]);
                if (isKSX1001(letter)) syllables.push(letter);
            }
        }
        if (isRandom()) syllables.sort(() => Math.random() - 0.5);
        repeated = repeated.concat(syllables);
    }
    doc.setValue(repeated.join("   "));
}
hangulFinalConsonants.onclick = function() {
    stop.click();

    var consonants = ["ㄱ","ㄴ","ㄷ","ㄹ","ㅁ","ㅂ","ㅅ","ㅇ"];
    var vowels = ["ㅏ","ㅑ","ㅓ","ㅕ","ㅡ","ㅣ","ㅔ","ㅐ"];
    var finals = ["ㄱ","ㄲ","ㄳ","ㄴ","ㄵ","ㄶ","ㄷ","ㄹ","ㄺ","ㄻ","ㄼ","ㄽ","ㄾ","ㄿ","ㅀ","ㅁ","ㅂ","ㅄ","ㅅ","ㅆ","ㅇ","ㅈ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"];
    var repeated = [];
    for (var i = 0; i < (isExtend() ? 1 : 1); i++) {
        var syllables = [];
        for (var c of consonants) {
            for (var v of vowels) {
                for (var f of finals) {
                    var letter = Hangul.a([c, v, f]);
                    if (isKSX1001(letter)) syllables.push(letter);
                }
            }
        }
        if (isRandom()) syllables.sort(() => Math.random() - 0.5);
        repeated = repeated.concat(syllables);
    }
    doc.setValue(repeated.join("   "));
}
hangulSyllables.onclick = function() {
    stop.click();

    var consonants = ["ㄱ","ㄴ","ㄷ","ㄹ","ㅁ","ㅂ","ㅅ","ㅇ","ㅈ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"];
    if (isExtend()) consonants = consonants.concat(["ㄲ","ㄸ","ㅃ","ㅆ","ㅉ"]);
    var vowels = ["ㅏ","ㅑ","ㅓ","ㅕ","ㅗ","ㅛ","ㅜ","ㅠ","ㅡ","ㅣ","ㅔ","ㅐ"];
    var finals = ["ㄱ","ㄴ","ㄷ","ㄹ","ㅁ","ㅂ","ㅅ","ㅆ","ㅇ","ㅈ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"];
    if (isExtend()) finals = ["ㄱ","ㄲ","ㄳ","ㄴ","ㄵ","ㄶ","ㄷ","ㄹ","ㄺ","ㄻ","ㄼ","ㄽ","ㄾ","ㄿ","ㅀ","ㅁ","ㅂ","ㅄ","ㅅ","ㅆ","ㅇ","ㅈ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"];
    var repeated = [];
    for (var i = 0; i < (isExtend() ? 1 : 1); i++) {
        var syllables = [];
        for (var c of consonants) {
            for (var v of vowels) {
                for (var f of finals) {
                    var letter = Hangul.a([c, v, f]);
                    if (isKSX1001(letter)) syllables.push(letter);
                }
            }
        }
        if (isRandom()) syllables.sort(() => Math.random() - 0.5);
        repeated = repeated.concat(syllables);
    }
    doc.setValue(repeated.join("   "));
}
hangulComplexVowels.onclick = function() {
    stop.click();

    var consonants = ["ㅇ"];
    if (isExtend()) consonants = ["ㄱ","ㄴ","ㄷ","ㄹ","ㅁ","ㅂ","ㅅ","ㅇ","ㅈ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"];
    var vowels = ["ㅒ","ㅖ","ㅘ","ㅙ","ㅚ","ㅝ","ㅞ","ㅟ","ㅢ"];
    var repeated = [];
    for (var i = 0; i < (isExtend() ? 3 : 30); i++) {
        var syllables = [];
        for (var c of consonants) {
            for (var v of vowels) {
                var letter = Hangul.a([c, v]);
                if (isKSX1001(letter)) syllables.push(letter);
            }
        }
        if (isRandom()) syllables.sort(() => Math.random() - 0.5);
        repeated = repeated.concat(syllables);
    }
    doc.setValue(repeated.join("   "));
}
hangulComplexSyllables.onclick = function() {
    stop.click();

    var consonants = ["ㄱ","ㄴ","ㄷ","ㄹ","ㅁ","ㅂ","ㅅ","ㅇ","ㅈ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"];
    if (isExtend()) consonants = consonants.concat(["ㄲ","ㄸ","ㅃ","ㅆ","ㅉ"]);
    var vowels = ["ㅒ","ㅖ","ㅘ","ㅙ","ㅚ","ㅝ","ㅞ","ㅟ","ㅢ"];
    var finals = ["ㄱ","ㄴ","ㄷ","ㄹ","ㅁ","ㅂ","ㅅ","ㅆ","ㅇ","ㅈ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"];
    if (isExtend()) finals = ["ㄱ","ㄲ","ㄳ","ㄴ","ㄵ","ㄶ","ㄷ","ㄹ","ㄺ","ㄻ","ㄼ","ㄽ","ㄾ","ㄿ","ㅀ","ㅁ","ㅂ","ㅄ","ㅅ","ㅆ","ㅇ","ㅈ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"];
    var repeated = [];
    for (var i = 0; i < (isExtend() ? 1 : 1); i++) {
        var syllables = [];
        for (var c of consonants) {
            for (var v of vowels) {
                for (var f of finals) {
                    var letter = Hangul.a([c, v, f]);
                    if (isKSX1001(letter)) syllables.push(letter);
                }
            }
        }
        if (isRandom()) syllables.sort(() => Math.random() - 0.5);
        repeated = repeated.concat(syllables);
    }
    doc.setValue(repeated.join("   "));
}
hangulRandomSyllables.onclick = function() {
    stop.click();

    var consonants = ["ㄱ","ㄴ","ㄷ","ㄹ","ㅁ","ㅂ","ㅅ","ㅇ","ㅈ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"];
    if (isExtend()) consonants = consonants.concat(["ㄲ","ㄸ","ㅃ","ㅆ","ㅉ"]);
    var vowels = ["ㅏ","ㅑ","ㅓ","ㅕ","ㅗ","ㅛ","ㅜ","ㅠ","ㅡ","ㅣ","ㅔ","ㅐ"];
    if (isExtend()) vowels = vowels.concat(["ㅒ","ㅖ","ㅘ","ㅙ","ㅚ","ㅝ","ㅞ","ㅟ","ㅢ"]);
    var finals = ["","ㄱ","ㄴ","ㄷ","ㄹ","ㅁ","ㅂ","ㅅ","ㅆ","ㅇ","ㅈ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"];
    if (isExtend()) finals = ["","ㄱ","ㄲ","ㄳ","ㄴ","ㄵ","ㄶ","ㄷ","ㄹ","ㄺ","ㄻ","ㄼ","ㄽ","ㄾ","ㄿ","ㅀ","ㅁ","ㅂ","ㅄ","ㅅ","ㅆ","ㅇ","ㅈ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"];
    var repeated = [];
    for (var i = 0; i < (isExtend() ? 1 : 1); i++) {
        var syllables = [];
        for (var c of consonants) {
            for (var v of vowels) {
                for (var f of finals) {
                    var letter = Hangul.a([c, v, f]);
                    if (isKSX1001(letter)) syllables.push(letter);
                }
            }
        }
        if (isRandom()) syllables.sort(() => Math.random() - 0.5);
        repeated = repeated.concat(syllables);
    }
    doc.setValue(repeated.join("   "));
}
hangulFrequentSyllables.onclick = function() {
    stop.click();
    var SYLLABLES = ["가","게","가","격","가","구","가","방","가","수","가","슴","가","요","가","위","가","을","가","족","간","식","간","장","갈","비","갈","색","감","기","감","동","감","자","개","인","거","기","거","리","거","실","거","울","건","물","게","임","겨","울","결","과","경","기","경","주","경","찰","경","치","경","험","계","단","계","란","계","절","계","획","고","기","고","모","고","장","고","추","고","향","골","목","골","프","공","간","공","기","공","연","공","원","공","짜","공","책","공","항","과","거","과","일","과","자","과","학","관","계","관","심","광","고","교","수","교","실","교","통","교","회","구","두","구","름","구","월","국","내","국","립","국","수","국","어","국","적","국","제","군","인","규","칙","그","거","그","것","그","곳","그","날","그","때","그","램","그","릇","그","림","그","분","그","쪽","극","장","근","처","금","연","기","간","기","름","기","분","기","사","기","사","기","온","기","자","기","차","기","침","기","타","김","밥","김","치","꽃","집","나","라","나","무","나","이","나","중","나","흘","낚","시","날","씨","날","짜","남","녀","남","미","남","산","남","자","남","쪽","남","편","내","과","내","년","내","용","내","일","냄","비","냄","새","냉","면","노","래","노","트","녹","색","녹","차","농","구","누","구","누","나","눈","물","뉴","스","뉴","욕","느","낌","능","력","다","리","다","리","다","음","단","어","단","점","달","러","달","력","담","배","답","장","당","근","당","신","대","학","대","화","대","회","덕","분","도","로","도","시","도","움","도","쿄","독","서","독","일","동","네","동","물","동","생","동","안","동","양","동","전","동","쪽","돼","지","된","장","두","부","듣","기","등","산","딸","기","떡","국","라","면","로","션","마","늘","마","음","만","두","만","화","매","일","매","주","맥","주","머","리","머","리","메","뉴","메","모","며","칠","면","도","명","절","모","양","모","임","모","자","목","적","몸","살","몽","골","무","료","무","릎","무","엇","무","역","무","용","문","장","문","제","문","화","물","건","미","국","미","래","미","술","바","다","바","람","바","지","박","수","반","지","반","찬","발","음","발","표","방","법","방","송","방","학","배","구","배","달","배","우","배","탈","버","스","번","호","벚","꽃","병","원","볼","펜","봉","지","봉","투","부","모","부","부","부","산","부","엌","부","인","부","탁","북","쪽","비","누","비","밀","빌","딩","빨","래","빵","집","사","고","사","과","사","람","사","물","사","원","사","월","사","이","사","장","사","전","사","진","사","촌","사","탕","사","흘","산","책","삼","월","삼","촌","상","자","상","처","상","품","새","벽","새","우","색","깔","생","선","생","신","생","일","생","활","샴","푸","서","류","서","양","서","울","서","점","서","쪽","선","배","선","수","설","날","설","탕","성","격","성","함","세","계","센","터","소","리","소","설","소","식","소","파","소","포","소","풍","손","님","송","이","수","건","수","도","수","박","수","업","수","영","수","저","수","첩","수","학","숙","제","순","서","스","키","습","관","시","간","시","계","시","골","시","내","시","디","시","민","시","설","시","외","시","월","시","작","시","장","시","청","시","험","식","당","식","사","식","탁","신","문","신","발","실","수","쓰","기","아","기","아","내","아","들","아","래","아","빠","아","이","아","침","아","침","악","기","안","경","야","구","야","채","약","국","약","사","약","속","양","말","양","복","양","식","양","파","어","깨","어","디","어","른","언","니","얼","굴","얼","마","얼","음","엄","마","여","권","여","기","여","름","여","자","여","행","역","사","연","세","연","필","연","휴","열","쇠","열","차","엽","서","영","국","영","상","영","어","영","하","영","화","예","약","옛","날","오","리","오","빠","오","월","오","이","오","전","오","후","올","해","옷","장","외","국","왼","쪽","요","금","요","리","요","일","요","즘","우","리","우","산","우","유","우","표","월","급","월","세","웬","일","위","치","유","럽","유","리","유","월","유","학","유","행","은","행","음","식","음","악","의","미","의","사","의","자","이","거","이","것","이","곳","이","름","이","모","이","번","이","분","이","사","이","월","이","유","이","쪽","이","틀","인","구","인","기","인","도","인","삼","인","상","인","천","인","형","일","기","일","본","일","식","일","월","읽","기","입","구","입","학","자","기","자","료","자","리","자","신","자","연","자","유","작","년","잔","치","잡","지","장","갑","장","마","장","미","장","소","장","점","재","료","재","킷","저","거","저","것","저","곳","저","기","저","녁","저","녁","저","분","저","쪽","저","희","전","공","전","화","점","수","점","심","점","심","점","원","점","퍼","정","도","정","문","정","보","제","목","제","일","조","카","종","로","종","류","종","이","종","일","주","말","주","변","주","부","주","사","주","소","주","스","주","위","주","인","중","국","중","식","중","심","증","세","지","갑","지","도","지","방","지","하","직","업","직","원","직","장","찌","개","창","문","채","소","책","상","책","장","처","음","최","고","추","석","추","억","축","구","축","제","출","구","출","장","취","미","치","과","치","마","치","약","친","구","친","척","칠","월","칠","판","침","대","칫","솔","카","드","카","레","카","페","커","피","코","트","코","피","콜","라","콧","물","크","기","탁","구","태","국","태","풍","택","시","통","장","특","징","파","티","팔","월","패","션","편","지","평","일","포","도","포","장","표","현","피","자","필","름","필","통","하","늘","하","루","하","숙","학","교","학","기","학","년","학","생","학","원","한","강","한","국","한","글","한","번","한","복","한","식","한","자","할","인","합","격","해","외","햇","빛","행","복","행","사","허","리","현","금","현","재","형","제","호","주","호","텔","혼","자","홍","차","화","가","환","자","회","사","회","색","회","의","후","배","휴","가","휴","일","휴","지","흰","색"];
    SYLLABLES.sort(() => Math.random() - 0.5);
    SYLLABLES.sort(() => Math.random() - 0.5);
    SYLLABLES.sort(() => Math.random() - 0.5);
    SYLLABLES.sort(() => Math.random() - 0.5);
    SYLLABLES.sort(() => Math.random() - 0.5);
    doc.setValue(SYLLABLES.join("   "));
}
</script>
</html>
