<!DOCType HTML>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:fb="http://ogp.me/ns/fb#" manifest="cache.manifest">
<head>
<meta http-equiv="content-type" content="text/html;charset=UTF-8" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="viewport" content="width=device-width" />
<title>QSO코흐법</title>
<link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.8/codemirror.css'>
<script>
window.console = window.console || function(t) {};
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.8/codemirror.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.8/mode/xml/xml.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.8/addon/selection/mark-selection.js'></script>
<script type="text/javascript">
/*! hangul-js 2019-12-10 */
!function(){"use strict";var r,d,g,l,t,e,h=["ㄱ",["ㄱ","ㄱ"],"ㄴ","ㄷ",["ㄷ","ㄷ"],"ㄹ","ㅁ","ㅂ",["ㅂ","ㅂ"],"ㅅ",["ㅅ","ㅅ"],"ㅇ","ㅈ",["ㅈ","ㅈ"],"ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"],p=["ㅏ","ㅐ","ㅑ",["ㅑ","ㅣ"],"ㅓ","ㅔ","ㅕ",["ㅕ","ㅣ"],"ㅗ",["ㅗ","ㅏ"],["ㅗ","ㅐ"],["ㅗ","ㅣ"],"ㅛ","ㅜ",["ㅜ","ㅓ"],["ㅜ","ㅔ"],["ㅜ","ㅣ"],"ㅠ","ㅡ",["ㅡ","ㅣ"],"ㅣ"],C=["","ㄱ",["ㄱ","ㄱ"],["ㄱ","ㅅ"],"ㄴ",["ㄴ","ㅈ"],["ㄴ","ㅎ"],"ㄷ","ㄹ",["ㄹ","ㄱ"],["ㄹ","ㅁ"],["ㄹ","ㅂ"],["ㄹ","ㅅ"],["ㄹ","ㅌ"],["ㄹ","ㅍ"],["ㄹ","ㅎ"],"ㅁ","ㅂ",["ㅂ","ㅅ"],"ㅅ",["ㅅ","ㅅ"],"ㅇ","ㅈ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"],A=44032;function n(n){for(var r=n.length,t={0:0},e=0;e<r;e++)n[e]&&(t[n[e].charCodeAt(0)]=e);return t}function o(n){for(var r,t,e=n.length,o={},i=0;i<e;i++)r=n[i][0].charCodeAt(0),t=n[i][1].charCodeAt(0),void 0===o[r]&&(o[r]={}),o[r][t]=n[i][2].charCodeAt(0);return o}function v(n){return void 0!==r[n]}function y(n){return void 0!==d[n]}function m(n){return void 0!==g[n]}function u(n){return void 0!==l[n]}function j(n){return 44032<=n&&n<=55203}function b(n,r){return!(!e[n]||!e[n][r])&&e[n][r]}function S(n,r){return!(!t[n]||!t[n][r])&&t[n][r]}r=n(["ㄱ","ㄲ","ㄳ","ㄴ","ㄵ","ㄶ","ㄷ","ㄸ","ㄹ","ㄺ","ㄻ","ㄼ","ㄽ","ㄾ","ㄿ","ㅀ","ㅁ","ㅂ","ㅃ","ㅄ","ㅅ","ㅆ","ㅇ","ㅈ","ㅉ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"]),d=n(["ㄱ","ㄲ","ㄴ","ㄷ","ㄸ","ㄹ","ㅁ","ㅂ","ㅃ","ㅅ","ㅆ","ㅇ","ㅈ","ㅉ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"]),g=n(["ㅏ","ㅐ","ㅑ","ㅒ","ㅓ","ㅔ","ㅕ","ㅖ","ㅗ","ㅘ","ㅙ","ㅚ","ㅛ","ㅜ","ㅝ","ㅞ","ㅟ","ㅠ","ㅡ","ㅢ","ㅣ"]),l=n(["","ㄱ","ㄲ","ㄳ","ㄴ","ㄵ","ㄶ","ㄷ","ㄹ","ㄺ","ㄻ","ㄼ","ㄽ","ㄾ","ㄿ","ㅀ","ㅁ","ㅂ","ㅄ","ㅅ","ㅆ","ㅇ","ㅈ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"]),t=o([["ㄱ","ㅅ","ㄳ"],["ㄴ","ㅈ","ㄵ"],["ㄴ","ㅎ","ㄶ"],["ㄹ","ㄱ","ㄺ"],["ㄹ","ㅁ","ㄻ"],["ㄹ","ㅂ","ㄼ"],["ㄹ","ㅅ","ㄽ"],["ㄹ","ㅌ","ㄾ"],["ㄹ","ㅍ","ㄿ"],["ㄹ","ㅎ","ㅀ"],["ㅂ","ㅅ","ㅄ"],["ㄱ","ㄱ","ㄲ"],["ㄷ","ㄷ","ㄸ"],["ㅂ","ㅂ","ㅃ"],["ㅅ","ㅅ","ㅆ"],["ㅈ","ㅈ","ㅉ"]]),e=o([["ㅗ","ㅏ","ㅘ"],["ㅗ","ㅐ","ㅙ"],["ㅗ","ㅣ","ㅚ"],["ㅜ","ㅓ","ㅝ"],["ㅜ","ㅔ","ㅞ"],["ㅜ","ㅣ","ㅟ"],["ㅡ","ㅣ","ㅢ"]]);function w(n,r){if(null===n)throw new Error("Arguments cannot be null");"object"==typeof n&&(n=n.join(""));for(var t,e,o,i,u,f=[],c=n.length,a=0;a<c;a++){var s=[];j(i=n.charCodeAt(a))?(e=((i-=A)-(o=i%28))/28%21,t=parseInt((i-o)/28/21),"object"==typeof h[t]?s=s.concat(h[t]):s.push(h[t]),"object"==typeof p[e]?s=s.concat(p[e]):s.push(p[e]),0<o&&("object"==typeof C[o]?s=s.concat(C[o]):s.push(C[o]))):v(i)?"string"==typeof(u=y(i)?h[d[i]]:C[l[i]])?s.push(u):s=s.concat(u):m(i)?"string"==typeof(u=p[g[i]])?s.push(u):s=s.concat(u):s.push(n.charAt(a)),r?f.push(s):f=f.concat(s)}return f}function i(n){return"string"!=typeof n?"":(n=w(n)).join("")}function f(c){"string"==typeof c&&(c=w(c));var n,r,a=[],t=c.length,e=0,s=-1,h=!1;function o(n){var r,t,e,o,i=0,u="";if(h=!1,!(n<s+1))for(var f=1;;f++){if(1===f){if(m(r=c[s+f].charCodeAt(0)))return s+f+1<=n&&m(t=c[s+f+1].charCodeAt(0))?a.push(String.fromCharCode(b(r,t))):a.push(c[s+f]),void(s=n);if(!y(r))return a.push(c[s+f]),void(s=n);u=c[s+f]}else if(2===f){if(y(t=c[s+f].charCodeAt(0)))return r=S(r,t),u=String.fromCharCode(r),a.push(u),void(s=n);u=String.fromCharCode(28*(21*d[r]+g[t])+A)}else 3===f?(b(t,e=c[s+f].charCodeAt(0))?t=b(t,e):i=e,u=String.fromCharCode(28*(21*d[r]+g[t])+l[i]+A)):4===f?(i=S(i,o=c[s+f].charCodeAt(0))?S(i,o):o,u=String.fromCharCode(28*(21*d[r]+g[t])+l[i]+A)):5===f&&(i=S(i,o=c[s+f].charCodeAt(0)),u=String.fromCharCode(28*(21*d[r]+g[t])+l[i]+A));if(n<=s+f)return a.push(u),void(s=n)}}for(var i=0;i<t;i++)y(n=c[i].charCodeAt(0))||m(n)||u(n)?(0===e?y(n)?e=1:m(n)&&(e=4):1==e?m(n)?e=2:S(r,n)?e=5:o(i-1):2==e?u(n)?e=3:m(n)?b(r,n)||(o(i-1),e=4):(o(i-1),e=1):3==e?u(n)?!h&&S(r,n)?h=!0:(o(i-1),e=1):y(n)?(o(i-1),e=1):m(n)&&(o(i-2),e=2):4==e?m(n)?b(r,n)?(o(i),e=0):o(i-1):(o(i-1),e=1):5==e&&(e=m(n)?(o(i-2),2):(o(i-1),1)),r=n):(o(i-1),o(i),e=0);return o(i-1),a.join("")}function c(n){this.string=n,this.disassembled=w(n).join("")}c.prototype.search=function(n){return w(n).join("").indexOf(this.disassembled)};var a={disassemble:w,d:w,disassembleToString:i,ds:i,assemble:f,a:f,search:function(n,r){var t=w(n).join(""),e=w(r).join("");return t.indexOf(e)},rangeSearch:function(n,r){var t,e=w(n).join(""),o=w(r).join(""),i=w(n,!0),u=new RegExp(o,"gi"),f=[];if(!r.length)return[];for(;t=u.exec(e);)f.push(t.index);return f.map(function(n){return[function(n){for(var r=0,t=0;r<i.length;++r)if(n<(t+=i[r].length))return r}(n),function(n){for(var r=0,t=0;r<i.length;++r)if(t+=i[r].length,n+o.length<=t)return r}(n)]})},Searcher:c,endsWithConsonant:function(n){"object"==typeof n&&(n=n.join(""));var r=n.charCodeAt(n.length-1);if(j(r)){if(0<(r-=A)%28)return!0}else if(v(r))return!0;return!1},endsWith:function(n,r){return w(n).pop()===r},isHangul:function(n){return"string"==typeof n&&(n=n.charCodeAt(0)),j(n)},isComplete:function(n){return"string"==typeof n&&(n=n.charCodeAt(0)),j(n)},isConsonant:function(n){return"string"==typeof n&&(n=n.charCodeAt(0)),v(n)},isVowel:function(n){return"string"==typeof n&&(n=n.charCodeAt(0)),m(n)},isCho:function(n){return"string"==typeof n&&(n=n.charCodeAt(0)),y(n)},isJong:function(n){return"string"==typeof n&&(n=n.charCodeAt(0)),u(n)},isHangulAll:function(n){if("string"!=typeof n)return!1;for(var r=0;r<n.length;r++)if(!j(n.charCodeAt(r)))return!1;return!0},isCompleteAll:function(n){if("string"!=typeof n)return!1;for(var r=0;r<n.length;r++)if(!j(n.charCodeAt(r)))return!1;return!0},isConsonantAll:function(n){if("string"!=typeof n)return!1;for(var r=0;r<n.length;r++)if(!v(n.charCodeAt(r)))return!1;return!0},isVowelAll:function(n){if("string"!=typeof n)return!1;for(var r=0;r<n.length;r++)if(!m(n.charCodeAt(r)))return!1;return!0},isChoAll:function(n){if("string"!=typeof n)return!1;for(var r=0;r<n.length;r++)if(!y(n.charCodeAt(r)))return!1;return!0},isJongAll:function(n){if("string"!=typeof n)return!1;for(var r=0;r<n.length;r++)if(!u(n.charCodeAt(r)))return!1;return!0}};"function"==typeof define&&define.amd?define(function(){return a}):"undefined"!=typeof module?module.exports=a:window.Hangul=a}();
</script>
<style>
body {
    background-color: white ;
    font-family: 'Helvetica', 'sans serif';
    font-size: medium;
	line-height: 1.5;
    min-width: 760px;
    margin: 0 auto;
}
.page {
    width: 90%;
    margin-left: auto;
    margin-right: auto;
    padding: 1em;
}
p {
    padding: 4px;
    background: white;
    color: black;
}
input {
    padding: 4px;
    border: 1px solid lightsalmon;
    transition: box-shadow 0.3s;
    background: lightyellow;
    border-radius: 5px;
    color: black;
    font-family: 'Helvetica', 'sans serif';
    font-size: large;
}

input:focus { 
    border: 1px solid teal;
    box-shadow: 0 0 5px 1px powderblue;
}
button {
    color: black;
    font-family: 'Helvetica', 'sans serif';
    font-size: large;
    font-weight: bold;
    margin-top: 6px;
}
#play {
    color: blue;
}
#stop {
    color: red;
}
#freq { 
    width: 3em;
}
#speed {
    width: 3em;
}
#volume {
    width: 3em;
}
textarea {
    width : 100%;
    height : auto;
    padding: 10px;
    border: 1px solid lightsalmon;
    transition: box-shadow 0.3s;
    background: lightyellow;
    border-radius: 5px;
    color: black;
    font-family: 'Helvetica', 'sans serif';
    font-size: x-large;
    font-weight: bold;
    line-height: 1.5;
}
#counter {
    float: right;
}
.font_medium {
    font-size : medium;
}
.setting {
    line-height: 2;
    margin-top: 0px;    
}
.setting_bold {
    font-weight: 600;
}
.setting_group {
    padding: 4px 0px 4px 10px;
    margin-right: 10px;
    border: 1px dotted teal;
    white-space: nowrap;
}
.setting_group_2 {
    margin-right: 10px;
    white-space: nowrap;
}
.sample_group > button {
    margin-top: 7px;
    margin-bottom: 4px;
}
::selection {
    background-color: rgba(255, 0, 0, 0.5);
}
.hidden_sample {
    display : none;
}

.CodeMirror {
    width : 100%;
    height : 12em;
    padding: 10px;
    border: 1px solid lightsalmon;
    transition: box-shadow 0.3s;
    background: lightyellow;
    border-radius: 5px;
    color: black;
    font-family: 'Helvetica', 'sans serif';
    font-size: x-large;
    font-weight: bold;
    line-height: 1.5;
    margin-top: 20px;
}
.CodeMirror-selected { background-color: rgba(255, 0, 0, 0.5); }
.CodeMirror-focused .CodeMirror-selected { background-color: rgba(255, 0, 0, 0.5); }
.hide_markText { background-color: black; }
.show_markText { background-color: inherit; }

.log_container_ditdah {
    width : 100%;
    height : 12px;
    overflow: hidden;
    padding: 10px;
    border: 1px solid lightsalmon;
    transition: box-shadow 0.3s;
    background: lightyellow;
    border-radius: 5px;
    color: black;
    font-family: 'monospace';
    font-size: small;
    white-space: nowrap;
    margin-top: 0px;
}
#ditdah {
    height:10px;
    float: right;
}
.ditdah_bar {
    background: green;
    height: 10px;
    display: inline-block;
}
.ditdah_gap {
    height: 10px;
    display: inline-block;
}
#keyer_setting {
    display: none;
    line-height: 2;
}
#connect {
    color: blue;
}
#disconnect {
    color: red;
}
#mp3 {
	display: inline-block;
	margin: auto;
	padding-left: 10px;
}
audio {
	height: 1em;
	margin-bottom: -3px;
}
</style>
</head>
<body>
<div class="page">

<p><span style="font-size:200%"><b>QSO 코흐법</b></span>
    <span style="font-size:150%">&nbsp;(한글 10단계 - 교신 예문 만들기)</span>
</p>

<div class="setting">
    <span class="setting_group_2">
        <button id="play">PLAY</button>&nbsp;
        <button id="stop">STOP</button>
        </span>   

<span class="setting_group_2">
<span class="setting_bold">음색</span> <input type="number" id="freq" value="650" step="10" size="4" min="200" max="1200" /> Hz
&nbsp;
<span class="setting_bold">속도</span> <input type="number" id="speed" value="10" size="2" min="5" max="50" /> WPM
&nbsp;
<span class="setting_bold">음량</span> <input type="number" id="volume" value="100" size="3" min="1" max="100" step="1" /> %
</span>
<span class="setting_group">
<span class="setting_bold">부호간격</span> : 
<label><input type="radio" name="key" value="computer" /> 정상</label>&nbsp;
<label><input type="radio" name="key" value="space_1" /> 1></label>&nbsp;
<label><input type="radio" name="key" value="space_2" /> 2>></label>&nbsp;
<label><input type="radio" name="key" value="space_3" checked /> 3>>></label>&nbsp;
<label><input type="radio" name="key" value="space_4" /> 4>>>></label>&nbsp;
<label><input type="radio" name="key" value="space_5" /> 5>>>>></label>&nbsp;
</span>&nbsp;&nbsp;&nbsp;

<span class="setting_group">
<span class="setting_bold">옵션</span> : 
<label id="selection_only" ></label>
<label id="highlight_slowly" ></label>
<label><input type="checkbox" id="hide_text" checked="checked" /> 글자숨기기</label>&nbsp;&nbsp;
<label><input type="checkbox" id="repeat" /> 연속반복</label>
<label id="flute"></label>
<label id="noise"></label>
<label id="fading"></label>&nbsp;
</span>
</div>


<div>
<span class="sample_group">

<label id="hangul_qso_1"></label>
<label id="user_qso"></label>

</span>
</div>

<div class="log_container_ditdah"><span id="ditdah"></span></div>

<button id="sub_menu_1" style="background-color:rgb(240, 250, 200);">한글 교신 예문 만들기 (15/2)</button>&nbsp;



<!--  hangul_txt_1         -->
<textarea id="hangul_txt_1" rows="10">
</textarea>
<div id="hangul_txt_1_caption"></div>

<!--  user_txt         -->
<textarea id="user_txt" rows="16" class="hidden_sample">
</textarea>
<div id="user_txt_caption" class="hidden_sample">
<label><input type="radio" name="repeat_count" value="1" checked /></label>
</div>

<br>
<button style="color:rgb(70, 70, 70);" onClick="location.href='/morse/koch/kor'">&nbsp;홈페이지로 돌아가기&nbsp;</button>

<h3> ◆ 프로그램 정보</h3>
<span class="font_medium">
▶ 프로그램의 제작 : DS1TZE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CW Trainer - <a href="https://shingiru.github.io/hangul_cw_trainer.html" target="_blank">https://shingiru.github.io/hangul_cw_trainer.html</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;한글 CW Decoder - <a href="http://shingiru.github.io/hangul_cw_decoder.html" target="_blank">http://shingiru.github.io/hangul_cw_decoder.html</a><br />
<br />
▶ QSO코흐법을 위한 재구성 : HL5KY<br />
<br>
❤ 프로그램의 사용을 허용해 주신 DS1TZE님께 감사드립니다.
<br /><br />
</span>

</div>
</body>

<!--script>Mp3LameEncoderConfig = { memoryInitializerPrefixURL: "" };</script-->
<script src="Mp3LameEncoder.min.js"></script>
<script type="text/javascript">
(function(AudioContext) {
    AudioContext.prototype.createEffect = function() {
        var bufferSize = 4096;
        var node = this.createScriptProcessor(bufferSize, 1, 1);
        node.onaudioprocess = function(e) {
            const inputBuffer = e.inputBuffer;
            const outputBuffer = e.outputBuffer;

            // Loop through the output channels (in this case there is only one)
            for (let channel = 0; channel < outputBuffer.numberOfChannels; channel++) {
                const inputData = inputBuffer.getChannelData(channel);
                const outputData = outputBuffer.getChannelData(channel);

                // Loop through the 4096 samples
                for (let sample = 0; sample < inputBuffer.length; sample++) {
                    // make output equal to the same as the input
                    outputData[sample] = inputData[sample];

                    // add noise to each output sample
                    if (useNoise) outputData[sample] += ((Math.random() * 2) - 1) * 0.9; //  white noise. 0.2 noise strength 
                }
            }
        }
        return node;
    };
    
    AudioContext.prototype.createWhiteNoise = function(bufferSize) {
        bufferSize = bufferSize || 4096;
        var node = this.createScriptProcessor(bufferSize, 1, 1);
        node.onaudioprocess = function(e) {
            var output = e.outputBuffer.getChannelData(0);
            for (var i = 0; i < bufferSize; i++) {
                output[i] = Math.random() * 2 - 1;
            }
        }
        return node;
    };

    AudioContext.prototype.createPinkNoise = function(bufferSize) {
        bufferSize = bufferSize || 4096;
        var b0, b1, b2, b3, b4, b5, b6;
        b0 = b1 = b2 = b3 = b4 = b5 = b6 = 0.0;
        var node = this.createScriptProcessor(bufferSize, 1, 1);
        node.onaudioprocess = function(e) {
            var output = e.outputBuffer.getChannelData(0);
            for (var i = 0; i < bufferSize; i++) {
                var white = Math.random() * 2 - 1;
                b0 = 0.99886 * b0 + white * 0.0555179;
                b1 = 0.99332 * b1 + white * 0.0750759;
                b2 = 0.96900 * b2 + white * 0.1538520;
                b3 = 0.86650 * b3 + white * 0.3104856;
                b4 = 0.55000 * b4 + white * 0.5329522;
                b5 = -0.7616 * b5 - white * 0.0168980;
                output[i] = b0 + b1 + b2 + b3 + b4 + b5 + b6 + white * 0.5362;
                output[i] *= 0.11; // (roughly) compensate for gain
                b6 = white * 0.115926;
            }
        }
        return node;
    };

    AudioContext.prototype.createBrownNoise = function(bufferSize) {
        bufferSize = bufferSize || 4096;
        var lastOut = 0.0;
        var node = this.createScriptProcessor(bufferSize, 1, 1);
        node.onaudioprocess = function(e) {
            var output = e.outputBuffer.getChannelData(0);
            for (var i = 0; i < bufferSize; i++) {
                var white = Math.random() * 2 - 1;
                output[i] = (lastOut + (0.02 * white)) / 1.02;
                lastOut = output[i];
                output[i] *= 3.5; // (roughly) compensate for gain
            }
        }
        return node;
    };
})(window.AudioContext);

</script>
<script type="text/javascript">
MorseNode.prototype.MORSE = {
    "A": ".-",
    "B": "-...",
    "C": "-.-.",
    "D": "-..",
    "E": ".",
    "F": "..-.",
    "G": "--.",
    "H": "....",
    "I": "..",
    "J": ".---",
    "K": "-.-",
    "L": ".-..",
    "M": "--",
    "N": "-.",
    "O": "---",
    "P": ".--.",
    "Q": "--.-",
    "R": ".-.",
    "S": "...",
    "T": "-",
    "U": "..-",
    "V": "...-",
    "W": ".--",
    "X": "-..-",
    "Y": "-.--",
    "Z": "--..",

    "1": ".----",
    "2": "..---",
    "3": "...--",
    "4": "....-",
    "5": ".....",
    "6": "-....",
    "7": "--...",
    "8": "---..",
    "9": "----.",
    "0": "-----",
    
    ".": ".-.-.-",
    ",": "--..--",
    "?": "..--..",
    "/": "-..-.",
    "+": ".-.-.",
    "-": "-....-",
    "=": "-...-",
    ":": "---...",
    ";": "-.-.-.",
    "(": "-.--.",
    ")": "-.--.-",
    "'": ".----.",
    "\"": ".-..-.",
    "@": ".--.-.",
    
    "ㄱ": ".-..",
    "ㄴ": "..-.",
    "ㄷ": "-...",
    "ㄹ": "...-",
    "ㅁ": "--",
    "ㅂ": ".--",
    "ㅅ": "--.",
    "ㅇ": "-.-",
    "ㅈ": ".--.",
    "ㅊ": "-.-.",
    "ㅋ": "-..-",
    "ㅌ": "--..",
    "ㅍ": "---",
    "ㅎ": ".---",
    "ㅏ": ".",
    "ㅑ": "..",
    "ㅓ": "-",
    "ㅕ": "...",
    "ㅗ": ".-",
    "ㅛ": "-.",
    "ㅜ": "....",
    "ㅠ": ".-.",
    "ㅡ": "-..",
    "ㅣ": "..-",
    "ㅔ": "-.--",
    "ㅐ": "--.-",
    
    // for prosign
    "&" : ".-...",
    "Ŝ" : "...-.",
    // non-standard
    "[" : "-...-.-",
    "]" : "...-.-",
    "^" : "-.-.-",
    "※" : "........"
};

MorseNode.prototype.PROSIGN = {
    "<AR>" : "+",
    "<KN>" : "(",
    "<AS>" : "&",
    "<BT>" : "=",
    "<SN>" : "Ŝ",
    // non-standard
    "<BK>" : "[",
    "<SK>" : "]",
    "<VA>" : "]",
    "<KA>" : "^",
    "<HH>" : "※"
};

function MorseNode(ac, rate) {
    // ac is an audio context.
    this._oscillator = ac.createOscillator();
    this._gain = ac.createGain();

    this._gain.gain.value = 0;
    this._oscillator.type = 'sine';
    this._oscillator.frequency.value = 600;
    
    this._oscillator.connect(this._gain);
    this.key = 'computer';

    if ("undefined" == typeof rate)
        rate = 20;
    this._dot = 1.2 / rate; // formula from Wikipedia.

    this._oscillator.start(0);
	this._moved = 0;
}

MorseNode.prototype.connect = function(target) {
    return this._gain.connect(target);
}

MorseNode.prototype.timeMove = function(sec) {
	if (ac.currentTime + this._moved + sec < queue[0][0]) sec = queue[0][0] - ac.currentTime - this._moved;
	else if (ac.currentTime + this._moved + sec > queue[queue.length - 1][0]) sec = queue[queue.length - 1][0] - ac.currentTime - this._moved;
	this._moved += sec;
	
	console.log(sec);
	
	var i = 0;
	for (; i < queue.length; i++)
		if (queue[i][0] > ac.currentTime + this._moved) break;
	
	this._gain.disconnect(filter);
	this._oscillator.disconnect(this._gain);
	this._gain = ac.createGain();
	this._gain.gain.value = 0;
	this._oscillator.connect(this._gain);
	this._gain.connect(filter);
	
	for (; i < queue.length; i++)
		this._gain.gain.setValueAtTime(queue[i][1], queue[i][0] - this._moved);
	
	var min = timestamp[0];
	timestamp.forEach((el, idx, ary) => { ary[idx] = el - sec; });
}

MorseNode.prototype.dotfac = function(t) {
    switch (this.key) {
            // t is type of dotvalue. l=letter int. i=inter el. s=spaces .=dit -=dah 
        case 'computer':
            return 1;
		case 'straightmed': //i and . are rather too long than too short, s the inverse rest is random
            if (t=='.' || t=='i') return Math.random()*0.33+0.95;
            if (t=='s') return Math.random()*0.2+0.85;
            return Math.random()*0.3+0.85;
        case 'straightbad':
            if (t=='.' || t=='i') return Math.random()*0.6+0.8;
            if (t=='s') return Math.random()*0.4+0.7;
            return Math.random()*0.5+0.75;
        case 'straightvbad':
            if (t=='.' || t=='i') return Math.random()*1.6+0.8;
            if (t=='s') return Math.random()*0.85+0.4;
            return Math.random()*0.8+0.6;
        case 'space_1':
			if (t=='s') return 1.6;
            if (t=='l') return 1.6;
        case 'space_2':
			if (t=='s') return 2.2;
            if (t=='l') return 2.2;
        case 'space_3':
			if (t=='s') return 3;
            if (t=='l') return 3;
        case 'space_4':
			if (t=='s') return 4;
            if (t=='l') return 4;            
        case 'space_5':
			if (t=='s') return 5;
            if (t=='l') return 5;            
        case 'farnsworth': //uses farnsworth
            if (t=='s') return 6;
            if (t=='l') return 4;
        case 'elmer': //uses farnsworth
            if (t=='s') return 4;
            if (t=='l') return 1.5;
            return 1;
        }

}

var smoothingDuration = 0.004;  // 10ms is very soft, icom default 4ms;
MorseNode.prototype.playChar = function(queueOnly, t, c, v) {
    for (var i = 0; i < c.length; i++) {
        switch(c[i]) {
        case '.':
            if (!queueOnly) {
				this._gain.gain.setValueAtTime(0, t - smoothingDuration);
				this._gain.gain.linearRampToValueAtTime(1.0 * v, t);
			}
			enQueue(1.0 * v, t);
            t += this._dot * this.dotfac('.');
            if (!queueOnly) {
				this._gain.gain.setValueAtTime(1.0 * v, t - smoothingDuration);
				this._gain.gain.linearRampToValueAtTime(0.0, t);
			}
			enQueue(0.0, t)
            break;
        case '-':
            if (!queueOnly) {
				this._gain.gain.setValueAtTime(0, t - smoothingDuration);
				this._gain.gain.linearRampToValueAtTime(1.0 * v, t);
			}
			enQueue(1.0 * v, t);
            t += 3 * this._dot * this.dotfac('-');
            if (!queueOnly) {
				this._gain.gain.setValueAtTime(1.0 * v, t - smoothingDuration);
				this._gain.gain.linearRampToValueAtTime(0.0, t);
			}
			enQueue(0.0, t)
            break;
        }
        t += this._dot * this.dotfac('i');
    }
    return t;
}

var timestamp = [];
var queue = [];
function enQueue(v, t) {
	queue.push([t, v]);
}
var hasHangul = false;

MorseNode.prototype.playString = function(queueOnly, t, w, v, k, fade) {
    this.key = k;
    
    w = this.convertHangulAndProsign(w.toUpperCase());
    timestamp = [];
	queue = [];
	enQueue(0, 0);
	hasHangul = false;
    
    var start = t, fv = v;
    for (var n = 0; n < w.length; n++) {
        if (fade && (t - start) > 0) { // skip face effect during first 10s
            var pointOneSec = parseInt((t - start) * 10) % 150;
            if (pointOneSec < 75) fv = v * (100 - pointOneSec) * 0.01; // gradually goes down to the quarter volume for 7.5 sec
            else fv = v * (pointOneSec - 50) * 0.01; // gradually goes up to the normal volume for 7.5 sec
        }
        if (!highlightSlowly.checked) timestamp.push(t);
        var c = w[n];
        var hangul = (c.length > 1);
        for (var i = 0; i < c.length; i++) {
            if (c[i] == ' ' || c[i] == '\u00A0') {
                t += 4 * this._dot * this.dotfac('s'); // 3 dots gap already added after ending letter before
            }
            else if ("undefined" != typeof this.MORSE[c[i]]) {
                t = this.playChar(queueOnly, t, this.MORSE[c[i]], fv); // 1 gap after dit/dah
                t += 2 * this._dot * this.dotfac('l'); // with this 2 more gap, whole gap between letter is 3
            }
        }
        if (hangul) {
            t += (2+2) * this._dot * this.dotfac('l');
			hasHangul = true;
        }
        if (highlightSlowly.checked) timestamp.push(t);
    }
    timestamp.push(t);
    
    return t;
}

MorseNode.prototype.convertHangulAndProsign = function(w) {
    // convert prosign
    for (var key in this.PROSIGN) {
        w = w.replace(new RegExp(key.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g'), this.PROSIGN[key]);
    }
    return Hangul.disassemble(w, true);
}

MorseNode.prototype.getSpaceDelayInMills = function() {
    return 1000 * this._dot * (this.dotfac('i') + 2 * this.dotfac('l') + 4 * this.dotfac('s'));
}


var ac, filter, morse = null, vol = 1.0, cwPort = null, cwPortInitialized = false, cwPortOpen = false;

var ua = navigator.userAgent.toLowerCase();
var isIOS = (ua.indexOf("iphone") > -1 || ua.indexOf("ipad") > -1 || ua.indexOf("ipod") > -1);
var isAndroid = ua.indexOf("android") > -1;
var isMobile = (isIOS || isAndroid);

var freq = document.querySelector("#freq")
var wpm = document.querySelector("#speed");
var volume = document.querySelector("#volume");
var play = document.querySelector("#play");
var stop = document.querySelector("#stop");
var keyComputer = document.querySelector('input[name="key"][value="computer"]');
//var keyElmer = document.querySelector('input[name="key"][value="elmer"]');
//var keyFarnsworth = document.querySelector('input[name="key"][value="farnsworth"]');
var keySpace1 = document.querySelector('input[name="key"][value="space_1"]');
var keySpace2 = document.querySelector('input[name="key"][value="space_2"]');
var keySpace3 = document.querySelector('input[name="key"][value="space_3"]');
var keySpace4 = document.querySelector('input[name="key"][value="space_4"]');
var keySpace5 = document.querySelector('input[name="key"][value="space_5"]');
//var keyStraightMed = document.querySelector('input[name="key"][value="straightmed"]');
//var keyStraightBad = document.querySelector('input[name="key"][value="straightbad"]');
//var keyStraightVBad = document.querySelector('input[name="key"][value="straightvbad"]');
var flute = document.querySelector("#flute");
var noise = document.querySelector("#noise");
var fading = document.querySelector("#fading");
var selectionOnly = document.querySelector("#selection_only");
var highlightSlowly = document.querySelector("#highlight_slowly");
var hideText = document.querySelector("#hide_text");
var repeat = document.querySelector("#repeat");


function renewMorse() {
    ac = (ac || new AudioContext());
    if (ac.state != "running") ac.resume();

    if (morse != null) morse._oscillator.stop(0);
    morse = new MorseNode(ac, parseInt(wpm.value));
    
    filter = ac.createBiquadFilter(); 
    filter.frequency.value = freq.value;
    filter.Q.value = 0;
    
    morse.connect(filter);
    filter.connect(ac.destination);
    
    morse._dot = 1.2 / parseFloat(wpm.value);
    morse._oscillator.frequency.value = parseInt(freq.value);
}
var stopped = true, paused = false;
var cm, doc, txtValue, cursorFrom = null, cursorTo, cursorTempFrom, cursorTempTo, cursorTempEnd, highlightStart, hightlightEnd, repeatId = -1, marker = null;
var DELAY_AMOUNT = 1; // seconds
stop.onclick = function() {
    try { clearTimeout(repeatId); repeatId = -1;}
    catch (e) {}
    
    renewMorse();
    if (noiseNode) noiseGain.disconnect();
    morse.playString(false, ac.currentTime, " ", vol, document.querySelector('input[name="key"]:checked').value, fading.checked);
    doc.readOnly = false;
    
    addDitdah(false, 1); // this also manage cw port
	
	clearMarker();
	cm.setOption("extraKeys", {});
    cm.focus();
    if (cursorFrom != null) {
        doc.setSelection(cursorFrom, cursorTo);
        cm.refresh();
    }
    stopped = true;

    play.replaceChild(document.createTextNode("PLAY"), play.firstChild);
    paused = false;
}
var bufferSource = noiseNode = noiseGain = null;
play.onclick = function() {
    if (paused) {
        play.replaceChild(document.createTextNode("PAUSE"), play.firstChild);
        paused = false;
        ac.resume();
        return;
    } else if (stopped == false && repeatId == -1) {
        play.replaceChild(document.createTextNode("RESUME"), play.firstChild);
        paused = true;
        ac.suspend();
        return;
    } else {
        play.replaceChild(document.createTextNode("PAUSE"), play.firstChild);
        paused = false;
    }
    
    try { clearTimeout(repeatId); repeatId = -1;}
    catch (e) {}

    renewMorse();
    
    if (noise.checked) {
        if (bufferSource == null) {
            bufferSource = ac.createBufferSource();
            noiseNode = ac.createWhiteNoise();
            bufferSource.connect(noiseNode);
            noiseGain = ac.createGain();
            noiseNode.connect(noiseGain);
            bufferSource.start(0);
        }
        noiseGain.gain.value = vol * 0.5;
        noiseGain.connect(ac.destination);
    }
    
    clearMarker();
    cm.focus();
    if (cursorFrom != null && !stopped) {
        doc.setSelection(cursorFrom, cursorTo);
        cm.refresh();
        previousTime = 0;
    } else clearDitdah();
    
    cursorFrom = doc.getCursor("from");
    cursorTo = doc.getCursor("to");
    txtValue = doc.getSelection();
    
    var lastLine = doc.lastLine();
    var lastLineLength = doc.getLine(lastLine).length;
    
    if (selectionOnly.checked) {
        if (txtValue == '') { // when no selection  
            if (cursorTo.line == lastLine && cursorTo.ch == lastLineLength) { // when caret is at the end, start from first letter
                txtValue = doc.getValue();
                cursorTempFrom = {line: 0, ch: 0};
                cursorTempTo = {line: 0, ch: 0};
                cursorTempEnd = {line: lastLine, ch: lastLineLength};
            } else { // when caret is in the middle, start from caret position
                doc.setSelection(cursorFrom, {line: lastLine, ch: lastLineLength});
                txtValue = doc.getSelection();
                doc.setSelection(cursorFrom, cursorTo);
                cursorTempFrom = {line: cursorFrom.line, ch: cursorFrom.ch};
                cursorTempTo = {line: cursorFrom.line, ch: cursorFrom.ch};
                cursorTempEnd = {line: lastLine, ch: lastLineLength}
            }
        } else { // play selection
            cursorTempFrom = {line: cursorFrom.line, ch: cursorFrom.ch};
            cursorTempTo = {line: cursorFrom.line, ch: cursorFrom.ch};
            cursorTempEnd = {line: cursorTo.line, ch: cursorTo.ch};
        }
    } else {
        txtValue = doc.getValue();
        cursorTempFrom = {line: 0, ch: 0};
        cursorTempTo = {line: 0, ch: 0};
        cursorTempEnd = {line: lastLine, ch: lastLineLength};
    }
    highlightStart = highlightEnd = 0;
    
    morse.playString(false, ac.currentTime + DELAY_AMOUNT, 
        txtValue, 
        vol * (noise.checked ? 0.5 : 1), 
        document.querySelector('input[name="key"]:checked').value,
        fading.checked);
    
    doc.readOnly = true;

    window.localStorage.setItem('user_txt', userTxt.CodeMirror.doc.getValue());
    
    stopped = false;
    
    cm.focus();
    if (highlightSlowly.checked) doc.setSelection(cursorTempFrom, cursorTempFrom);
    if (hideText.checked) setMarker(cursorTempFrom, cursorTempEnd);
	cm.setOption("extraKeys", { Left: function() {rollback(true);}, Right: function() {rollback(false);} });
    cm.focus();
    
	/*if (selectionOnly.checked == false) repeatId = setTimeout(highlight, DELAY_AMOUNT * 1000);
    else */highlight();
}

function delayedRepeat() {
    if (!stopped) play.click();
}
var previousTime = 0;
function highlight() {
    if (timestamp.length == 0) {
        stop.click();
        if (repeat.checked) {
            stopped = false;
            repeatId = setTimeout(delayedRepeat, 2 * morse.getSpaceDelayInMills());
        }
        return;
    }
    
    if (previousTime != 0) addDitdah(morse._gain.gain.value > 0, parseInt((ac.currentTime - previousTime)*1000));
    previousTime = ac.currentTime;
    
    if (ac.currentTime > timestamp[0]) {
        timestamp.shift();
        
        highlightStart = highlightEnd;
        cursorTempFrom.line = cursorTempTo.line, cursorTempFrom.ch = cursorTempTo.ch;
        
        if (txtValue[highlightStart] == '<' && txtValue.length > highlightStart + 3 
            && !!morse.PROSIGN[txtValue.substring(highlightStart, highlightStart + 4).toUpperCase()]) {
            highlightEnd = highlightStart + 4;
            cursorTempTo.ch = cursorTempFrom.ch + 4;
        } else if (txtValue.length > highlightStart) {
            highlightEnd = highlightStart + 1;
            if (txtValue[highlightStart] == '\n') {
                cursorTempTo.line++;
                cursorTempTo.ch = 0;
            } else {
                cursorTempTo.ch = cursorTempFrom.ch + 1;
            }
        }

        if (!stopped && cursorTempTo.ch != 0) {
            cm.focus();
            doc.setSelection(cursorTempFrom, cursorTempTo);
                
            if (hideText.checked) {
                setMarker(cursorTempTo, cursorTempEnd);
            }
            
            cm.refresh();
        }
    }
    
    if (!stopped) setTimeout(highlight, 7); // 7ms is based on the sampling rate
}
function setMarker(start, end) {
    clearMarker();
    marker = cm.markText(start, end, {className: "hide_markText"});
}
function clearMarker() {
    if (marker == null) return;
    
    marker.clear();
    marker = null;
}

function rollback(back) {
	if (stopped || morse == null) return;
	morse.timeMove(back ? -5 : 5);
}


var ditdah = document.querySelector("#ditdah");
var last = false, lastWidth = 0;
function addDitdah(bar, len) {
    if (bar == last && ditdah.childNodes.length > 0 && lastWidth < 8192) {
        var span = ditdah.lastChild;
        lastWidth += len;
        span.style.width = (parseInt(lastWidth) >> 3) + "px";
        return;
    }
    var span = document.createElement("SPAN");
    span.className = bar ? "ditdah_bar" : "ditdah_gap";  
    span.style.width = parseInt(len >> 3) + "px";
    ditdah.appendChild(span);
    if (ditdah.childNodes.length > 256) ditdah.removeChild(ditdah.firstChild);
    last = bar;
    lastWidth = len;
	
	if (cwPortOpen) cwPort.setSignals({dataTerminalReady:bar});
}
function clearDitdah() {
    var len = ditdah.childNodes.length;
    for (var i = 0; i < len; i++) ditdah.removeChild(ditdah.firstChild);
    
    previousTime = 0;
}

freq.onchange = function() {
    window.localStorage.setItem('freq', freq.value);
}
wpm.onchange = function() {
    window.localStorage.setItem('wpm', wpm.value);
}
volume.onchange = function() {
    vol = volume.value / 100.0;
    window.localStorage.setItem('volume', volume.value);
}
keyComputer.onchange = function() {
    window.localStorage.setItem('key', document.querySelector('input[name="key"]:checked').value);
}
/*keyElmer.onchange = function() {
    window.localStorage.setItem('key', document.querySelector('input[name="key"]:checked').value);
}
keyFarnsworth.onchange = function() {
    window.localStorage.setItem('key', document.querySelector('input[name="key"]:checked').value);
}*/
keySpace1.onchange = function() {
    window.localStorage.setItem('key', document.querySelector('input[name="key"]:checked').value);
}
keySpace2.onchange = function() {
    window.localStorage.setItem('key', document.querySelector('input[name="key"]:checked').value);
}
keySpace3.onchange = function() {
    window.localStorage.setItem('key', document.querySelector('input[name="key"]:checked').value);
}
keySpace4.onchange = function() {
    window.localStorage.setItem('key', document.querySelector('input[name="key"]:checked').value);
}
keySpace5.onchange = function() {
    window.localStorage.setItem('key', document.querySelector('input[name="key"]:checked').value);
}
/*keyStraightMed.onchange = function() {
    window.localStorage.setItem('key', document.querySelector('input[name="key"]:checked').value);
}
keyStraightBad.onchange = function() {
    window.localStorage.setItem('key', document.querySelector('input[name="key"]:checked').value);
}
keyStraightVBad.onchange = function() {
    window.localStorage.setItem('key', document.querySelector('input[name="key"]:checked').value);
}*/
flute.onchange = function() {
	smoothingDuration = flute.checked ? 0.02 : 0.004;
    window.localStorage.setItem('flute', flute.checked);
}
noise.onchange = function() {
    window.localStorage.setItem('noise', noise.checked);
}
fading.onchange = function() {
    window.localStorage.setItem('fading', fading.checked);
}
selectionOnly.onchange = function() {
    window.localStorage.setItem('selection_only', selectionOnly.checked);
}
highlightSlowly.onchange = function() {
    window.localStorage.setItem('highlight_slowly', highlightSlowly.checked);
}
hideText.onchange = function() {
    window.localStorage.setItem('hide_text', hideText.checked);
}
repeat.onchange = function() {
    window.localStorage.setItem('repeat', repeat.checked);
}
window.addEventListener('DOMContentLoaded', function() {
    try {
        if (window.localStorage.getItem('freq')) freq.value = parseInt(window.localStorage.getItem('freq'));
        if (window.localStorage.getItem('wpm')) wpm.value = parseInt(window.localStorage.getItem('wpm'));
        if (window.localStorage.getItem('volume')) volume.value = parseInt(window.localStorage.getItem('volume'));
        vol = volume.value / 100.0;
        if (window.localStorage.getItem('flute')) flute.checked = window.localStorage.getItem('flute') == 'true';
		smoothingDuration = flute.checked ? 0.02 : 0.004;
        if (window.localStorage.getItem('noise')) noise.checked = window.localStorage.getItem('noise') == 'true';
        if (window.localStorage.getItem('fading')) fading.checked = window.localStorage.getItem('fading') == 'true';
        if (window.localStorage.getItem('selection_only')) selectionOnly.checked = window.localStorage.getItem('selection_only') == 'true';
        if (window.localStorage.getItem('highlight_slowly')) highlightSlowly.checked = window.localStorage.getItem('highlight_slowly') == 'true';       
        if (window.localStorage.getItem('hide_text')) hideText.checked = window.localStorage.getItem('hide_text') == 'true';
        if (window.localStorage.getItem('repeat')) repeat.checked = window.localStorage.getItem('repeat') == 'true';
        if (window.localStorage.getItem('key')) document.querySelector('input[name="key"][value="'+window.localStorage.getItem('key')+'"]').checked = true;
        if (window.localStorage.getItem('user_txt')) userTxt.CodeMirror.doc.setValue(window.localStorage.getItem('user_txt'));
        if (window.localStorage.getItem('qso_sample')) changeQsoSample(window.localStorage.getItem('qso_sample'));
        else changeQsoSample("hangul_txt_1");
		if (!isAndroid && !isIOS) document.querySelector("#keyer_setting").style.display = "inline";
    } catch (e) {
    }
}, true);

function makeEditor(textArea, display) {
    var editor = CodeMirror(function(el) {
        el.id = textArea.id;
        el.className = el.className + " " + textArea.className;
        textArea.parentNode.replaceChild(el, textArea);
    }, {value: textArea.value, mode: "xml", lineWrapping: true, styleSelectedText: true
		//, extraKeys: { Left: function() {rollback(true);}, Right: function() {rollback(false);} }
	});
}

makeEditor(document.querySelector("#hangul_txt_1"));
makeEditor(document.querySelector("#user_txt"));

var txt = document.querySelector("#hangul_txt_1");
var userTxt = document.querySelector("#user_txt");

var hangulQso1 = document.querySelector("#hangul_qso_1");
var userQso = document.querySelector("#user_qso");

var SubMenu1 = document.querySelector("#sub_menu_1");
var SubMenu2 = document.querySelector("#sub_menu_2");
var SubMenu3 = document.querySelector("#sub_menu_3");
var SubMenu4 = document.querySelector("#sub_menu_4");
var SubMenu5 = document.querySelector("#sub_menu_5");
var SubMenu6 = document.querySelector("#sub_menu_6");
//var randomSB = document.querySelector("#sub_menu_4");

function changeQsoSample(newTxtId) {
    var newTxt = document.querySelector("#" + newTxtId);
    //if (txt == newTxt) return;

    var txtCaption = document.querySelector("#" + txt.id + "_caption");
    var newTxtCaption = document.querySelector("#" + newTxtId + "_caption");
    if (!txtCaption || !newTxtCaption) return;
    
    if (!stopped) stop.click();
    cursorFrom = null;
    
    txt.style.display = "none";
    txtCaption.style.display = "none";
    
    txt = newTxt;
    txtCaption = newTxtCaption;
    
    txt.style.display = "block";
    txtCaption.style.display = "block";
    
    txt.classList.toggle('active');
    cm = txt.CodeMirror;
    doc = cm.doc;
    cm.refresh();

    window.localStorage.setItem('qso_sample', newTxtId);
    window.localStorage.setItem('user_txt', userTxt.CodeMirror.doc.getValue());
}
hangulQso1.onclick = function() {
    changeQsoSample("hangul_txt_1");
}
userQso.onclick = function() {
    changeQsoSample("user_txt");
}

function getRepeatCount() {
    return parseInt(document.querySelector('input[name="repeat_count"]:checked').value);
}

//<span class="setting_bold">속도</span> <input type="number" id="speed" value="20" size="2" min="5" max="50" /> WPM

function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    let j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
    return ELEMENTS[j];
}
}

var pre_RSTS = [
        "귀국 신호는 ","현재 신호는 ","오엠님의 신호는 ",
        "그쪽 신호는 ","신호는 "
        ];
    var pre_RSTS_mid = [
        "리포트 감사합니다. 오엠님의 신호도 ","예 오엠님 리포트 감사합니다. 오엠님의 신호는 ",
        "예 잘 들었습니다. 귀국의 신호는 ","대구 신호는 ","광주 신호는 ","서울 신호는 ","부산 신호는 ","대전 신호는 ",
        ];

    var RST11S = ["559 559","559 55N"];
    var RST12S = [
        " 으로 좀 약하게 수신됩니다.",
        " 으로 약하게 들어옵니다.",
        
        ];
    var RST21S = ["569 56N", "56N 56N", "579 57N", "57N 57N", "589 58N", "58N 58N"];
    var RST22S = [
        " 으로 잘 수신됩니다.",
        " 으로 잘 들어옵니다.",
        " 으로 충분히 수신됩니다.",
        " 으로 깨끗하게 수신됩니다.",
        " 으로 깨끗하게 들어옵니다.",
        ];
    var RST31S = [
        "5NN 5NN 이상으로 아주 강력하게 수신됩니다.",
        "599 5NN 으로 수신됩니다.",
        "5NN 5NN 으로 잘 들어옵니다.",
        "599 5NN 으로 아주 잘 들어옵니다.",
        ];    


    var GREETINGS_1st = [
        "반갑습니다. 처음 뵙겠습니다. ",
        "안녕하십니까? 이렇게 불러주셔서 감사합니다. ",
        "오엠님 불러주셔서 감사합니다. ",
        "오엠님 안녕하십니까? 처음 뵙겠습니다. ",
        ];

        var GREETINGS_2nd = [
        "그동안 안녕하셨습니까? ",
        "그동안 잘 지내셨습니까? ",
        "안녕하십니까? 그동안 잘 지냈는지요? ",
        "안녕하십니까, 정말 오랜만에 뵙습니다. ",
        ];

    var pre_NAMES = ["저의 이름은 ","이름은 ",
        ];

        var NAME1S = ["신수아", "이서진", "임선우", "오윤호", "황현수", "염달수", "도윤후", "오연호","오승아","강태희","탁서우",
        "양진주","임미자","김명희","박승호","추만기","조우식","송수아","문문호","강홍주","표승혜","김지희","전희호","심형태","백세미",
        "장윤하","손은지","김정재","허윤미","박원자","추형주","심영화","오태호","탁병지","권경수","최용지","정형우","서소미","노연자",
        "예범주","서순재","남기호","조성주","조현미","설서우","고창우",   ];

        var NAME2S = ["김종민", "이도현", "박현준", "성재윤", "강지안", "서시원", "홍윤성","강효경","임원옥","하인경",
        "노채은","양승원","전해남","권정희","전성현","남시원","임연석","윤현민","백영숙","강희준","박윤진","조우식",
               "구태양", "성도율", "윤시율","한승빈","태유현", "차승찬", "안수영", "허규빈", "서도겸", "송윤찬",
               "이다빈","송하연","강서율","윤하영","윤예림","임설현","남해일","조남혁","표시현","홍영일","노진욱",
               "설광선","배용욱","유승윤","황정욱","예철진","설경옥",   ];                

    var inter_WORDS = ["? ", ", ", " "]
    var post_NAME1S = ["라고 합니다.", "입니다.",];
    var post_NAME2S = ["이라고 합니다.", "입니다.",];

    var FAMILYNAMES = ["김","박","이","조","신","임","성","강","서","홍","구","황","윤","한","태","차","안","허","도","송","권","심","노","고",];

    var pre_QTH1S = ["제가 사는 곳은 ", "저의 위치는 ","무선국의 위치는 ",];
    var pre_QTH2S = ["저는 ", "저는 현재 ", "저는 지금 ",]
    var QTHS = [
        "서울 종로","서울 중구","서울 성동","서울 동대문","서울 성북","서울 서대문","서울 마포","서울 용산","서울 영등포","서울 관악","서울 도봉","서울 강남","서울 강서","서울 은평","서울 동작","서울 구로","서울 강동","서울 중랑","서울 노원","서울 서초","서울 양천","서울 송파","서울 금천","서울 광진","서울 강북",
        "부산 동구","부산 중구","부산 서구","부산 영도","부산 부산진","부산 동래","부산 남구","부산 북구","부산 해운대","부산 사하","부산 금정","부산 강서","부산 연제","부산 수영","부산 사상","부산 기장",
        "수원","의정부","성남","부천","안양","광명","동두천","구리","평택","안산","과천","오산","하남","군포","의왕","시흥","고양","남양주","용인","이천","파주","김포","안성","화성","광주","포천","양주","여주","양평","가평","연천",
        "춘천","원주","강릉","속초","동해","태백","삼척","홍천","횡성","평창","정선","영월","양양","인제","고성","양구","화천","철원",
        "청주","충주","제천","청원","보은","옥천","영동","괴산","진천","음성","단양","증평",
        "천안","공주","서산","아산","보령","논산","계룡","당진","예산","홍성","청양","서천","부여","금산","태안",
        "전주","군산","남원","김제","정읍","익산","완주","부안","고창","순창","임실","장수","진안","무주",
        "목포","여수","순천","나주","광양","장성","담양","곡성","구례","고흥","보성","화순","함평","영광","무안","영암","강진","장흥","해남","완도","진도","신안",
        "김천","경주","안동","포항","구미","영주","영천","상주","경산","문경","고령","성주","칠곡","군위","예천","봉화","영양","의성","청도","청송","영덕","울진","울릉",
        "진주","창원","김해","밀양","통영","거제","사천","양산","함안","남해","고성","하동","산청","함양","거창","합천","의령","창녕",
        "제주","서귀포",
        "인천 중구","인천 동구","인천 미추홀","인천 남동","인천 서구","인천 부평","인천 계양","인천 연수","인천 강화","인천 옹진",
        "대구 중구","대구 동구","대구 서구","대구 남구","대구 북구","대구 수성","대구 달서","대구 달성",
        "광주 동구","광주 서구","광주 북구","광주 광산","광주 남구",
        "대전 대덕","대전 동구","대전 서구","대전 중구","대전 유성",
        "울산 중구","울산 남구","울산 동구","울산 북구","울산 울주",
        "세종",
        "독도","마라도","흑산도","격렬비열도","백령도"
        ];

        var post_QTH1S = ["입니다."]
        var post_QTH2S = ["에 살고 있습니다.", "에 삽니다."]       

        var KDNS = [
        "A11","A12","A13","A14","A15","A16","A17","A18","A19","A20","A21","A22","A23","A24","A25","A26","A27","A28","A29","A30","A31","A32","A33","A34","A35",
        "B11","B12","B13","B14","B15","B16","B17","B18","B19","B20","B21","B22","B23","B24","B25","B26",
        "C01","C03","C04","C05","C06","C07","C08","C010","C011","C012","C013","C014","C015","C016","C017","C018","C020","C021","C022","C023","C024","C025","C026","C027","C028","C029","C030","C031","C20","C21","C23",
        "D01","D02","D03","D04","D05","D06","D07","D12","D13","D15","D16","D17","D20","D21","D22","D23","D24","D25",
        "E01","E02","E03","E11","E12","E13","E14","E15","E16","E17","E20","E21",
        "F02","F03","F06","F07","F08","F09","F010","F011","F19","F20","F21","F23","F24","F25","F26",
        "G01","G02","G06","G07","G08","G09","G11","G15","G16","G18","G19","G21","G22","G23",
        "H02","H03","H04","H05","H09","H12","H13","H14","H15","H19","H20","H21","H23","H24","H25","H26","H27","H28","H29","H30","H31","H32",
        "K02","K03","K04","K05","K06","K07","K08","K09","K011","K012","K12","K13","K15","K16","K20","K22","K23","K25","K28","K31","K32","K33","K34",
        "L02","L07","L08","L09","L011","L012","L013","L014","L14","L18","L19","L21","L23","L24","L25","L26","L27","L28",
        "M01","M02",
        "N01","N02","N03","N05","N06","N07","N08","N09","N010","N011",
        "P01","P02","P03","P04","P05","P06","P07","P08",
        "Q01","Q02","Q03","Q04","Q05",
        "R01","R02","R03","R04","R05",
        "S01","S02","S03","S04","S05",
        "T01",
        "IS01","IS02","IS03","IS04","IS05"
        ];

        var TALKS = [
        "지난번에 건강이 좋지 않다고 하셔서 걱정이 됩니다. 요즘에는 건강이 어떠신지요? 저는 염려 덕분에 잘 지내고 있습니다.",
        "오랜만에 전신을 하다보니 오타가 많이 납니다. 최근에 패들도 새로 하나 구입했는데, 좀처럼 손에 익지 않네요.",
        "퇴직은 하셨는지요? 저는 작년에 퇴직하고 지금은 교신도 하고 그동안 못해 봤던 것을을 하나하나 하고 있습니다.",
        "요즘 전파상태가 많이 좋아졌습니다. 특히 28메가의 상태가 좋아서 거의 매일 전신으로 디엑스를 즐기고 있습니다.",
        "저는 얼마전에 하이밴드용의 안테나를 새로 하나 올렸습니다. 28메가의 상태가 좋아서 그쪽을 집중공략할 생각입니다."

        ];

        var FINAL1S_2nd = [
        "예, 오늘 날이 많이 춥습니다. 이곳 기온은 영하3도까지 내려갔습니다.",
        "잘 수신하였습니다. 요즘 많이 따뜻해졌네요, 낮기온이 거의 20도까지 올라갑니다.",
        "예, 낮에는 덥지만 밤에는 제법 서늘해졌습니다. 곧 가을이 오겠죠.",
        "예 그렇죠. 이곳도 제법 춥습니다. 낮에도 두꺼운 옷을 입어야 할 정도네요.",
        "그렇습니다. 이제 곧 크리스마스가 가까워옵니다. 어제는 눈도 왔습니다.",
        "잘 수신했습니다. 눈이 오니까 포근한 느낌도 드네요. 지금은 비가 내리고 있습니다.",
        "그렇네요. 내일부터 태풍이 온다고 해서 오늘 야기안테나를 내려뒀습니다.",
        "예, 여기도 바람 때문에 안테나가 많이 휘청거립니다. 걱정이 됩니다.",
        "그렇네요. 어제까지 더위 때문에 힘들었는데, 오늘 비가 오니 좀 나아졌습니다.",
        "예, 날씨가 상당히 좋습니다. 어디 야외에 가서 이동국 운용을 하면 좋겠습니다.",
        "잘 수신하였습니다. 날씨가 변덕스럽네요. 비가 왔다가 눈이 왔다가 하고 있습니다.",
        ];
    
        var FINAL2S_2nd = [
        "항상 건강하시기 바라며 종종 뵙도록 하겠습니다. 안녕히 계십시오.",
        "건강 유의하시기 바라며 근시일내에 또 뵙도록 하겠습니다. 감사합니다.",
        "오랜만에 교신 감사드립니다. 자주 뵈었으면 합니다. 안녕히 계십시오.",
        "교신 감사드립니다. 항상 건강하십시오. 또 뵙겠습니다, 안녕히 계십시오.",
        ];


        var ANSWERS = ["잘 수신하였습니다. 리포트 감사합니다.", "잘 수신하였습니다. 리포트 감사합니다.", "잘 들었습니다. 리포트 감사합니다.",]

        var pre_RIG1S = ["저는 ", "저는 현재 ", "저는 지금 ",];
        var pre_RIG3S = ["제가 사용하는 장비는 ", "현재 사용중인 무전기는 ", "사용하고 있는 트랜시버는 ",];

        var RIG1S = ["<KA> IC219D <KA> ", "<KA> IC240S <KA> ","<KA> IC425D <KA> ","<KA> TS590SG <KA> ","<KA> TS120S <KA> ","<KA> TS480SAT <KA> ",
            "<KA> TS690S <KA> ","<KA> TS140D <KA> ","<KA> TS530D <KA> ","<KA> FT5000MP <KA> ","<KA> FT9000MP <KA> ",
        ];
        var RIG2S = ["<KA> TS120 <KA> ","<KA> FT450 <KA> ","<KA> FT2000 <KA> ","<KA> TS830 <KA> ","<KA> TS130 <KA> ","<KA> TS820 <KA> ",
            "<KA> FT920 <KA> ","<KA> FT950 <KA> ","<KA> FT101 <KA> ","<KA> TS530 <KA> ","<KA> IC7300 <KA> ","<KA> IC7610 <KA> ",
        ];

        var post_RIG1S = ["를 사용하고 있습니다."];
        var post_RIG2S = ["을 사용하고 있습니다."];
        var post_RIG3S = ["입니다."];

        var pre_ANT1S = ["",];
        var pre_ANT3S = ["안테나는 ",];

        var ANT1S = ["루프안테나", "쿼드안테나", "역브이안테나", "수직안테나", "야기안테나"];
        var ANT2S = ["다이폴", "헥사빔", "그라운드플랜", ];        

        var post_ANT1S = ["를 사용하고 있습니다."];
        var post_ANT2S = ["을 사용하고 있습니다."];
        var post_ANT3S = ["입니다."];

        var TNXS = [
        "오늘 교신 대단히 감사합니다.",
        "첫교신 대단히 감사합니다.",
        "처음 뵙게되어 반가웠습니다. 교신 감사합니다.",
        "이렇게 뵙게되어 반가웠습니다. 교신 감사합니다."
        ];

        var QSLS = [
        "카드는 연맹을 통해서 보내드리겠습니다.",
        "카드는 연맹을 경유해서 보내드리겠습니다.",
        "교신카드는 직접 댁으로 보내드리겠습니다.",
        "교신증명카드를 우편으로 보내겠습니다.",
        "저는 아직 카드가 없습니다. 준비되는대로 보내드리겠습니다.",
        "곧 카드를 인쇄하는데요, 제작이 완료되면 우편으로 보내드리겠습니다.",
        "보잘것없는 카드이지만 한장 보내드리겠습니다.",
        "현재 카드가 모두 소진되어 다음에 보내드리겠습니다.",
        ];

SubMenu1.onclick = function() {
    stop.click();        

    var TXS = ["START_1st", "START_2nd", "MID_1st", "FINAL_1st", "FINAL_2nd"];
        TXS.sort(() => Math.random() - 0.5);    
        TXS.sort(() => Math.random() - 0.2);
        TXS.sort(() => Math.random() - 0.7);
 
    var TX = TXS[Math.floor(Math.random() * TXS.length)];
    //var TX = TXS[0];

    if (TX === "START_1st") {  // 첫 교신의 시작 부분
        phrases = generateSTART_1st();
      
    }else if (TX === "START_2nd") {  // 두,세번째 교신의 시작 부분
        phrases = generateSTART_2nd();     
        
    }else if (TX === "MID_1st") {
        phrases = generateMID_1st();

    }else if (TX === "MID_2nd") {
        

    }else if (TX === "FINAL_1st") {
        phrases = generateFINAL_1st();

    }else if (TX === "FINAL_2nd") {
        phrases = generateFINAL_2nd();
    };

    doc.setValue(phrases.join(" ")
//    + "                                                                                    \n"
//    + "\n"     
//    + "- 새로운 내용\n"
//    + "1. WX IS FINE\n"
//    + "2. QSY UP2\n"
    );       
}

function generateSTART_1st() {
            var phrase = [];
            var phrases = [];
            var Callsign1 = generateHLCallsigns(1, 1);
            var Callsign2 = generateHLCallsigns(1, 1);
            var greeting_1st = GREETINGS_1st[Math.floor(Math.random() * GREETINGS_1st.length)];
            var pre_rst = pre_RSTS[Math.floor(Math.random() * pre_RSTS.length)];
            var rst = generateRST();
            var pre_name = pre_NAMES[Math.floor(Math.random() * pre_NAMES.length)];
            var name1 = NAME1S[Math.floor(Math.random() * NAME1S.length)];
            var name2 = NAME2S[Math.floor(Math.random() * NAME2S.length)];
            var name = (Math.random() > 0.5 ? name1 : name2);
            var inter_word = inter_WORDS[Math.floor(Math.random() * inter_WORDS.length)];
            var post_name1 = post_NAME1S[Math.floor(Math.random() * post_NAME1S.length)];
            var post_name2 = post_NAME2S[Math.floor(Math.random() * post_NAME2S.length)];
            if (name === name1) {
                var post_name = post_name1;
            }else {
                var post_name = post_name2;
            }

            var pre_qth1 = pre_QTH1S[Math.floor(Math.random() * pre_QTH1S.length)];
            var pre_qth2 = pre_QTH2S[Math.floor(Math.random() * pre_QTH2S.length)];
            var pre_qth = (Math.random() > 0.5 ? pre_qth1 : pre_qth2);
            var random_no = Math.floor(Math.random() * 225)
            var qth = QTHS[random_no];
            var post_qth1 = post_QTH1S[Math.floor(Math.random() * post_QTH1S.length)];
            var post_qth2 = post_QTH2S[Math.floor(Math.random() * post_QTH2S.length)];
            if (pre_qth === pre_qth1) {
                var post_qth = post_qth1;
            }else {
                var post_qth = post_qth2;
            }
            var kdn = KDNS[random_no];

            phrase = Callsign1 + " DE " + Callsign2 + " <KA> " + greeting_1st + (Math.random() > 0.5 ? "<BT> " : " " ) + pre_rst + rst;
            phrases.push(phrase);
            phrase = (Math.random() > 0.5 ? " <BT> " : " " ) + pre_name + name + inter_word + name + post_name;
            phrases.push(phrase);

            phrase = (Math.random() > 0.5 ? " <BT> " : " " ) + pre_qth + qth + inter_word + qth + post_qth;
            phrases.push(phrase);

            phrase = " 그리고 " + (Math.random() > 0.5 ? "<KA> KDN  " : "<KA> KDN KDN  " ) + kdn + inter_word + " " + kdn + " <KA> 입니다.";
            phrase = (Math.random() > 0.5 ? phrase : "");
            phrases.push(phrase);

            phrase = (Math.random() > 0.5 ? "<KA> " : "<AR> " ) + Callsign1 + " DE " + Callsign2 + (Math.random() > 0.5 ? " K" : " KN" );
            phrases.push(phrase);
            return phrases;    
}

function generateSTART_2nd() {
            var phrase = [];
            var phrases = [];
            var Callsign1 = generateHLCallsigns(1, 1);
            var Callsign2 = generateHLCallsigns(1, 1);
            var familyname = FAMILYNAMES[Math.floor(Math.random() * FAMILYNAMES.length)];
            familyname = familyname + (Math.random() > 0.5 ? "선생님 " : "오엠님 " );
            familyname = (Math.random() > 0.5 ? familyname : "오엠님 " );
            var greeting_2nd = GREETINGS_2nd[Math.floor(Math.random() * GREETINGS_2nd.length)];
            var talk = TALKS[Math.floor(Math.random() * TALKS.length)];

            phrase = Callsign1 + " DE " + Callsign2 + " <KA> " + familyname + greeting_2nd + (Math.random() > 0.5 ? "<BT>" : "" );
            phrases.push(phrase);

            phrase = talk;
            phrases.push(phrase);

            phrase = (Math.random() > 0.5 ? "<KA> " : "<AR> " ) + Callsign1 + " DE " + Callsign2 + (Math.random() > 0.5 ? " K" : " KN" );
            phrases.push(phrase); 
            return phrases;
}

function generateMID_1st() {
            var phrase = [];
            var phrases = [];
            var Callsign1 = generateHLCallsigns(1, 1);
            var Callsign2 = generateHLCallsigns(1, 1);

            var familyname = FAMILYNAMES[Math.floor(Math.random() * FAMILYNAMES.length)];
            familyname = familyname + (Math.random() > 0.5 ? "선생님 " : "오엠님 " );
            familyname = (Math.random() > 0.5 ? familyname : "오엠님 " );

            var answer = ANSWERS[Math.floor(Math.random() * ANSWERS.length)];

            var pre_rig1 = pre_RIG1S[Math.floor(Math.random() * pre_RIG1S.length)];
            var pre_rig3 = pre_RIG3S[Math.floor(Math.random() * pre_RIG3S.length)];
            var pre_rig = (Math.random() > 0.5 ? pre_rig1 : pre_rig3);

            var rig1 = RIG1S[Math.floor(Math.random() * RIG1S.length)];
            var rig2 = RIG2S[Math.floor(Math.random() * RIG2S.length)];
            var rig = (Math.random() > 0.5 ? rig1 : rig2);

            var post_rig1 = post_RIG1S[Math.floor(Math.random() * post_RIG1S.length)];
            var post_rig2 = post_RIG2S[Math.floor(Math.random() * post_RIG2S.length)];
            var post_rig3 = post_RIG3S[Math.floor(Math.random() * post_RIG3S.length)]
            if (pre_rig === pre_rig1) {
                if (rig = rig1) {
                    var post_rig = post_rig1;
                } else {
                    var post_rig = post_rig2;
                }
            }else {
                var post_rig = post_rig3;
            }

            var pre_ant1 = pre_ANT1S[Math.floor(Math.random() * pre_ANT1S.length)];
            var pre_ant3 = pre_ANT3S[Math.floor(Math.random() * pre_ANT3S.length)];
            var pre_ant = (Math.random() > 0.5 ? pre_ant1 : pre_ant3);

            var ant1 = ANT1S[Math.floor(Math.random() * ANT1S.length)];
            var ant2 = ANT2S[Math.floor(Math.random() * ANT2S.length)];
            var ant = (Math.random() > 0.5 ? ant1 : ant2);

            var post_ant1 = post_ANT1S[Math.floor(Math.random() * post_ANT1S.length)];
            var post_ant2 = post_ANT2S[Math.floor(Math.random() * post_ANT2S.length)];
            var post_ant3 = post_ANT3S[Math.floor(Math.random() * post_ANT3S.length)]
            if (pre_ant === pre_ant1) {
                if (ant = ant1) {
                    var post_ant = post_ant1;
                } else {
                    var post_ant = post_ant2;
                }
            }else {
                var post_ant = post_ant3;
            }
            
            phrase = Callsign1 + " DE " + Callsign2 + " <KA>" + (Math.random() > 0.5 ? " <BT>" : "" );
            phrases.push(phrase);
            phrase = (Math.random() > 0.5 ? "예 " : "" ) + familyname + answer + (Math.random() > 0.5 ? " <BT> " : " " ) + pre_rig + rig + post_rig;
            phrases.push(phrase);
            
            phrase = " 그리고 " + pre_ant + ant + post_ant;
            phrases.push(phrase);

            phrase = (Math.random() > 0.5 ? "<KA> " : "<AR> " ) + Callsign1 + " DE " + Callsign2 + (Math.random() > 0.5 ? " K" : " KN" );
            phrases.push(phrase);
            return phrases;            
}

function generateFINAL_1st() {
            var phrase = [];
            var phrases = [];
            var Callsign1 = generateHLCallsigns(1, 1);
            var Callsign2 = generateHLCallsigns(1, 1);
            var tnx = TNXS[Math.floor(Math.random() * TNXS.length)];
            var qsl = QSLS[Math.floor(Math.random() * QSLS.length)];

            var familyname = FAMILYNAMES[Math.floor(Math.random() * FAMILYNAMES.length)];
            familyname = familyname + (Math.random() > 0.5 ? "선생님 " : "오엠님 " );
            familyname = (Math.random() > 0.5 ? familyname : "오엠님 " );

            phrase = Callsign1 + " DE " + Callsign2 + " <KA>";
            phrases.push(phrase);
            phrase = (Math.random() > 0.5 ? "<BT> " : "" ) + familyname + tnx + (Math.random() > 0.5 ? " <BT> " : "  " ) + qsl;
            phrases.push(phrase);

            phrase = (Math.random() > 0.5 ? "<KA> " : "<AR> " ) + Callsign1 + " DE " + Callsign2 + (Math.random() > 0.5 ? " 73 <SK> E E" : " 73 TU <SK> E E" );
            phrases.push(phrase);
            return phrases;            
}

function generateFINAL_2nd() {
            var phrase = [];
            var phrases = [];
            var Callsign1 = generateHLCallsigns(1, 1);
            var Callsign2 = generateHLCallsigns(1, 1);
            var final1 = FINAL1S_2nd[Math.floor(Math.random() * FINAL1S_2nd.length)];
            var final2 = FINAL2S_2nd[Math.floor(Math.random() * FINAL2S_2nd.length)];

            var familyname = FAMILYNAMES[Math.floor(Math.random() * FAMILYNAMES.length)];
            familyname = familyname + (Math.random() > 0.5 ? "선생님 " : "오엠님 " );
            familyname = (Math.random() > 0.5 ? familyname : "오엠님 " );



            phrase = Callsign1 + " DE " + Callsign2 + " <KA>" + (Math.random() > 0.5 ? " <BT> " : " " ) + final1;
            phrases.push(phrase);
            phrase = (Math.random() > 0.5 ? "<BT> " : " " ) + familyname + final2;
            phrases.push(phrase);

            phrase = (Math.random() > 0.5 ? "<KA> " : "<AR> " ) + Callsign1 + " DE " + Callsign2 + (Math.random() > 0.5 ? " 73 <SK> E E" : " 73 TU <SK> E E" );
            phrases.push(phrase);
            return phrases;            
}

function generateRST() {

    var RSTS = [];
    var rst11 = RST11S[Math.floor(Math.random() * RST11S.length)];
    var rst12 = RST12S[Math.floor(Math.random() * RST12S.length)];
    var rst1 = rst11 + rst12;
    RSTS.push(rst1);
    var rst21 = RST21S[Math.floor(Math.random() * RST21S.length)];
    var rst22 = RST22S[Math.floor(Math.random() * RST22S.length)];
    var rst2 = rst21 + rst22;
    RSTS.push(rst2);
    var rst3 = RST31S[Math.floor(Math.random() * RST31S.length)];
    RSTS.push(rst3);

    var rst = RSTS[Math.floor(Math.random() * RSTS.length)];
    return rst;
}

function generateSuffix(length) {
    var ALPHABET = "ABCDEFFFGHIJKMNLOPQRSTUUVVVWWXZ";
    var result = ALPHABET[Math.floor(Math.random() * ALPHABET.length)];
    for (var i = 1; i < length; i++) {
        result += ALPHABET[Math.floor(Math.random() * ALPHABET.length)];
    }
    //result += (Math.random() > 0.5 ? "/QRP" : "");
    return result;
}

function getRepeatCount() {
    return parseInt(document.querySelector('input[name="repeat_count"]:checked').value);
}
function generateHLCallsigns(count, repeatCount) {
    var callsigns = [];
    var PREFIX = [
        "HL1", "HL2", "HL3", "HL4", "HL5",
        "DS1", "DS2", "DS3", "DS4", "DS5", //"DS0",
        "6K2", "6K5", "6L5"
        ];
    for (var i = 0; i < count; i++) {
        var prefix = PREFIX[Math.floor(Math.random() * PREFIX.length)];
        var suffixLength = (prefix.startsWith("HL") || prefix.startsWith("DS0") ? (Math.random() > 0.2 ? 3 : 2) : 3);
        var callsign = prefix + generateSuffix(suffixLength);
        callsigns.push(Array(repeatCount).fill(callsign).join(" "));
    }
    return callsigns;
}

</script>
</html>
