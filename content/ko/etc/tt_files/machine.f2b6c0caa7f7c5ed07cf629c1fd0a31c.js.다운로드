/*! For license information please see machine.js.LICENSE.txt */
(function(){"use strict";var __webpack_modules__={437:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(26);var a;!function(e){function t(e){let r=n.findChildrenByType(e,"term").map((e=>n.findChildrenByType(e,"literal").concat(n.findChildrenByType(e,"rule-name"))[0].text));return n.findChildrenByType(e,"list").forEach((e=>{r=r.concat(t(e))})),r}function r(r,i=e.defaultParser){let a=i.getAST(r);if(!a)throw new Error("Could not parse "+r);if(a.errors&&a.errors.length)throw a.errors[0];let o=n.findChildrenByType(a,"rule").map((e=>{let r=n.findChildrenByType(e,"rule-name")[0].text,i=n.findChildrenByType(e,"firstExpression").concat(n.findChildrenByType(e,"otherExpression")),a=[];return i.forEach((e=>{a.push(t(e))})),{name:r,bnf:a}}));return o.some((e=>"EOL"==e.name))||o.push({name:"EOL",bnf:[['"\\r\\n"','"\\r"','"\\n"']]}),o}e.RULES=[{name:"syntax",bnf:[["RULE_EOL*","rule+"]]},{name:"rule",bnf:[['" "*','"<"',"rule-name",'">"','" "*','"::="',"firstExpression","otherExpression*",'" "*',"RULE_EOL+",'" "*']]},{name:"firstExpression",bnf:[['" "*',"list"]]},{name:"otherExpression",bnf:[['" "*','"|"','" "*',"list"]]},{name:"RULE_EOL",bnf:[['"\\r"'],['"\\n"']]},{name:"list",bnf:[["term",'" "*',"list"],["term"]]},{name:"term",bnf:[["literal"],['"<"',"rule-name",'">"']]},{name:"literal",bnf:[["'\"'","RULE_CHARACTER1*","'\"'"],['"\'"',"RULE_CHARACTER2*",'"\'"']]},{name:"RULE_CHARACTER",bnf:[['" "'],["RULE_LETTER"],["RULE_DIGIT"],["RULE_SYMBOL"]]},{name:"RULE_LETTER",bnf:[['"A"'],['"B"'],['"C"'],['"D"'],['"E"'],['"F"'],['"G"'],['"H"'],['"I"'],['"J"'],['"K"'],['"L"'],['"M"'],['"N"'],['"O"'],['"P"'],['"Q"'],['"R"'],['"S"'],['"T"'],['"U"'],['"V"'],['"W"'],['"X"'],['"Y"'],['"Z"'],['"a"'],['"b"'],['"c"'],['"d"'],['"e"'],['"f"'],['"g"'],['"h"'],['"i"'],['"j"'],['"k"'],['"l"'],['"m"'],['"n"'],['"o"'],['"p"'],['"q"'],['"r"'],['"s"'],['"t"'],['"u"'],['"v"'],['"w"'],['"x"'],['"y"'],['"z"']]},{name:"RULE_DIGIT",bnf:[['"0"'],['"1"'],['"2"'],['"3"'],['"4"'],['"5"'],['"6"'],['"7"'],['"8"'],['"9"']]},{name:"RULE_SYMBOL",bnf:[['"-"'],['"_"'],['"!"'],['"#"'],['"$"'],['"%"'],['"&"'],['"("'],['")"'],['"*"'],['"+"'],['","'],['"-"'],['"."'],['"/"'],['":"'],['";"'],['"<"'],['"="'],['">"'],['"?"'],['"@"'],['"["'],['"\\"'],['"]"'],['"^"'],['"_"'],['"`"'],['"{"'],['"|"'],['"}"'],['"~"']]},{name:"RULE_CHARACTER1",bnf:[["RULE_CHARACTER"],['"\'"']]},{name:"RULE_CHARACTER2",bnf:[["RULE_CHARACTER"],["'\"'"]]},{name:"rule-name",bnf:[["RULE_LETTER","RULE_CHAR*"]]},{name:"RULE_CHAR",bnf:[["RULE_LETTER"],["RULE_DIGIT"],['"_"'],['"-"']]}],e.defaultParser=new i.Parser(e.RULES,{debug:!1}),e.getRules=r,e.Transform=function(t,n=e.defaultParser){return r(t.join(""),n)};class a extends i.Parser{constructor(t,n){super(r(t,n&&!0===n.debugRulesParser?new i.Parser(e.RULES,{debug:!0}):e.defaultParser),n),this.source=t}emitSource(){return this.source}}e.Parser=a}(a||(a={})),t.default=a},667:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});const n=r(466),i=r(26);var a;!function(e){e.RULES=[{name:"Grammar",bnf:[["RULE_S*","Attributes?","RULE_S*","%Atomic*","EOF"]]},{name:"%Atomic",bnf:[["Production","RULE_S*"]],fragment:!0},{name:"Production",bnf:[["NCName","RULE_S*",'"::="',"RULE_WHITESPACE*","%Choice","RULE_WHITESPACE*","Attributes?","RULE_EOL+","RULE_S*"]]},{name:"NCName",bnf:[[/[a-zA-Z][a-zA-Z_0-9]*/]]},{name:"Attributes",bnf:[['"{"',"Attribute","%Attributes*","RULE_S*",'"}"']]},{name:"%Attributes",bnf:[["RULE_S*",'","',"Attribute"]],fragment:!0},{name:"Attribute",bnf:[["RULE_S*","NCName","RULE_WHITESPACE*",'"="',"RULE_WHITESPACE*","AttributeValue"]]},{name:"AttributeValue",bnf:[["NCName"],[/[1-9][0-9]*/]]},{name:"%Choice",bnf:[["SequenceOrDifference","%_Choice_1*"]],fragment:!0},{name:"%_Choice_1",bnf:[["RULE_S*",'"|"',"RULE_S*","SequenceOrDifference"]],fragment:!0},{name:"SequenceOrDifference",bnf:[["%Item","RULE_WHITESPACE*","%_Item_1?"]]},{name:"%_Item_1",bnf:[["Minus","%Item"],["%Item*"]],fragment:!0},{name:"Minus",bnf:[['"-"']]},{name:"%Item",bnf:[["RULE_WHITESPACE*","PrimaryPreDecoration?","%Primary","PrimaryDecoration?"]],fragment:!0},{name:"PrimaryDecoration",bnf:[['"?"'],['"*"'],['"+"']]},{name:"PrimaryPreDecoration",bnf:[['"&"'],['"!"'],['"~"']]},{name:"%Primary",bnf:[["NCName"],["StringLiteral"],["CharCode"],["CharClass"],["SubItem"]],fragment:!0},{name:"SubItem",bnf:[['"("',"RULE_S*","%Choice","RULE_S*",'")"']]},{name:"StringLiteral",bnf:[["'\"'",/[^"]*/,"'\"'"],['"\'"',/[^']*/,'"\'"']]},{name:"CharCode",bnf:[['"#x"',/[0-9a-zA-Z]+/]]},{name:"CharClass",bnf:[["'['","'^'?","%RULE_CharClass_1+",'"]"']]},{name:"%RULE_CharClass_1",bnf:[["CharCodeRange"],["CharRange"],["CharCode"],["RULE_Char"]],fragment:!0},{name:"RULE_Char",bnf:[[/\x09/],[/\x0A/],[/\x0D/],[/[\x20-\x5c]/],[/[\x5e-\uD7FF]/],[/[\uE000-\uFFFD]/]]},{name:"CharRange",bnf:[["RULE_Char",'"-"',"RULE_Char"]]},{name:"CharCodeRange",bnf:[["CharCode",'"-"',"CharCode"]]},{name:"RULE_WHITESPACE",bnf:[["%RULE_WHITESPACE_CHAR*"],["Comment","RULE_WHITESPACE*"]]},{name:"RULE_S",bnf:[["RULE_WHITESPACE","RULE_S*"],["RULE_EOL","RULE_S*"]]},{name:"%RULE_WHITESPACE_CHAR",bnf:[[/\x09/],[/\x20/]],fragment:!0},{name:"Comment",bnf:[['"/*"',"%RULE_Comment_Body*",'"*/"']]},{name:"%RULE_Comment_Body",bnf:[[/[^*]/],['"*"+',/[^/]*/]],fragment:!0},{name:"RULE_EOL",bnf:[[/\x0D/,/\x0A/],[/\x0A/],[/\x0D/]]},{name:"Link",bnf:[["'['","Url","']'"]]},{name:"Url",bnf:[[/[^\x5D:/?#]/,'"://"',/[^\x5D#]+/,"%Url1?"]]},{name:"%Url1",bnf:[['"#"',"NCName"]],fragment:!0}],e.defaultParser=new i.Parser(e.RULES,{debug:!1});const t=/^(!|&)/,r=/(\?|\+|\*)$/,a=/^%/;function o(e,n){if("string"==typeof e){let o=r.exec(e),l=t.exec(e),c=l?l[0]:"",u=o?o[0]+" ":"";if(a.test(e)){let t=function(e,t){let r=i.findRuleByName(e,t);return r&&1==r.bnf.length&&1==r.bnf[0].length&&(r.bnf[0][0]instanceof RegExp||'"'==r.bnf[0][0][0]||"'"==r.bnf[0][0][0])}(e,n);return t?c+s(e,n)+u:c+"("+s(e,n)+")"+u}return e.replace(t,c)}return e.source.replace(/\\(?:x|u)([a-zA-Z0-9]+)/g,"#x$1").replace(/\[\\(?:x|u)([a-zA-Z0-9]+)-\\(?:x|u)([a-zA-Z0-9]+)\]/g,"[#x$1-#x$2]")}function s(e,t){let r=i.findRuleByName(e,t);return r?r.bnf.map((e=>function(e,t){return e.map((e=>o(e,t))).join(" ")}(e,t))).join(" | "):"RULE_NOT_FOUND {"+e+"}"}function l(e){let t=[];return e.grammarRules.forEach((r=>{if(!/^%/.test(r.name)){let n=r.recover?" { recoverUntil="+r.recover+" }":"";t.push(r.name+" ::= "+s(r.name,e)+n)}})),t.join("\n")}e.emit=l;let c=0;function u(e){return new RegExp(e.replace(/#x([a-zA-Z0-9]{4})/g,"\\u$1").replace(/#x([a-zA-Z0-9]{3})/g,"\\u0$1").replace(/#x([a-zA-Z0-9]{2})/g,"\\x$1").replace(/#x([a-zA-Z0-9]{1})/g,"\\x0$1"))}function h(e,t,r,n){let a=null,o=[];return t.children.forEach(((s,l)=>{"Minus"==s.type&&function(e,t){throw console.log("reberia restar "+t+" a "+e),new Error("Difference not supported yet")}(a,s);let h=t.children[l+1];h=h&&"PrimaryDecoration"==h.type&&h.text||"";let f="";a&&"PrimaryPreDecoration"==a.type&&(f=a.text);let p="~"==f?1:void 0;switch(p&&(f=""),s.type){case"SubItem":let t="%"+(r+c++);d(e,s,t,n),o.push(f+t+h);break;case"NCName":o.push(f+s.text+h);break;case"StringLiteral":if(h||f||!/^['"/()a-zA-Z0-9&_.:=,+*\-\^\\]+$/.test(s.text))o.push(f+s.text+h);else for(const e of s.text.slice(1,-1))n&&"true"==n.ignoreCase&&/[a-zA-Z]/.test(e)?o.push(new RegExp("["+e.toUpperCase()+e.toLowerCase()+"]")):o.push(new RegExp(i.escapeRegExp(e)));break;case"CharCode":case"CharClass":if(h||f){let t={name:"%"+(r+c++),bnf:[[u(s.text)]],pinned:p};e.push(t),o.push(f+t.name+h)}else o.push(u(s.text));break;case"PrimaryPreDecoration":case"PrimaryDecoration":break;default:throw new Error(" HOW SHOULD I PARSE THIS? "+s.type+" -> "+JSON.stringify(s.text))}a=s})),o}function d(e,t,r,i=void 0){let a=t.children.filter((e=>"Attributes"==e.type))[0],o={};a&&a.children.forEach((e=>{let t=e.children.filter((e=>"NCName"==e.type))[0].text;if(t in o)throw new n.TokenError("Duplicated attribute "+t,e);o[t]=e.children.filter((e=>"AttributeValue"==e.type))[0].text}));let s=t.children.filter((e=>"SequenceOrDifference"==e.type)).map((t=>h(e,t,r,i||o))),l={name:r,bnf:s};if(0==r.indexOf("%")&&(l.fragment=!0),o.recoverUntil&&(l.recover=o.recoverUntil,l.bnf.length>1))throw new n.TokenError("only one-option productions are suitable for error recovering",t);if("pin"in o){let e=parseInt(o.pin);if(isNaN(e)||(l.pinned=e),l.bnf.length>1)throw new n.TokenError("only one-option productions are suitable for pinning",t)}l.implicitWs="ws"in o?"explicit"!=o.ws:null,l.fragment=l.fragment||"true"==o.fragment,l.simplifyWhenOneChildren="true"==o.simplifyWhenOneChildren,e.push(l)}function f(t,r=e.defaultParser){let i=r.getAST(t);if(!i)throw new Error("Could not parse "+t);if(i.errors&&i.errors.length)throw i.errors[0];let a=null,o=i.children.filter((e=>"Attributes"==e.type))[0],s={};o&&o.children.forEach((e=>{let t=e.children.filter((e=>"NCName"==e.type))[0].text;if(t in s)throw new n.TokenError("Duplicated attribute "+t,e);s[t]=e.children.filter((e=>"AttributeValue"==e.type))[0].text})),a="implicit"==s.ws;let l=[];return i.children.filter((e=>"Production"==e.type)).map((e=>{let t=e.children.filter((e=>"NCName"==e.type))[0].text;d(l,e,t)})),l.forEach((e=>{null===e.implicitWs&&(e.implicitWs=a)})),l}e.getRules=f,e.Transform=function(t,r=e.defaultParser){return f(t.join(""),r)};class p extends i.Parser{constructor(t,r){super(f(t,r&&!0===r.debugRulesParser?new i.Parser(e.RULES,{debug:!0}):e.defaultParser),r)}emitSource(){return l(this)}}e.Parser=p}(a||(a={})),t.default=a},68:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});const n=r(26);var i;!function(e){e.RULES=[{name:"Grammar",bnf:[["RULE_S*","%Atomic*","EOF"]]},{name:"%Atomic",bnf:[["Production","RULE_S*"]],fragment:!0},{name:"Production",bnf:[["NCName","RULE_S*",'"::="',"RULE_WHITESPACE*","Choice","RULE_WHITESPACE*","RULE_EOL+","RULE_S*"]]},{name:"NCName",bnf:[[/[a-zA-Z][a-zA-Z_0-9]*/]]},{name:"Choice",bnf:[["SequenceOrDifference","%_Choice_1*"]],fragment:!0},{name:"%_Choice_1",bnf:[["RULE_WHITESPACE*",'"|"',"RULE_WHITESPACE*","SequenceOrDifference"]],fragment:!0},{name:"SequenceOrDifference",bnf:[["Item","RULE_WHITESPACE*","%_Item_1?"]]},{name:"%_Item_1",bnf:[["Minus","Item"],["Item*"]],fragment:!0},{name:"Minus",bnf:[['"-"']]},{name:"Item",bnf:[["RULE_WHITESPACE*","%Primary","PrimaryDecoration?"]],fragment:!0},{name:"PrimaryDecoration",bnf:[['"?"'],['"*"'],['"+"']]},{name:"DecorationName",bnf:[['"ebnf://"',/[^\x5D#]+/]]},{name:"%Primary",bnf:[["NCName"],["StringLiteral"],["CharCode"],["CharClass"],["SubItem"]],fragment:!0},{name:"SubItem",bnf:[['"("',"RULE_WHITESPACE*","Choice","RULE_WHITESPACE*",'")"']]},{name:"StringLiteral",bnf:[["'\"'",/[^"]*/,"'\"'"],['"\'"',/[^']*/,'"\'"']],pinned:1},{name:"CharCode",bnf:[['"#x"',/[0-9a-zA-Z]+/]]},{name:"CharClass",bnf:[["'['","'^'?","%RULE_CharClass_1+",'"]"']]},{name:"%RULE_CharClass_1",bnf:[["CharCodeRange"],["CharRange"],["CharCode"],["RULE_Char"]],fragment:!0},{name:"RULE_Char",bnf:[[/\x09/],[/\x0A/],[/\x0D/],[/[\x20-\x5c]/],[/[\x5e-\uD7FF]/],[/[\uE000-\uFFFD]/]]},{name:"CharRange",bnf:[["RULE_Char",'"-"',"RULE_Char"]]},{name:"CharCodeRange",bnf:[["CharCode",'"-"',"CharCode"]]},{name:"RULE_WHITESPACE",bnf:[["%RULE_WHITESPACE_CHAR*"],["Comment","RULE_WHITESPACE*"]]},{name:"RULE_S",bnf:[["RULE_WHITESPACE","RULE_S*"],["RULE_EOL","RULE_S*"]]},{name:"%RULE_WHITESPACE_CHAR",bnf:[[/\x09/],[/\x20/]],fragment:!0},{name:"Comment",bnf:[['"/*"',"%RULE_Comment_Body*",'"*/"']]},{name:"%RULE_Comment_Body",bnf:[['!"*/"',/[^*]/]],fragment:!0},{name:"RULE_EOL",bnf:[[/\x0D/,/\x0A/],[/\x0A/],[/\x0D/]]},{name:"Link",bnf:[["'['","Url","']'"]]},{name:"Url",bnf:[[/[^\x5D:/?#]/,'"://"',/[^\x5D#]+/,"%Url1?"]]},{name:"%Url1",bnf:[['"#"',"NCName"]],fragment:!0}],e.defaultParser=new n.Parser(e.RULES,{debug:!1});const t=/^(!|&)/,r=/(\?|\+|\*)$/,i=/^%/;function a(e,a){if("string"==typeof e){if(t.test(e))return"";if(i.test(e)){let t=r.exec(e),i=t?t[0]+" ":"",s=function(e,t){let r=n.findRuleByName(e,t);return r&&1==r.bnf.length&&1==r.bnf[0].length&&(r.bnf[0][0]instanceof RegExp||'"'==r.bnf[0][0][0]||"'"==r.bnf[0][0][0])}(e,a);return s?o(e,a)+i:"("+o(e,a)+")"+i}return e}return e.source.replace(/\\(?:x|u)([a-zA-Z0-9]+)/g,"#x$1").replace(/\[\\(?:x|u)([a-zA-Z0-9]+)-\\(?:x|u)([a-zA-Z0-9]+)\]/g,"[#x$1-#x$2]")}function o(e,t){let r=n.findRuleByName(e,t);return r?r.bnf.map((e=>function(e,t){return e.map((e=>a(e,t))).join(" ")}(e,t))).join(" | "):"RULE_NOT_FOUND {"+e+"}"}function s(e){let t=[];return e.grammarRules.forEach((r=>{if(!/^%/.test(r.name)){let n=r.recover?" /* { recoverUntil="+r.recover+" } */":"";t.push(r.name+" ::= "+o(r.name,e)+n)}})),t.join("\n")}e.emit=s;let l=0;function c(e){return new RegExp(e.replace(/#x([a-zA-Z0-9]{4})/g,"\\u$1").replace(/#x([a-zA-Z0-9]{3})/g,"\\u0$1").replace(/#x([a-zA-Z0-9]{2})/g,"\\x$1").replace(/#x([a-zA-Z0-9]{1})/g,"\\x0$1"))}function u(e,t,r){let n=null,i=[];return t.children.forEach(((a,o)=>{"Minus"==a.type&&function(e,t){throw console.log("reberia restar "+t+" a "+e),new Error("Difference not supported yet")}(n,a);let s=t.children[o+1];s=s&&"PrimaryDecoration"==s.type&&s.text||"";switch(a.type){case"SubItem":let t="%"+(r+l++);h(e,a,t),i.push(""+t+s);break;case"NCName":case"StringLiteral":i.push(""+a.text+s);break;case"CharCode":case"CharClass":if(s){let t={name:"%"+(r+l++),bnf:[[c(a.text)]]};e.push(t),i.push(""+t.name+s)}else i.push(c(a.text));break;case"PrimaryDecoration":break;default:throw new Error(" HOW SHOULD I PARSE THIS? "+a.type+" -> "+JSON.stringify(a.text))}n=a})),i}function h(e,t,r){let n=t.children.filter((e=>"SequenceOrDifference"==e.type)).map((t=>u(e,t,r))),i={name:r,bnf:n},a=null;n.forEach((e=>{a=a||e.recover,delete e.recover})),0==r.indexOf("%")&&(i.fragment=!0),a&&(i.recover=a),e.push(i)}function d(t,r=e.defaultParser){let n=r.getAST(t);if(!n)throw new Error("Could not parse "+t);if(n.errors&&n.errors.length)throw n.errors[0];let i=[];return n.children.filter((e=>"Production"==e.type)).map((e=>{let t=e.children.filter((e=>"NCName"==e.type))[0].text;h(i,e,t)})),i}e.getRules=d,e.Transform=function(t,r=e.defaultParser){return d(t.join(""),r)};class f extends n.Parser{constructor(t,r){super(d(t,r&&!0===r.debugRulesParser?new n.Parser(e.RULES,{debug:!0}):e.defaultParser),r)}emitSource(){return s(this)}}e.Parser=f}(i||(i={})),t.default=i},457:function(e,t,r){var n=r(437);var i=r(68);Object.defineProperty(t,"W3C",{enumerable:!0,get:function(){return i.default}});var a=r(667)},26:function(__unused_webpack_module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.Parser=exports.findRuleByName=exports.parseRuleName=exports.escapeRegExp=exports.readToken=void 0;const UPPER_SNAKE_RE=/^[A-Z0-9_]+$/,decorationRE=/(\?|\+|\*)$/,preDecorationRE=/^(@|&|!)/,WS_RULE="WS",TokenError_1=__webpack_require__(466);function readToken(e,t){let r=t.exec(e);return r&&0==r.index?0==r[0].length&&t.source.length>0?null:{type:null,text:r[0],rest:e.substr(r[0].length),start:0,end:r[0].length-1,fullText:r[0],errors:[],children:[],parent:null}:null}function escapeRegExp(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function fixRest(e){e.rest="",e.children&&e.children.forEach((e=>fixRest(e)))}function fixPositions(e,t){e.start+=t,e.end+=t,e.children&&e.children.forEach((t=>fixPositions(t,e.start)))}function agregateErrors(e,t){t.errors&&t.errors.length&&t.errors.forEach((t=>e.push(t))),t.children&&t.children.forEach((t=>agregateErrors(e,t)))}function parseRuleName(e){let t=decorationRE.exec(e),r=preDecorationRE.exec(e),n=t&&t[0]||"",i=r&&r[0]||"",a={raw:e,name:e.replace(decorationRE,"").replace(preDecorationRE,""),isOptional:"?"==n||"*"==n,allowRepetition:"+"==n||"*"==n,atLeastOne:"+"==n,lookupPositive:"&"==i,lookupNegative:"!"==i,pinned:"@"==i,lookup:!1,isLiteral:!1};return a.isLiteral="'"==a.name[0]||'"'==a.name[0],a.lookup=a.lookupNegative||a.lookupPositive,a}function findRuleByName(e,t){let r=parseRuleName(e);return t.cachedRules[r.name]||null}function stripRules(e,t){if(e.children){let r=e.children.filter((e=>e.type&&t.test(e.type)));for(let t=0;t<r.length;t++){let n=e.children.indexOf(r[t]);-1!=n&&e.children.splice(n,1)}e.children.forEach((e=>stripRules(e,t)))}}exports.readToken=readToken,exports.escapeRegExp=escapeRegExp,exports.parseRuleName=parseRuleName,exports.findRuleByName=findRuleByName;const ignoreMissingRules=["EOF"];class Parser{constructor(e,t){this.grammarRules=e,this.options=t,this.cachedRules={},this.debug=!!t&&!0===t.debug;let r=[],n=[];if(e.forEach((e=>{let t=parseRuleName(e.name);if(t.name in this.cachedRules)r.push("Duplicated rule "+t.name);else{if(this.cachedRules[t.name]=e,e.bnf&&e.bnf.length)e.bnf.forEach((t=>{if("string"==typeof t[0]){if(parseRuleName(t[0]).name==e.name){let t="Left recursion is not allowed, rule: "+e.name;-1==r.indexOf(t)&&r.push(t)}}t.forEach((e=>{if("string"==typeof e){let t=parseRuleName(e);t.isLiteral||-1!=n.indexOf(t.name)||-1!=ignoreMissingRules.indexOf(t.name)||n.push(t.name)}}))}));else{let t="Missing rule content, rule: "+e.name;-1==r.indexOf(t)&&r.push(t)}WS_RULE==e.name&&(e.implicitWs=!1),e.implicitWs&&-1==n.indexOf(WS_RULE)&&n.push(WS_RULE),e.recover&&-1==n.indexOf(e.recover)&&n.push(e.recover)}})),n.forEach((e=>{e in this.cachedRules||r.push("Missing rule "+e)})),r.length)throw new Error(r.join("\n"))}getAST(e,t){t||(t=this.grammarRules.filter((e=>!e.fragment&&0!=e.name.indexOf("%")))[0].name);let r=this.parse(e,t);if(r){agregateErrors(r.errors,r),fixPositions(r,0),stripRules(r,/^%/),this.options&&this.options.keepUpperRules||stripRules(r,UPPER_SNAKE_RE);let e=r.rest;e&&new TokenError_1.TokenError("Unexpected end of input: \n"+e,r),fixRest(r),r.rest=e}return r}emitSource(){return"CANNOT EMIT SOURCE FROM BASE Parser"}parse(txt,target,recursion=0){let out=null,type=parseRuleName(target),expr,printable=this.debug&&!UPPER_SNAKE_RE.test(type.name);printable&&console.log(new Array(recursion).join("│  ")+"Trying to get "+target+" from "+JSON.stringify(txt.split("\n")[0]));let realType=type.name,targetLex=findRuleByName(type.name,this);if("EOF"==type.name){if(txt.length)return null;if(0==txt.length)return{type:"EOF",text:"",rest:"",start:0,end:0,fullText:"",errors:[],children:[],parent:null}}try{if(!targetLex&&type.isLiteral){let src=eval(type.name);if(""===src)return{type:"%%EMPTY%%",text:"",rest:txt,start:0,end:0,fullText:"",errors:[],children:[],parent:null};expr=new RegExp(escapeRegExp(src)),realType=null}}catch(e){return e instanceof ReferenceError&&console.error(e),null}if(expr){let e=readToken(txt,expr);if(e)return e.type=realType,e}else{let e=targetLex.bnf;e instanceof Array&&e.forEach((e=>{if(out)return;let t=null,r={type:type.name,text:"",children:[],end:0,errors:[],fullText:"",parent:null,start:0,rest:txt};targetLex.fragment&&(r.fragment=!0);let n=txt,i=0,a=e.length>0,o=!1;for(let s=0;s<e.length;s++)if("string"==typeof e[s]){let l,c=parseRuleName(e[s]);a=a&&c.isOptional;let u=!1;do{if(l=null,targetLex.implicitWs&&(l=this.parse(n,c.name,recursion+1),!l)){let e;do{if(e=this.parse(n,WS_RULE,recursion+1),!e)break;r.text=r.text+e.text,r.end=r.text.length,e.parent=r,r.children.push(e),n=n.substr(e.text.length),i+=e.text.length}while(e&&e.text.length)}if(l=l||this.parse(n,c.name,recursion+1),c.lookupNegative){if(l)return;break}if(c.lookupPositive&&!l)return;if(!l){if(c.isOptional)break;if(c.atLeastOne&&u)break}if(l&&targetLex.pinned==s+1&&(t=l,printable&&console.log(new Array(recursion+1).join("│  ")+"└─ "+l.type+" PINNED")),l||(l=this.parseRecovery(targetLex,n,recursion+1)),!l){if(!t)return;out=r,l={type:"SyntaxError",text:n,children:[],end:n.length,errors:[],fullText:"",parent:null,start:0,rest:""},n.length?new TokenError_1.TokenError(`Unexpected end of input. Expecting ${c.name} Got: ${n}`,l):new TokenError_1.TokenError(`Unexpected end of input. Missing ${c.name}`,l),printable&&console.log(new Array(recursion+1).join("│  ")+"└─ "+l.type+" "+JSON.stringify(l.text))}if(u=!0,o=!0,"%%EMPTY%%"==l.type)break;l.start+=i,l.end+=i,!c.lookupPositive&&l.type&&(l.fragment?l.children&&l.children.forEach((e=>{e.start+=i,e.end+=i,e.parent=r,r.children.push(e)})):(l.parent=r,r.children.push(l))),c.lookup&&(l.lookup=!0),printable&&console.log(new Array(recursion+1).join("│  ")+"└─ "+l.type+" "+JSON.stringify(l.text)),c.lookup||l.lookup||(r.text=r.text+l.text,r.end=r.text.length,n=n.substr(l.text.length),i+=l.text.length),r.rest=n}while(l&&c.allowRepetition&&n.length&&!l.lookup)}else{let t=readToken(n,e[s]);if(!t)return;printable&&console.log(new Array(recursion+1).join("│  ")+"└> "+JSON.stringify(t.text)+e[s].source),o=!0,t.start+=i,t.end+=i,r.text=r.text+t.text,r.end=r.text.length,n=n.substr(t.text.length),i+=t.text.length,r.rest=n}o&&(out=r,printable&&console.log(new Array(recursion).join("│  ")+"├<─┴< PUSHING "+out.type+" "+JSON.stringify(out.text)))})),out&&targetLex.simplifyWhenOneChildren&&1==out.children.length&&(out=out.children[0])}return out||printable&&console.log(target+" NOT RESOLVED FROM "+txt),out}parseRecovery(e,t,r){if(e.recover&&t.length){let n=this.debug;n&&console.log(new Array(r+1).join("│  ")+"Trying to recover until token "+e.recover+" from "+JSON.stringify(t.split("\n")[0]+t.split("\n")[1]));let i,a={type:"SyntaxError",text:"",children:[],end:0,errors:[],fullText:"",parent:null,start:0,rest:""};do{if(i=this.parse(t,e.recover,r+1),i){new TokenError_1.TokenError('Unexpected input: "'+a.text+`" Expecting: ${e.name}`,a);break}a.text=a.text+t[0],a.end=a.text.length,t=t.substr(1)}while(!i&&t.length>0);if(a.text.length>0&&i)return n&&console.log(new Array(r+1).join("│  ")+"Recovered text: "+JSON.stringify(a.text)),a}return null}}exports.Parser=Parser,exports.default=Parser},0:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.findChildrenByType=void 0,t.findChildrenByType=function(e,t){return e.children?e.children.filter((e=>e.type==t)):[]}},466:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.TokenError=void 0;class r extends Error{constructor(e,t){if(super(e),this.message=e,this.token=t,!t||!t.errors)throw this;t.errors.push(this)}inspect(){return"SyntaxError: "+this.message}}t.TokenError=r},735:function(e,t,r){var n=r(26);var i=r(466);t.Grammars=r(457)}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](r,r.exports,__webpack_require__),r.exports}var __webpack_exports__={};!function(){function e(e,t){t?function(e){e.attr("aria-pressed","true")}(e):function(e){e.attr("aria-pressed","false")}(e)}function t(e){return"true"===e.attr("aria-pressed")}function r(e,t){t?i(e):a(e)}function n(e){return!e.hasClass("disabled")}function i(e){e.removeClass("disabled"),e.attr("tabindex","0")}function a(e){e.addClass("disabled"),e.attr("tabindex","-1")}var o={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encLookup:[],init:function(){for(var e=0;e<4096;e++)this.encLookup[e]=this.chars[e>>6]+this.chars[63&e]},encode:function(e){for(var t,r=e.length,n="",i=0;r>2;)t=e[i]<<16|e[i+1]<<8|e[i+2],n+=this.encLookup[t>>12]+this.encLookup[4095&t],r-=3,i+=3;if(r>0){var a=(252&e[i])>>2,o=(3&e[i])<<4;if(r>1&&(o|=(240&e[++i])>>4),n+=this.chars[a],n+=this.chars[o],2==r){var s=(15&e[i++])<<2;s|=(192&e[i])>>6,n+=this.chars[s]}1==r&&(n+="="),n+="="}return n}};o.init();var s=window.Blob||window.WebkitBlob||window.MozBlob,l=window.URL||window.WebkitURL;function c(e,t,r){var n,i,a,c;c=!(arguments.length>3&&void 0!==arguments[3])||arguments[3]?new Uint8Array(e):e,"download"in HTMLAnchorElement.prototype&&void 0!==l&&"createObjectURL"in l?(n=new s([c],{type:t}),i=l.createObjectURL(n),(a=document.createElement("a")).href=i,a.download=r,setTimeout((function(){l.revokeObjectURL(a.href),a.remove()}),2e4),a.dispatchEvent(new MouseEvent("click"))):"msSaveBlob"in navigator?(n=new s([c],{type:t}),navigator.msSaveBlob(n,r)):(i=function(e,t){return"data:"+t+";base64,"+o.encode(e)}(e),(a=document.createElement("a")).href=i,a.download=r,a.dispatchEvent(new MouseEvent("click")),setTimeout((function(){a.remove()}),2e4))}function u(e){try{for(var t,r={},n=(e+"").split(""),i=[],a=n[0],o=256,s=1;s<n.length;s++)null!=r[a+(t=n[s])]?a+=t:(i.push(a.length>1?r[a]:a.charCodeAt(0)),r[a+t]=o,o++,a=t);i.push(a.length>1?r[a]:a.charCodeAt(0));for(var l=0;l<i.length;l++)i[l]=String.fromCharCode(i[l]);return c=i.join(""),window.btoa(unescape(encodeURIComponent(c)))}catch(e){return console.log("Failed to zip string return empty string",e),""}var c}function h(e){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h(e)}function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){p(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function p(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==h(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==h(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===h(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var m="MCW",g="shared",v={},y={},b={},S=$("#sequencePresets");S.on("change",(function(){!function(e){W(b[e],void 0,!0)}(S.find("option:selected").val())})),$(".exportSettings").on("click",(function(){var e=R(_()),t=window.location.pathname.split("/");t=t[t.length-1].split(".")[0],c(e,"text/json","".concat(t,"-settings.json"),!1)}));var A=$("#settingsFileUpload"),C=$("#settingsFileInput");function _(){return Object.keys(y).filter((function(e){return!e.startsWith("_")}))}function k(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.dictionary,n=void 0===r?g:r,i=t.key,a=t.value,o=JSON.parse(localStorage.getItem("".concat(m,".").concat(n))||"{}"),s=!1;if(void 0===i){var l={};for(i in a){var c=i;void 0!==v[n][i].alias&&(c=v[n][i].alias),l[c]=a[i],s|=o[c]!==a[i]}o=l}else{var u=i;void 0!==v[n][i].alias&&(u=v[n][i].alias);var h=o[u];o[u]=a,s=h!=a}return localStorage.setItem("".concat(m,".").concat(n),JSON.stringify(o)),s&&(e=function(){for(var e in b){var t=!0;e:for(var r in b[e]){var n=P({dictionary:r});for(var i in b[e][r])if(b[e][r][i]!==n[i]){t=!1;break e}}if(!0===t)return e}}()||"custom",S.val(e)),s}function P(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.dictionary,r=void 0===t?g:t,n=e.key,i=e.cookie,a=JSON.parse(localStorage.getItem("".concat(m,".").concat(r))||"{}");if(void 0===n)return a;var o=n;void 0!==v[r][n].alias&&(o=v[r][n].alias);var s=a[o];if(void 0===s){void 0===i&&(i=r);var l=Cookies.getJSON(i)||{};void 0!==(s=l[n])&&(k({key:n,value:s,dictionary:r}),delete l[n],Cookies.set(i,l,{expires:365}))}return void 0===s&&void 0!==(s=v[r][n].fallback)&&k({key:n,value:s,dictionary:r}),s}function w(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.dictionary,r=e.setValuesCallback,n=e.variables,i=e.comment,a=e.presets;for(var o in y[t]={comment:i,setValuesCallback:r},n)E(f({dictionary:t,key:o},n[o]));for(var s in a)x({key:s,presets:a[s]})}function E(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.dictionary,r=void 0===t?g:t,n=e.key,i=e.fallback,a=e.min,o=e.max,s=e.alias;r in v||(v[r]={}),v[r][n]={},void 0!==i&&(v[r][n].fallback=i),void 0!==a&&(v[r][n].min=a),void 0!==o&&(v[r][n].max=o),void 0!==s&&(v[r][n].alias=s)}function x(e){var t,r=e.key,n=e.presets,i={};for(var a in n)for(var o in i[a]={},n[a])t=v[a][o].alias||o,i[a][t]=n[a][o];var s=b[r]||{};s=f(f({},s),i),b[r]=s}function M(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];W(JSON.parse(e),t,r)}function W(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(var i in e)if(!(null!=t&&t.length>0)||t.includes(i)){for(var a=Object.keys(e[i]).filter((function(e){return e.startsWith("_")})),o=0,s=a.length;o<s;o++){var l=a[o];delete e[i][l]}r=n?f(f({},r=JSON.parse(localStorage.getItem("".concat(m,".").concat(i))||"{}")),e[i]):e[i],localStorage.setItem("".concat(m,".").concat(i),JSON.stringify(r)),void 0!==y[i].setValuesCallback&&y[i].setValuesCallback()}}function R(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r={},n=0,i=e.sort(),a=i.length;n<a;n++){for(var o=i[n],s=JSON.parse(localStorage.getItem("".concat(m,".").concat(o))),l=Object.keys(s).filter((function(e){return e.startsWith("_")})),c=0,u=l.length;c<u;c++){delete s[l[c]]}void 0!==y[o].comment&&t&&(s._=y[o].comment),s=Object.fromEntries(Object.entries(s).sort()),r[o]=s}return JSON.stringify(r,null,t?4:null)+"\n"}function O(e){var t=u(R(e,!1));t=encodeURIComponent(t);var r=new URL(window.location);return r.searchParams.set("settings",t),r}A.on("click",(function(){C.trigger("click")})),C.on("change",(function(e){var t=e.currentTarget.files[0],r=new FileReader;r.onload=function(e){M(e.target.result,_())},r.readAsText(t)})),$("#settingsLink").on("click",(function(){var e={title:"Settings",url:O(_())};try{navigator.share(e)}catch(e){console.log(e)}})),$("#settingsReset").on("click",(function(){!function(e){for(var t=0,r=e.length;t<r;t++){var n=e[t];localStorage.removeItem("".concat(m,".").concat(n)),y[n].setValuesCallback()}}(_())}));var T="_changelog";function L(e,t,r){if(1===r.length){for(var n=0;n<Math.min(t.length,5);n++)r.append("<li>"+t[n]+"</li>");if(t.length>5){var i=$("<button id='morseChangelog' class='small see-more'>See more</button>");r.after(i),i.on("click",(function(){$("#completeChangelogModal").foundation("reveal","open")}))}}var a=$('<div id="changelogModal" class="reveal-modal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog"><h2 id="modalTitle">Welcome back</h2><p class="lead">There have been some updates since you were last here:</p><ul></ul><p><em>If you are able and willing to support further development, please <a href="/donate.html">Donate</a></em></p><a class="close-reveal-modal" aria-label="Close">&#215;</a></div>');$("body").append(a);var o=$('<div id="completeChangelogModal" class="reveal-modal" data-reveal aria-labelledby="completeChangelogModalTitle" aria-hidden="true" role="dialog"><h2 id="completeChangelogModalTitle">Change Log</h2><ul></ul><a class="close-reveal-modal" aria-label="Close">&#215;</a></div>');$("body").append(o),r=$("#completeChangelogModal ul");for(var s=0,l=t.length;s<l;s++){var c=t[s];r.append("<li>"+c+"</li>")}!function(e,t,r){var n=P({dictionary:T,key:e,cookie:"changelog"});if(void 0!==n){var i=parseInt(n);if(i<t.length){for(var a=0;a<t.length-i;a++)r.find("ul").append("<li>"+t[a]+"</li>");r.foundation("reveal","open")}}k({dictionary:T,key:e,value:t.length})}(e,t,a)}function N(e){return N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},N(e)}function q(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,I(n.key),n)}}function I(e){var t=function(e,t){if("object"!==N(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==N(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===N(t)?t:String(t)}w({dictionary:T,variables:{"audio-decoder-adaptive":{},"audio-decoder":{},"character-trainer":{},generator:{},headlines:{},keyer:{},machine:{},"qso-trainer":{},trainer:{},translator:{},"word-trainer":{}}});var V=function(){function e(){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.AudioContext=window.AudioContext||window.webkitAudioContext,void 0===this.AudioContext)return this.hasAudioContext=!1,void console.log("Web Audio API unavailable");this.hasAudioContext=!0,this.sounds={},this._unlocked=!1;var t=navigator.userAgent.toLowerCase();this.isIOS=t.indexOf("iphone")>=0&&t.indexOf("like iphone")<0||t.indexOf("ipad")>=0&&t.indexOf("like ipad")<0||t.indexOf("ipod")>=0&&t.indexOf("like ipod")<0}var t,r,n;return t=e,r=[{key:"getAudioContext",value:function(){var e=this;return void 0!==this.audioContext?"running"===this.audioContext.state||this.audioContext.resume().then((function(){e.runUnlockedActions(1)})):(console.log("Creating AudioContext"),this.audioContext=new this.AudioContext,this.audioContext.createGain(),console.log("AudioContext state: ".concat(this.audioContext.state)),this.audioContext.resume().then((function(){e.runUnlockedActions(2)}))),this.audioContext}},{key:"runUnlockedActions",value:function(e){this._unlocked||(this._unlocked=!0,console.log("AudioContext unlocked (".concat(e,")")))}},{key:"playHTMLaudio",value:function(){console.log("Playing HTML audio");var e=document.createElement("div");e.innerHTML="<audio x-webkit-airplay='deny'></audio>";var t=e.children.item(0);t.controls=!1,t.disableRemotePlayback=!0,t.preload="auto",t.src="data:audio/mpeg;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA//////////////////////////////////////////////////////////////////8AAABhTEFNRTMuMTAwA8MAAAAAAAAAABQgJAUHQQAB9AAAAnGMHkkIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//sQxAADgnABGiAAQBCqgCRMAAgEAH///////////////7+n/9FTuQsQH//////2NG0jWUGlio5gLQTOtIoeR2WX////X4s9Atb/JRVCbBUpeRUq//////////////////9RUi0f2jn/+xDECgPCjAEQAABN4AAANIAAAAQVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQ==",t.loop=!0,t.load(),t.play()}},{key:"closeAudioContext",value:function(){void 0!==this.audioContext&&(this.audioContext.close(),this.audioContext=void 0)}},{key:"isUnlocked",value:function(){return this.audioContext&&"running"===this.audioContext.state}},{key:"loadSample",value:function(e,t){var r=this,n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){r.sounds[t]=n.response,r.decodeSample(t)},n.send()}},{key:"decodeSample",value:function(e){var t=this;this.getAudioContext().decodeAudioData(this.sounds[e],(function(r){t.sounds[e]=r}),(function(e){console.log("Error decoding audio data: "+e)}))}},{key:"getSounds",value:function(){return this.sounds}},{key:"init",value:function(){function e(){console.log("Starting audio via user interaction"),document.removeEventListener("mousedown",e),document.removeEventListener("touchend",e),j.getAudioContext()}this.hasAudioContext&&(document.addEventListener("mousedown",e),document.addEventListener("touchend",e))}}],r&&q(t.prototype,r),n&&q(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}(),j=new V,U=j;function F(e){return F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},F(e)}function D(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,H(n.key),n)}}function H(e){var t=function(e,t){if("object"!==F(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==F(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===F(t)?t:String(t)}var B=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.morseCWWave=t,this._rawInput=void 0,this.inputWasMorse=void 0,this.text=void 0,this.morse=void 0,this.tokens=void 0}var t,r,n;return t=e,r=[{key:"hasError",get:function(){return null===this.tokens||this.tokens.error}},{key:"translate",value:function(e,t){var r;if(void 0===t&&(t=this.morseCWWave.looksLikeMorse(e)),r=t?this.loadMorse(e):this.loadText(e),this.hasError)throw new Error("Error in input: ["+e+"]");return r}},{key:"_completeFields",value:function(e){this.tokens=e,this.text=this.morseCWWave.displayText(this.tokens),this.morse=this.morseCWWave.displayMorse(this.tokens)}},{key:"loadMorse",value:function(e){return this._rawInput=e,this.inputWasMorse=!0,this._completeFields(this.morseCWWave.loadMorse(e)),this.text}},{key:"loadText",value:function(e){return this._rawInput=e,this.inputWasMorse=!1,this._completeFields(this.morseCWWave.loadText(e)),this.morse}},{key:"cleanText",value:function(){return this._completeFields(this.morseCWWave.loadTextClean(this._rawInput)),this.text}},{key:"notes",get:function(){return this.getNotes()}},{key:"getNotes",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.morseCWWave.getNotes(this.tokens,e)}},{key:"sequence",get:function(){return this.getSequence()}},{key:"getSequence",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.morseCWWave.getSequence(this.tokens,e)}},{key:"timings",get:function(){return this.sequence.timings}},{key:"getTimings",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.getSequence(e).timings}},{key:"wave",get:function(){return this.morseCWWave.getSample(this.sequence)}},{key:"getWave",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.morseCWWave.getSample(this.getSequence(e))}},{key:"getSample",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.morseCWWave.getSample(this.getSequence(r),e,t)}},{key:"getInputErrorString",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.inputWasMorse?this.getMorseErrorString(e,t):this.getTextErrorString(e,t,r)}},{key:"getOutputErrorString",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.inputWasMorse?this.getTextErrorString(e,t,r):this.getMorseErrorString(e,t)}},{key:"getTextErrorString",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.morseCWWave.displayTextErrors(this.tokens,r,e,t)}},{key:"getMorseErrorString",value:function(e,t){return this.morseCWWave.displayMorseErrors(this.tokens,e,t)}}],r&&D(t.prototype,r),n&&D(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}(),G=__webpack_require__(735),Z={id:"international",letter:{"×":"- .t. -",A:". -",B:"- .t.t.",C:"- . - .",D:"- .t.",E:".",F:".t. - .",G:"-h- .",H:".t.t.t.",I:".t.",J:". -h-h-",K:"- . -",L:". - .t.",M:"-h-",N:"- .",O:"-h-h-",P:". -h- .",Q:"-h- . -",R:". - .",S:".t.t.",T:"-",U:".t. -",V:".t.t. -",W:". -h-",X:"- .t. -",Y:"- . -h-",Z:"-h- .t.",1:". -h-h-h-",2:".t. -h-h-",3:".t.t. -h-",4:".t.t.t. -",5:".t.t.t.t.",6:"- .t.t.t.",7:"-h- .t.t.",8:"-h-h- .t.",9:"-h-h-h- .",0:"-h-h-h-h-",".":". - . - . -",",":"-h- .t. -h-",":":"-h-h- .t.t.","?":".t. -h- .t.","'":". -h-h-h- .","-":"- .t.t.t. -","/":"- .t. - .","(":"- . -h- .",")":"- . -h- . -","“":". - .t. - .","”":". - .t. - .","‘":". - .t. - .","’":". - .t. - .",'"':". - .t. - .","@":". -h- . - .","=":"- .t.t. -","&":". - .t.t.","+":". - . - .","!":"- . - . -h-"},ratio:{".":1,"-":3," ":-1,t:-1,h:-1,"•":-3,"■":-7},baseElement:".",frequency:{".":550,"-":550," ":0,t:0,h:0,"•":0,"■":0},display:{morse:{".":".","-":"-"," ":"",t:"",h:""},join:{"•":" ","■":" / "}},tidyMorse:function(e){return e=(e=(e=(e=e.trim()).replace(/_/g,"-")).replace(/\s+/g," ")).replace(/\s*\/[\s\/]*/g,"/")},processMorseSpaces:function(e){return e=(e=(e=(e=(e=(e=e.replace(/\//g,"■")).replace(/ /g,"•")).replace(/\.(?=\.)/g,".t")).replace(/\-(?=\-)/g,"-h")).replace(/\.(?=\-)/g,". ")).replace(/\-(?=\.)/g,"- ")},morseMatch:/^\s*[\.\-_]+[\.\-_\s\/]*$/,displayName:{keys:[".","-"," ","•","■"],values:["Dit length","Dah length","Intra-character space","Inter-character space","Inter-word space"]},options:{prosigns:{letter:{"<AA>":". - . -","<AR>":". - . - .","<AS>":". - .t.t.","<BK>":"- .t.t. - . -","<BT>":"- .t.t. -","<CL>":"- . - .t. - .t.","<CT>":"- . - . -","<DO>":"- .t. -h-h-","<KA>":"- . - . -","<KN>":"- . -h- .","<SK>":".t.t. - . -","<SN>":".t.t. - .","<VA>":".t.t. - . -","<VE>":".t.t. - .","<SOS>":".t.t. -h-h- .t.t."},textGrammar:{textWords:"(prosign | textCharacter)+",prosign:'"<" textCharacter textCharacter textCharacter? ">"'},disallowed:"#x3c#x3e"},accents:{letter:{"À":". -h- . -","Å":". -h- . -","Ä":". - . -","Ą":". - . -","Æ":". - . -","Ć":"- . - .t.","Ĉ":"- . - .t.","Ç":"- . - .t.","Đ":".t. - .t.","Ð":".t. -h- .","É":".t. - .t.","È":". - .t. -","Ę":".t. - .t.","Ĝ":"-h- . - .","Ĥ":"-h-h-h-","Ĵ":". -h-h- .","Ł":". - .t. -","Ń":"-h- . -h-","Ñ":"-h- . -h-","Ó":"-h-h- .","Ö":"-h-h- .","Ø":"-h-h- .","Ś":".t.t. - .t.t.","Ŝ":".t.t. - .","Š":"-h-h-h-","Þ":". -h- .t.","Ü":".t. -h-","Ŭ":".t. -h-","Ź":"-h- .t. - .","Ż":"-h- .t. -"}}},morseGrammar:{morse:"morseWords+",morseWords:"(morseCharacter | morseSpace+)+",morseCharacter:"[\\.\\-th ]+",morseSpace:"[/\r\n\t".concat("•").concat("■","]")}},z="•",J="■",K={id:"american",letter:{A:". -",B:"- . . .",C:". .s.",D:"- . .",E:".",F:". - .",G:"- - .",H:". . . .",I:". .",J:"- . - .",K:"- . -",L:"⸺",M:"- -",N:"- .",O:".s.",P:". . . . .",Q:". . - .",R:".s. .",S:". . .",T:"-",U:". . -",V:". . . -",W:". - -",X:". - . .",Y:". .s. .",Z:". . .s.",1:". - - .",2:". . - . .",3:". . . - .",4:". . . . -",5:"- - -",6:". . . . . .",7:"- - . .",8:"- . . . .",9:"- . . -",0:"⸻",".":". . - - . .",",":". - . -",":":"- . -s.s.","?":"- . . - .","'":". . - .s. - . .","-":". . .s. - . .","/":". . -s-","(":". . . . .s- .",")":". . . . .s. .s. .",'"':". . - .s- .","“":". . - .s- .","”":". . - .s- . - .","&":".s. . .","!":"- - - .",";":". . .s. ."},ratio:{".":1,"-":2,"⸺":4,"⸻":5," ":-1,s:-1.5,"•":-2,"■":-3},baseElement:".",frequency:{".":550,"-":550,"⸺":550,"⸻":550," ":0,s:0,"•":0,"■":0},display:{morse:{".":".","-":"-","⸺":"⸺","⸻":"⸻"," ":"",s:" "},join:{"•":"   ","■":" / "}},tidyMorse:function(e){return e=(e=(e=(e=(e=(e=e.trim()).replace(/_/g,"-")).replace(/[\r\n\t]+/g,"/")).replace(/   +/g,"   ")).replace(/([\.\-\u2e3a\u2e3b]  )([^ ])/g,"$1 $2")).replace(/ *\/[ \/]*/g,"/")},processMorseSpaces:function(e){e=(e=e.replace(/\//g,J)).replace(/   /g,z);var t=new RegExp("([^".concat(z).concat(J,"])(?=[^").concat(z).concat(J,"])"),"g");e=(e=e.replace(t,"$1 ")).replace(/   /g,"s");for(var r=/(.*\[[^\]]*) ([^\]]*\])/;e.match(r);)e=e.replace(r,"$1");return e},morseMatch:/^\s*[\.\-_\u2e3a\u2e3b]+[\.\-_\u2e3a\u2e3b\s\/]*$/,displayName:{keys:[".","-","⸺","⸻"," ","s",z,J],values:["dit","dah","long dash","very long dash","short space","long space","inter-character space","word space"]},options:{},morseGrammar:{morse:"morseWords+",morseWords:"(morseCharacter | morseSpace+)+",morseCharacter:"[s\\.\\-".concat("⸺").concat("⸻"," ]+"),morseSpace:"[/\r\n\t".concat(z).concat(J,"]")}},Q={id:"cyrillic",letter:{"А":". -","Б":"- . . .","В":". - -","Г":"- - .","Д":"- . .","Е":".","Ж":". . . -","З":"- - . .","И":". .","Й":". - - -","К":"- . -","Л":". - . .","М":"- -","Н":"- .","О":"- - -","П":". - - .","Р":". - .","С":". . .","Т":"-","У":". . -","Ф":". . - .","Х":". . . .","Ц":"- . - .","Ч":"- - - .","Ш":"- - - -","Щ":"- - . -","Ъ":"- - . - -","Ы":"- . - -","Ь":"- . . -","Э":". . - . .","Ю":". . - -","Я":". - . -",1:". - - - -",2:". . - - -",3:". . . - -",4:". . . . -",5:". . . . .",6:"- . . . .",7:"- - . . .",8:"- - - . .",9:"- - - - .",0:"- - - - -",".":". . . . . .",",":". - . - . -",":":"- - - . . .",";":"- . - . -","?":". . - - . .","/":"- . . - .","(":"- . - - . -",")":"- . - - . -","'":". - - - - .",'"':". - . . - .","—":"- . . . . -","!":"- - . . - -","-":"- . . . -","@":". - - . - ."},letterMatch:/^./,ratio:{".":1,"-":3," ":-1,charSpace:-3,wordSpace:-7},baseElement:".",frequency:{".":550,"-":550," ":0,charSpace:0,wordSpace:0},display:{morse:{"\\.":".","\\-":"-"," ":""},join:{charSpace:" ",wordSpace:" / "}},tokeniseMorse:function(e){var t=(e=(e=(e=(e=(e=e.trim()).replace(/_/g,"-")).replace(/\|/g,"/")).replace(/\s+/g," ")).replace(/\s*\/[\s\/]*/g,"/")).split("/").map((function(e){return e.split(" ")}));return t=t.map((function(e){return e.map((function(e){return e.replace(/(.)(?=.)/g,"$1 ")}))}))},morseMatch:new RegExp("^\\s*[\\.\\-_]+[\\.\\-_\\s\\/\\|]*$"),displayName:{keys:[".","-"," ","charSpace","wordSpace"],values:["Dit length","Dah length","Intra-character space","Inter-character space","Inter-word space"]},options:{}},X={id:"cyrillic-ukraine",letter:{"А":". -","Б":"- . . .","В":". - -","Г":"- - .","Д":"- . .","Е":".","Ж":". . . -","З":"- - . .","І":". .","Й":". - - -","К":"- . -","Л":". - . .","М":"- -","Н":"- .","О":"- - -","П":". - - .","Р":". - .","С":". . .","Т":"-","У":". . -","Ф":". . - .","Х":". . . .","Ц":"- . - .","Ч":"- - - .","Ш":"- - - -","Щ":"- - . -","Ъ":"- - . - -","Ы":"- . - -","И":"- . - -","Ь":"- . . -","Є":". . - . .","Ю":". . - -","Я":". - . -","Ї":". - - - .",1:". - - - -",2:". . - - -",3:". . . - -",4:". . . . -",5:". . . . .",6:"- . . . .",7:"- - . . .",8:"- - - . .",9:"- - - - .",0:"- - - - -",".":". . . . . .",",":". - . - . -",":":"- - - . . .",";":"- . - . -","?":". . - - . .","/":"- . . - .","(":"- . - - . -",")":"- . - - . -","'":". - - - - .",'"':". - . . - .","—":"- . . . . -","!":"- - . . - -","-":"- . . . -","@":". - - . - ."},letterMatch:/^./,ratio:{".":1,"-":3," ":-1,charSpace:-3,wordSpace:-7},baseElement:".",frequency:{".":550,"-":550," ":0,charSpace:0,wordSpace:0},display:{morse:{"\\.":".","\\-":"-"," ":""},join:{charSpace:" ",wordSpace:" / "}},tokeniseMorse:function(e){var t=(e=(e=(e=(e=(e=e.trim()).replace(/_/g,"-")).replace(/\|/g,"/")).replace(/\s+/g," ")).replace(/\s*\/[\s\/]*/g,"/")).split("/").map((function(e){return e.split(" ")}));return t=t.map((function(e){return e.map((function(e){return e.replace(/(.)(?=.)/g,"$1 ")}))}))},morseMatch:new RegExp("^\\s*[\\.\\-_]+[\\.\\-_\\s\\/\\|]*$"),displayName:{keys:[".","-"," ","charSpace","wordSpace"],values:["Dit length","Dah length","Intra-character space","Inter-character space","Inter-word space"]},options:{}},Y={id:"hebrew",letter:{"א":". -","ב":"- . . .","ג":"- - .","ד":"- . .","ה":"- - -","ו":".","ז":"- - . .","ח":". . . .","ט":". . -","י":". .","כ":"- . -","ל":". - . .","מ":"- -","נ":"- .","ס":"- . - .","ע":". - - -","פ":". - - .","צ":". - -","ק":"- - . -","ר":". - .","ש":". . .","ת":"-",1:". - - - -",2:". . - - -",3:". . . - -",4:". . . . -",5:". . . . .",6:"- . . . .",7:"- - . . .",8:"- - - . .",9:"- - - - .",0:"- - - - -"},letterMatch:/^./,ratio:{".":1,"-":3," ":-1,charSpace:-3,wordSpace:-7},baseElement:".",frequency:{".":550,"-":550," ":0,charSpace:0,wordSpace:0},display:{morse:{"\\.":".","\\-":"-"," ":""},join:{charSpace:" ",wordSpace:" / "}},tokeniseMorse:function(e){var t=(e=(e=(e=(e=(e=e.trim()).replace(/_/g,"-")).replace(/\|/g,"/")).replace(/\s+/g," ")).replace(/\s*\/[\s\/]*/g,"/")).split("/").map((function(e){return e.split(" ")}));return t=t.map((function(e){return e.map((function(e){return e.replace(/(.)(?=.)/g,"$1 ")}))}))},morseMatch:new RegExp("^\\s*[\\.\\-_]+[\\.\\-_\\s\\/\\|]*$"),displayName:{keys:[".","-"," ","charSpace","wordSpace"],values:["Dit length","Dah length","Intra-character space","Inter-character space","Inter-word space"]},options:{}},ee={id:"arabic",letter:{"ا":". -","ب":"- . . .","ت":"-","ث":"- . - .","ج":". - - -","ح":". . . .","خ":"- - -","د":"- . .","ذ":"- - . .","ر":". - .","ز":"- - - .","س":". . .","ش":"- - - -","ص":"- . . -","ض":". . . -","ط":". . -","ظ":"- . - -","ع":". - . -","غ":"- - .","ف":". . - .","ق":"- - . -","ك":"- . -","ل":". - . .","م":"- -","ن":"- .","ه":". . - - . .","و":". - -","ي":". .","ﺀ":".",1:". - - - -",2:". . - - -",3:". . . - -",4:". . . . -",5:". . . . .",6:"- . . . .",7:"- - . . .",8:"- - - . .",9:"- - - - .",0:"- - - - -"},letterMatch:/^./,ratio:{".":1,"-":3," ":-1,charSpace:-3,wordSpace:-7},baseElement:".",frequency:{".":550,"-":550," ":0,charSpace:0,wordSpace:0},display:{morse:{"\\.":".","\\-":"-"," ":""},join:{charSpace:" ",wordSpace:" / "}},tokeniseMorse:function(e){var t=(e=(e=(e=(e=(e=e.trim()).replace(/_/g,"-")).replace(/\|/g,"/")).replace(/\s+/g," ")).replace(/\s*\/[\s\/]*/g,"/")).split("/").map((function(e){return e.split(" ")}));return t=t.map((function(e){return e.map((function(e){return e.replace(/(.)(?=.)/g,"$1 ")}))}))},morseMatch:new RegExp("^\\s*[\\.\\-_]+[\\.\\-_\\s\\/\\|]*$"),displayName:{keys:[".","-"," ","charSpace","wordSpace"],values:["Dit length","Dah length","Intra-character space","Inter-character space","Inter-word space"]},options:{}},te={};function re(e){return re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},re(e)}function ne(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,se(n.key),n)}}function ie(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ae(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ie(Object(r),!0).forEach((function(t){oe(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ie(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function oe(e,t,r){return(t=se(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function se(e){var t=function(e,t){if("object"!==re(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==re(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===re(t)?t:String(t)}te.international=Z,te.american=K,te.cyrillic=Q,te.cyrillicUkraine=X,te.hebrew=Y,te.arabic=ee;var le="•",ce="■",ue={tag:"volume | pitch | timing | pause",volume:"volumeValue | volumeReset",volumeValue:'"[" [v] numberOrPercentage "]"',volumeReset:'"[" [v] "]"',pitch:"pitchValue | pitchReset",pitchValue:'"[" [pf] numberOrPercentage "]"',pitchReset:'"[" [pf] "]"',timing:"timingReset | timingValue | timingEqual",timingReset:'"[" [t] "]"',timingValue:'"[" [t] numberOrPercentage ("/" numberOrPercentage)? "]"',timingEqual:'"[" [t] "=]"',pause:"pauseSpace | pauseValue",pauseSpace:'"[" space+ "]"',pauseValue:'"[" number "ms"? "]"',numberOrPercentage:"percentage | number",number:'[+-]? [0-9]+ ("." [0-9]+)?',percentage:'number "%"',space:'" "'},he={tags:{morseGrammar:ae({morse:"(morseWords | tag)+"},ue),textGrammar:ae({text:"(textWords | tag)+"},ue),disallowed:"#x5b#x5d"}},de={text:"textWords+",textWords:"textCharacter+",textCharacter:'"'.concat(le,'" | ')},fe=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.dictionary,n=void 0===r?"international":r,i=t.dictionaryOptions,a=void 0===i?[]:i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),"string"==typeof n&&(n=[n]),this.setDictionariesAndOptions(n,a)}var t,r,n;return t=e,r=[{key:"setDictionariesAndOptions",value:function(e,t){this.dictionaries=e,this.options=t,this._loadDictionaries()}},{key:"setDictionaries",value:function(e){this.dictionaries=e,this._loadDictionaries()}},{key:"setOptions",value:function(e){this.options=e,this._loadDictionaries()}},{key:"_loadDictionaries",value:function(){this.text2morseD={},this.morse2textD={},this.disallowed="♥",this.textGrammar=ae({},de),this.morseGrammar={},this._addDictionary({letter:{"":""}});for(var e=0,t=this.dictionaries,r=t.length;e<r;e++){var n=t[e];if(!(n in te))throw"No dictionary called '".concat(n,"'");var i=te[n];this._addDictionary(i),this.morseGrammar=ae(ae({},this.morseGrammar),i.morseGrammar)}for(var a=0,o=this.options,s=o.length;a<s;a++){var l=o[a],c=void 0;if(void 0!==he[l]?c=he[l]:void 0!==this.dictionary.options[l]&&(c=this.dictionary.options[l]),void 0===c)throw"No option '".concat(l,"' in '").concat(this.dictionary.id,"'");this._addDictionary(c)}this.textGrammar.textCharacter+="[^".concat(this.disallowed,"]"),this.textParser=this._getParserFromDict(this.textGrammar),this.morseParser=this._getParserFromDict(this.morseGrammar)}},{key:"_getParserFromDict",value:function(e){var t="";for(var r in e)t+="".concat(r," ::= ").concat(e[r],"\n");return new G.Grammars.W3C.Parser(t)}},{key:"_addDictionary",value:function(e){if(this.dictionary=ae(ae({},this.dictionary),e),void 0!==e.letter){var t=e.letter;for(var r in t)this.text2morseD[r]=t[r],this.morse2textD[t[r]]=r}void 0!==e.disallowed&&(this.disallowed+=e.disallowed),void 0!==e.textGrammar&&(this.textGrammar=ae(ae({},this.textGrammar),e.textGrammar)),void 0!==e.morseGrammar&&(this.morseGrammar=ae(ae({},this.morseGrammar),e.morseGrammar))}},{key:"display",value:function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";if(null===e)return"";var s,l,c=[];"morse"===e.type?(s="morseWords",l=t?"children":"translation"):(s="textWords",l=t?"translation":"children"),i[le]=r,i[ce]=n;for(var u=function(){var e=d[h];e.type===s?c.push(e[l].map((function(t,r){for(var n in void 0===t&&(t=""),i)t=t.replaceAll(n,i[n]);return void 0!==e.translation[r]?t:a+t+o}))):"tag"==e.type.substring(0,3)&&c.push(e.tag)},h=0,d=e.children,f=d.length;h<f;h++)u();return c=c.flat(),c.join("")}},{key:"processTextSpaces",value:function(e){if(e=(e=(e=e.replace(/\s/g," ")).trim()).replace(/([^<\[\] ])(?=[^>\[\] ])/g,"$1•"),this.options.includes("tags")){e=(e=e.replace(/( +)(\[[^\]]+\])/g,"$2$1")).replace(/([^\[\] ]\[[^\]]+\])(?=[^\[ ])/g,"$1•");for(var t=new RegExp("(.*\\[[^\\]]*)".concat(le,"([^\\]]*\\])"),"g");e.match(t);)e=e.replace(t,"$1$2");var r=new RegExp(" \\]".concat(le,"+"),"g");e=e.replace(r," ]"),r=new RegExp("(\\[\\d+(ms)?\\])".concat(le,"+"),"g"),e=(e=e.replace(r,"$1")).replace(/(\[ +\])/g,(function(e,t){return t.replace(/ /g,"▢")}))}if(this.options.includes("prosigns")){var n=new RegExp("(<.)".concat(le,"(.>)"),"g");e=e.replace(n,"$1$2"),n=new RegExp("(<.)".concat(le,"(.)").concat(le,"(.>)"),"g"),e=e.replace(n,"$1$2$3")}return e=(e=e.replace(/ +/g,ce)).replace(/▢/g," ")}},{key:"tokeniseText",value:function(e){return this.getAST(this.textParser,this.processTextSpaces(e))}},{key:"displayText",value:function(e,t){return this.display(e,!1,""," ",t)}},{key:"displayTextErrors",value:function(e,t,r,n){return this.display(e,!1,""," ",t,r,n)}},{key:"loadText",value:function(e){var t=this.tokeniseText(e);return null===t?null:(this._input2output(t),t)}},{key:"tidyMorse",value:function(e){return this.dictionary.tidyMorse(e)}},{key:"processMorseSpaces",value:function(e){return this.dictionary.processMorseSpaces(e)}},{key:"tokeniseMorse",value:function(e){return this.getAST(this.morseParser,this.processMorseSpaces(this.tidyMorse(e)))}},{key:"displayMorse",value:function(e){return this.display(e,!0,this.dictionary.display.join[le],this.dictionary.display.join[ce],this.dictionary.display.morse)}},{key:"displayMorseErrors",value:function(e,t,r){return this.display(e,!0,this.dictionary.display.join[le],this.dictionary.display.join[ce],this.dictionary.display.morse,t,r)}},{key:"loadMorse",value:function(e){var t=this.tokeniseMorse(e);return null===t?null:(this._input2output(t),t)}},{key:"looksLikeMorse",value:function(e){return null!==e.match(this.dictionary.morseMatch)}},{key:"_input2output",value:function(e){var t,r,n="text"==e.type;e.error=!1,n?(t=this.text2morseD,r="textWords"):(t=this.morse2textD,r="morseWords");for(var i=0,a=e.children,o=a.length;i<o;i++){var s=a[i];if(s.type==r){s.translation=[];for(var l=s.children,c=void 0,u=0,h=l.length;u<h;u++){var d=l[u];d===le||d===ce?c=d:d in t?c=t[d]:d.toUpperCase()in t?c=t[d.toUpperCase()]:(c=void 0,s.error=!0,e.error=!0),s.translation.push(c)}}}return!e.error}},{key:"loadTextClean",value:function(e){var t=this.loadText(e);t.error=!1;for(var r=function(){var e=i[n];e.error&&(e.error=!1,e.children=e.children.filter((function(t,r){return void 0!==e.translation[r]})),e.translation=e.translation.filter((function(e){return void 0!==e})),e.children=e.children.filter((function(t,r){return!(t===le&&e.children[r-1]===le)})),e.translation=e.translation.filter((function(t,r){return!(t===le&&e.translation[r-1]===le)})))},n=0,i=t.children,a=i.length;n<a;n++)r();return t}},{key:"parseNumber",value:function(e){return{isPercentage:e.endsWith("%"),isRelative:e.startsWith("+")||e.startsWith("-"),value:parseFloat(e.replace("%",""))}}},{key:"summariseAST",value:function(e){if(null===e)return null;var t={type:e.type};if(e.errors.length>0)return null;for(;1==e.children.length&&("message"==e.type||"tag"==e.type||"volume"==e.type||"pitch"==e.type||"timing"==e.type||"pause"==e.type);)e=e.children[0],t.type+="-"+e.type,t.tag=e.text;if("textWords"==e.type||"morseWords"==e.type||e.type.match("Value")||e.type.match("Space")){t.children=[];for(var r=0,n=e.children,i=n.length;r<i;r++){var a=n[r];t.children.push(a.text)}}else if(e.children.length>=1){t.children=[];for(var o=0,s=e.children,l=s.length;o<l;o++){var c=s[o];t.children.push(this.summariseAST(c))}}return t}},{key:"getAST",value:function(e,t){var r=e.getAST(t);return this.summariseAST(r)}}],r&&ne(t.prototype,r),n&&ne(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function pe(e){return pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pe(e)}function me(){return me=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},me.apply(this,arguments)}function ge(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ve(e,t,r){return(t=be(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ye(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,be(n.key),n)}}function be(e){var t=function(e,t){if("object"!==pe(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==pe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===pe(t)?t:String(t)}function Se(e,t){return Se=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Se(e,t)}function Ae(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Ce(e);if(t){var i=Ce(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===pe(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function Ce(e){return Ce=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ce(e)}var _e=6e4,ke="•",Pe="■",we=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Se(e,t)}(a,e);var t,r,n,i=Ae(a);function a(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.dictionary,n=t.dictionaryOptions,o=t.wpm,s=void 0===o?20:o,l=t.fwpm,c=void 0===l?s:l,u=t.frequency,h=void 0===u?550:u;for(var d in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this,{dictionary:r,dictionaryOptions:n}))._baseElement=e.dictionary.baseElement,e.ratios=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ge(Object(r),!0).forEach((function(t){ve(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ge(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},e.dictionary.ratio),e.variation={},e.ratios)e.clearVariation(d);var f=e.loadText("PARIS");return e._baseLength=1,e._ditsInParis=e.getDuration(e.getTimings(f))+Math.abs(e.ratios[Pe]),e._spacesInParis=Math.abs(4*e.ratios[ke]+e.ratios[Pe]),e.setWPM(s),e.setFWPM(c),e.setFrequency(h),e}return t=a,r=[{key:"setWPM",value:function(e){var t=this.fwpm;return this._baseLength=void 0,this._lengths=void 0,e=Math.max(1,e||1),this._wpm=e,void 0!==t&&(this._fwpm=Math.min(this._wpm,t),this._ratios=void 0,this.ratios),this.baseLength,e}},{key:"wpm",get:function(){return void 0===this._wpm&&this.testWPMmatchesRatio()&&this._setWPMfromBaseLength(),this._wpm}},{key:"testWPMmatchesRatio",value:function(){return this.ratios["-"]==this.dictionary.ratio["-"]&&this.ratios[" "]==this.dictionary.ratio[" "]}},{key:"setFWPM",value:function(e){return e=Math.max(1,e||1),this._fwpm=e,void 0===this.wpm?this.setWPM(this._fwpm):this.setWPM(Math.max(this._wpm,this._fwpm)),e}},{key:"fwpm",get:function(){return void 0!==this.wpm&&void 0===this._fwpm&&this.testFWPMmatchesRatio()&&this._setFWPMfromRatio(),this._fwpm}},{key:"testFWPMmatchesRatio",value:function(){return Math.abs(this.ratios[Pe]/this.dictionary.ratio[Pe]-this.ratios[ke]/this.dictionary.ratio[ke])<.001}},{key:"ratios",get:function(){if(void 0===this._ratios){this._ratios={},me(this._ratios,this.dictionary.ratio);var e=this.farnsworthRatio;this._ratios[ke]*=e,this._ratios[Pe]*=e}return this._ratios},set:function(e){for(var t in this._wpm=void 0,this._fwpm=void 0,this._lengths=void 0,this._ratios={},me(this._ratios,e),this._ratios)this._ratios[t]/=this._ratios[this._baseElement],this._ratios[t]=Math.abs(this._ratios[t])*(this.dictionary.ratio[t]>0?1:-1)}},{key:"effectiveWPM",get:function(){return 6e4/(10*this.lengths["."]+4*this.lengths["-"]+-9*this.lengths[" "]+-4*this.lengths[ke]+-1*this.lengths[Pe])}},{key:"effectiveCharacterWPM",get:function(){return 6e4/(10*this.lengths["."]+4*this.lengths["-"]+-9*this.lengths[" "]+12*this.lengths["."]+7*this.lengths["."])}},{key:"setRatio",value:function(e,t){return t=Math.abs(t)*(this.dictionary.ratio[e]>0?1:-1),this.ratios,this._ratios[e]=t,this._lengths=void 0,this.testWPMmatchesRatio()?(this._setWPMfromBaseLength(),this.testFWPMmatchesRatio()?this._setFWPMfromRatio():this._fwpm=void 0):(this._wpm=void 0,this._fwpm=void 0),t}},{key:"setFrequency",value:function(e){this._frequency=e}},{key:"getFrequency",value:function(){return this._frequency}},{key:"_saveSpeed",value:function(){this._savedSpeed={ratios:{}},me(this._savedSpeed.ratios,this.ratios),this._savedSpeed.baseLength=this.baseLength}},{key:"_restoreSpeed",value:function(){this.ratios=this._savedSpeed.ratios,this._baseLength=this._savedSpeed.baseLength}},{key:"_saveFrequency",value:function(){this._savedFrequency=this.getFrequency()}},{key:"_restoreFrequency",value:function(){this.setFrequency(this._savedFrequency)}},{key:"_saveParameters",value:function(){this._saveSpeed(),this._saveFrequency()}},{key:"_restoreParameters",value:function(){this._restoreSpeed(),this._restoreFrequency()}},{key:"getNotes",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=[];if(null===e)return r;this._saveParameters();for(var n=this.wpm,i=this.fwpm,a=this.getFrequency(),o=0,s=e.children,l=s.length;o<l;o++){var c=s[o];if("tag"===c.type.substring(0,3)){var u=void 0;switch(c.type){case"tag-timing-timingValue":2==c.children.length?((u=this.parseNumber(c.children[0])).isPercentage?(u.isRelative&&(u.value+=100),this.setWPM(n*u.value/100)):(u.isRelative&&(u.value+=n),this.setWPM(u.value)),(u=this.parseNumber(c.children[1])).isPercentage?(u.isRelative&&(u.value+=100),this.setFWPM(i*u.value/100)):(u.isRelative&&(u.value+=i),this.setFWPM(u.value))):(u=this.parseNumber(c.children[0])).isPercentage?(u.isRelative&&(u.value+=100),this.setWPM(n*u.value/100),this.setFWPM(i*u.value/100)):u.isRelative?(this.setWPM(n+u.value),this.setFWPM(i+u.value)):(this.setWPM(u.value),this.setFWPM(u.value));break;case"tag-timing-timingReset":this._restoreSpeed();break;case"tag-timing-timingEqual":this.setFWPM(this.wpm);break;case"tag-pause-pauseValue":r.push({d:-c.children[0],f:this.getFrequency()});break;case"tag-pause-pauseSpace":r.push({d:this.lengths[Pe]*c.children.length,f:this.getFrequency()});break;case"tag-pitch-pitchValue":(u=this.parseNumber(c.children[0])).isPercentage?(u.isRelative&&(u.value+=100),this.setFrequency(a*u.value/100)):(u.isRelative&&(u.value+=a),this.setFrequency(u.value));break;case"tag-pitch-pitchReset":this._restoreFrequency()}}else for(var h=0,d="morseWords"===c.type?c.children:c.translation,f=d.length;h<f;h++)for(var p=0,m=d[h].split(""),g=m.length;p<g;p++){var v=m[p],y={d:t?this.lengths[v]:this.getAdjustedLength(v),f:this.getFrequency(),e:v};r.push(y)}}return this._restoreParameters(),r}},{key:"getSequence",value:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this.getNotes(e,t),n=[],i=[],a=0,o=r.length;a<o;a++){var s=r[a];n.push(s.d),i.push(s.f)}return{timings:n,frequencies:i}}},{key:"getTimings",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getSequence(e,t).timings}},{key:"getDuration",value:function(e){return e.reduce((function(e,t){return e+Math.abs(t)}),0)}},{key:"farnsworthRatio",get:function(){return(this._ditsInParis*this._wpm-(this._ditsInParis-this._spacesInParis)*this._fwpm)/(this._spacesInParis*this._fwpm)}},{key:"_setWPMfromBaseLength",value:function(){this._wpm=_e/this._ditsInParis/this._baseLength}},{key:"setWPMfromDitLen",value:function(e){this.setWPM(_e/this._ditsInParis/e)}},{key:"_setFWPMfromRatio",value:function(){var e=Math.abs(this.lengths[ke]/3/this.lengths["."]);this._fwpm=this._ditsInParis*this._wpm/(this._spacesInParis*e+(this._ditsInParis-this._spacesInParis))}},{key:"setFWPMfromRatio",value:function(e){e=Math.max(Math.abs(e),1),this.setFWPM(this._ditsInParis*this._wpm/(this._spacesInParis*e+(this._ditsInParis-this._spacesInParis)))}},{key:"baseLength",get:function(){return this._baseLength=this._baseLength||_e/this._ditsInParis/this._wpm,this._baseLength}},{key:"lengths",get:function(){if(void 0===this._lengths)for(var e in this._lengths={},this._maxLength=0,me(this._lengths,this.ratios),this._lengths)this._lengths[e]*=this._baseLength,this._maxLength=Math.max(this._maxLength,this._lengths[e]);return this._lengths}},{key:"maxLength",get:function(){return void 0===this._lengths&&this.lengths,this._maxLength}},{key:"setLength",value:function(e,t){return t=Math.abs(t)*(this.dictionary.ratio[e]>0?1:-1),e==this._baseElement&&(this._lengths=void 0,this._wpm=void 0,this._fwpm=void 0,this._baseLength=t),this.setRatio(e,t/this._baseLength),t}},{key:"wordSpace",get:function(){return Math.abs(this.lengths[Pe])}},{key:"setVariation",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.sysOffset,n=t.sysSlope,i=t.rndRange,a=t.rndSlope,o=t.stdDev;this.variation[e]={sysOffset:r,sysSlope:n,rndRange:i,rndSlope:a,stdDev:o}}},{key:"getVariation",value:function(e){return this.variation[e]}},{key:"clearVariation",value:function(e){this.setVariation(e,{sysOffset:0,sysSlope:1,rndRange:0,rndSlope:0,stdDev:0})}},{key:"hasVariation",value:function(e){var t=this.getVariation(e);return!(0==t.sysOffset&&1==t.sysSlope&&0==t.rndRange&&0==t.rndSlope&&0==t.stdDev)}},{key:"getAdjustedLength",value:function(e){var t=this.lengths[e],r=this.getVariation(e),n=r.sysOffset,i=r.sysSlope,a=r.rndRange,o=r.rndSlope,s=r.stdDev,l=Math.abs(t)*i+n,c=this.truncatedNormal(s);return c*=(Math.abs(t)*o+a)/2,Math.max(l+c,0)*Math.sign(t)}},{key:"truncatedNormal",value:function(e){var t=e*Math.sqrt(-2*Math.log(1-Math.random()))*Math.cos(2*Math.PI*Math.random());return t-=Math.trunc(t)}}],r&&ye(t.prototype,r),n&&ye(t,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(fe);function Ee(e){return Ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ee(e)}function xe(e){return function(e){if(Array.isArray(e))return Me(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Me(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Me(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Me(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function We(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Re(n.key),n)}}function Re(e){var t=function(e,t){if("object"!==Ee(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Ee(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===Ee(t)?t:String(t)}function $e(e,t){return $e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},$e(e,t)}function Oe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Te(e);if(t){var i=Te(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===Ee(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function Te(e){return Te=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Te(e)}var Le=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&$e(e,t)}(a,e);var t,r,n,i=Oe(a);function a(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.dictionary,n=t.dictionaryOptions,o=t.wpm,s=t.fwpm,l=t.frequency,c=t.sampleRate,u=void 0===c?8e3:c;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this,{dictionary:r,dictionaryOptions:n,wpm:o,fwpm:s,frequency:l})).sampleRate=u,e}return t=a,(r=[{key:"getSample",value:function(e,t,r){var n=this;if(0===e.timings.length)return[];var i,a=e.timings.slice();i=void 0===e.frequencies?a.map((function(t){return e.frequency||n.frequency})):e.frequencies.slice(),void 0!==t&&(a.unshift(-Math.abs(t)),i.unshift(0));var o=a.length-1;r=Math.abs(r)||0,a[o]>0?(a.push(-Math.max(5,r)),i.push(0)):a[o]=-Math.max(5,r,-a[o]);for(var s,l,c,u,h,d=1.5*Math.max.apply(Math,xe(i))/this.sampleRate,f=Math.SQRT1_2,p=Math.sin(2*Math.PI*d),m=Math.cos(2*Math.PI*d),g=p/(2*Math.pow(10,f/20)),v=1+g,y=.5*(1-m)/v,b=(1-m)/v,S=.5*(1-m)/v,A=-2*m/v,C=(1-g)/v,_=[],k=0,P=0,w=0,E=0,x=0;x<a.length;x++){l=this.sampleRate*Math.abs(a[x])/1e3,s=a[x]>0?1:0;for(var M=0;M<l;M+=1)c=2*Math.PI*i[x]/this.sampleRate,h=y*(u=s*Math.sin(M*c))+b*k+S*P-A*w-C*E,_.push(.813*h),P=k,k=u,E=w,w=h}return _}},{key:"getWAASample",value:function(e){var t=this;if(0===e.timings.length)return[];var r,n=e.timings.slice();r=void 0===e.frequencies?n.map((function(r){return e.frequency||t.frequency})):e.frequencies.slice(),void 0!==startPadding&&(n.unshift(-Math.abs(startPadding)),r.unshift(0));var i=n.length-1;endPadding=Math.abs(endPadding)||0,n[i]>0?(n.push(-Math.max(5,endPadding)),r.push(0)):n[i]=-Math.max(5,endPadding,-n[i]);var a=n.reduce((function(e,t){return e+Math.abs(t)}),0),o=Math.max.apply(Math,xe(r)),s=window.OfflineAudioContext||window.webkitOfflineAudioContext;if(void 0===s)throw new Error("No OfflineAudioContext class defined");var l=new s(1,this.sampleRate*a/1e3,this.sampleRate),c=l.createGain();c.gain.setValueAtTime(.813,0);var u=l.createBiquadFilter();u.type="lowpass",u.frequency.setValueAtTime(1.1*o,0),c.connect(u),u.connect(l.destination);for(var h,d,f=0,p=0;p<n.length;p++)d=Math.abs(n[p])/1e3,n[p]>0&&((h=l.createOscillator()).type="sine",h.frequency.setValueAtTime(r[p],f),h.start(f),h.stop(f+d),h.connect(c)),f+=d;return l.startRendering().then((function(e){return e.getChannelData(0)}))}}])&&We(t.prototype,r),n&&We(t,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(we);function Ne(e){return Ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ne(e)}function qe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ie(n.key),n)}}function Ie(e){var t=function(e,t){if("object"!==Ne(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Ne(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===Ne(t)?t:String(t)}var Ve=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.XAudioServerClass,n=t.morseCWWave,i=t.startPadding,a=void 0===i?0:i,o=t.endPadding,s=void 0===o?1e3:o,l=t.volume,c=void 0===l?1:l;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.XAudioServerClass=r,this.morseCWWave=n,this.startPadding=a,this.endPadding=s,this.volume=c,this._isPlaying=!1,this.samplePos=void 0,this.noAudio=!1,this.audioServer=void 0,this.sampleRate=8e3,this.sample=void 0;var u=this;this.audioGenerator=function(e){return 0===e?[]:(e=Math.min(e,u.sample.length-u.samplePos))>0?(t=u.sample.slice(u.samplePos,u.samplePos+e),u.samplePos+=e,t):(u._isPlaying=!1,[]);var t},this.failureCallback=function(){u.noAudio=!0},setInterval((function(){u._isPlaying&&u.audioServer.executeCallback()}),20),this.load()}var t,r,n;return t=e,r=[{key:"volume",get:function(){return this._volume},set:function(e){if(this._volume=Math.min(Math.max(e,0),1),0===this._volume)this._gain=0;else{var t=60*this._volume-60;this._gain=Math.pow(10,t/20)}}},{key:"gain",get:function(){return this._gain}},{key:"stop",value:function(){this._isPlaying=!1,this.audioServer.changeVolume(0)}},{key:"load",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{timings:[]}).timings;e.unshift(-this.startPadding),e.push(-this.endPadding),this.sample=this.morseCWWave.getSample(e),this.sampleRate=this.morseCWWave.sampleRate,console.log("Trying XAudioServer"),this.audioServer=new this.XAudioServerClass(1,this.sampleRate,this.sampleRate>>2,this.sampleRate<<1,this.audioGenerator,0,this.failureCallback)}},{key:"play",value:function(){this.stop(),this._isPlaying=!0,this.samplePos=0,this.audioServer.changeVolume(this._gain)}},{key:"hasError",value:function(){return this.noAudio}},{key:"isPlaying",get:function(){return this._isPlaying}},{key:"audioType",get:function(){return this.audioServer.audioType}}],r&&qe(t.prototype,r),n&&qe(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function je(e){return je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},je(e)}function Ue(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Fe(n.key),n)}}function Fe(e){var t=function(e,t){if("object"!==je(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==je(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===je(t)?t:String(t)}var De=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.defaultFrequency,n=void 0===r?550:r,i=t.startPadding,a=void 0===i?0:i,o=t.endPadding,s=void 0===o?0:o,l=t.volume,c=void 0===l?1:l,u=t.sequenceStartCallback,h=t.sequenceSoundStartCallback,d=t.sequenceEndingCallback,f=t.sequenceSoundEndCallback,p=t.sequenceEndCallback,m=t.allStoppedCallback,g=t.onSample,v=t.offSample,y=t.playMode,b=void 0===y?"sine":y,S=t.minimumStartPadding,A=void 0===S?50:S;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.setCallbacks({sequenceStartCallback:u,sequenceSoundStartCallback:h,sequenceEndingCallback:d,sequenceSoundEndCallback:f,sequenceEndCallback:p,allStoppedCallback:m}),this.playMode=b,this._noAudio=!1,void 0!==g&&(U.loadSample(g,"onSample"),U.loadSample(v,"offSample")),this.loop=!1,this.fallbackFrequency=n,this.startPadding=a,this.minimumStartPadding=A,this.endPadding=s,this.volume=c,this._cTimings=[],this._isPlaying=!1,this._isPaused=!1,this._lookAheadTime=.1,this._timerInterval=.05,this._timer=void 0,this._sequenceStartTimer=void 0,this._sequenceSoundEndTimer=void 0,this._sequenceEndTimer=void 0,this._stopTimer=void 0,this._queue=[],this._scheduling=!1,this._initialiseAudio()}var t,r,n;return t=e,r=[{key:"_initialiseAudio",value:function(){this.splitterNode&&this.splitterNode.disconnect();var e=U.getAudioContext(),t=e.currentTime;this.oscillatorNode=e.createOscillator(),this.oscillatorNode.type="sine",this.oscillatorNode.start(t),this.onOffNode=e.createGain(),this.onOffNode.gain.setValueAtTime(0,t),this.bandpassNode=e.createBiquadFilter(),this.bandpassNode.type="bandpass",this.bandpassNode.Q.setValueAtTime(1,t),this.splitterNode=e.createGain(),this.splitterNode.gain.setValueAtTime(1,t),this.volumeNode=e.createGain(),this.muteAudioNode=e.createGain(),this.oscillatorNode.connect(this.onOffNode),this.onOffNode.connect(this.bandpassNode),this.bandpassNode.connect(this.splitterNode),this.splitterNode.connect(this.volumeNode),this.volumeNode.connect(this.muteAudioNode),this.muteAudioNode.connect(e.destination),this.setFrequency(this.fallbackFrequency),this.volume=this._volume,this.muteAudio(!1)}},{key:"setCallbacks",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.sequenceStartCallback,r=e.sequenceSoundStartCallback,n=e.sequenceEndingCallback,i=e.sequenceSoundEndCallback,a=e.sequenceEndCallback,o=e.allStoppedCallback;this._savedCallbacks={sequenceStartCallback:this.sequenceStartCallback,sequenceSoundStartCallback:this.sequenceSoundStartCallback,sequenceEndingCallback:this.sequenceEndingCallback,sequenceSoundEndCallback:this.sequenceSoundEndCallback,sequenceEndCallback:this.sequenceEndCallback,allStoppedCallback:this.allStoppedCallback},this.sequenceStartCallback=void 0!==t?t:function(){},this.sequenceSoundStartCallback=void 0!==r?r:function(){},this.sequenceEndingCallback=void 0!==n?n:function(){},this.sequenceSoundEndCallback=void 0!==i?i:function(){},this.sequenceEndCallback=void 0!==a?a:function(){},this.allStoppedCallback=void 0!==o?o:function(){}}},{key:"restoreCallbacks",value:function(){this.sequenceStartCallback=this._savedCallbacks.sequenceStartCallback,this.sequenceSoundStartCallback=this._savedCallbacks.sequenceSoundStartCallback,this.sequenceEndingCallback=this._savedCallbacks.sequenceEndingCallback,this.sequenceSoundEndCallback=this._savedCallbacks.sequenceSoundEndCallback,this.sequenceEndCallback=this._savedCallbacks.sequenceEndCallback,this.allStoppedCallback=this._savedCallbacks.allStoppedCallback}},{key:"setFrequency",value:function(e,t){void 0===t&&(t=U.getAudioContext().currentTime);try{this.oscillatorNode.frequency.setValueAtTime(e,t),this.bandpassNode.frequency.setValueAtTime(e,t)}catch(e){}}},{key:"playMode",get:function(){return this._playMode},set:function(e){this._playMode=e,this.volume=this._volume,this.setFrequency(this.fallbackFrequency)}},{key:"volume",get:function(){return this._volume},set:function(e){var t=this._gain;if(this._volume=Math.min(Math.max(e,0),1),0===this._volume)this._gain=0;else{var r=60*this._volume-60;this._gain=Math.pow(10,r/20)}try{var n=U.getAudioContext().currentTime;this.volumeNode.gain.setValueAtTime(t,n),this.volumeNode.gain.linearRampToValueAtTime(this._gain,n+.03)}catch(e){}}},{key:"gain",get:function(){return this._gain}},{key:"isScheduling",get:function(){return this._scheduling}},{key:"muteAudio",value:function(e){var t=U.getAudioContext().currentTime;this.muteAudioNode.gain.linearRampToValueAtTime(e?0:1,t+.03)}},{key:"load",value:function(e){var t={timings:e.timings.slice(),frequency:e.frequency,frequencies:void 0!==e.frequencies?e.frequencies.slice():void 0,endPadding:e.endPadding};this._queue=[],this._load(t)}},{key:"_load",value:function(e){var t=this;this._cTimings=[0];var r=e.timings;void 0!==e.endPadding&&0!=e.endPadding?r.push(-Math.abs(e.endPadding)):this.endPadding>0&&r.push(-Math.abs(this.endPadding)),this.isNote=[];for(var n=0;n<r.length;n++)this._cTimings[n+1]=this._cTimings[n]+Math.abs(r[n])/1e3,this.isNote[n]=r[n]>0;this.sequenceLength=this.isNote.length,void 0!==e.frequencies?this._frequencies=e.frequencies:this._frequencies=this.isNote.map((function(r){return e.frequency||t.fallbackFrequency}))}},{key:"queue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r={timings:e.timings.slice(),frequency:e.frequency,frequencies:void 0!==e.frequencies?e.frequencies.slice():void 0,endPadding:e.endPadding};this._queue.push(r),t&&(this._scheduling||(this._cTimings=[]),this.play())}},{key:"unqueue",value:function(){return this._queue.length>0?this._queue.pop():null}},{key:"clearAllTimings",value:function(){this._isPlaying||(this._cTimings=[],this._frequencies=[],this._queue=[])}},{key:"play",value:function(e,t){if(!(this._isPlaying&&this._scheduling||this._noAudio)){if(void 0!==e)this._load(e);else if(0===this._cTimings.length){if(!(this._queue.length>0))return;this._load(this._queue.shift())}void 0!==t&&this.setCallbacks(t),this._isPlaying=!0,this._isPaused=!1,this._nextNote=0,this._sequenceSoundStartScheduled=!1,this._tZero=U.getAudioContext().currentTime+(this.startPadding+this.minimumStartPadding)/1e3,this._startScheduling()}}},{key:"pause",value:function(){this._isPlaying&&!this._isPaused&&(this._isPaused=!0,clearInterval(this._timer),this._scheduling=!1)}},{key:"resume",value:function(){this._isPaused&&(this._isPaused=!1,this._tZero=U.getAudioContext().currentTime-this._cTimings[this._nextNote]+(this.startPadding+this.minimumStartPadding)/1e3,this._startScheduling())}},{key:"stop",value:function(){if(this._isPlaying){var e=U.getAudioContext().currentTime;this.onOffNode.gain.cancelScheduledValues(e),this.onOffNode.gain.linearRampToValueAtTime(0,e+.03),this._stop()}}},{key:"restart",value:function(){this._scheduling&&(this._restartRequested=!0)}},{key:"_stop",value:function(){this._isPlaying=!1,this._isPaused=!1,this._scheduling=!1,clearInterval(this._timer),clearInterval(this._stopTimer),this.allStoppedCallback()}},{key:"_startScheduling",value:function(){var e=this;this._scheduling||(clearInterval(this._stopTimer),this._scheduleNotes()&&(this._timer=setInterval((function(){return e._scheduleNotes()}),1e3*this._timerInterval)))}},{key:"_scheduleNotes",value:function(){var e,t,r,n,i,a,o,s=this;this._scheduling=!0;for(var l=U.getAudioContext(),c=l.currentTime;this._nextNote<this.sequenceLength&&this._cTimings[this._nextNote]<c-this._tZero+this._lookAheadTime;){if(e=this._tZero+this._cTimings[this._nextNote],t=this._tZero+this._cTimings[this._nextNote+1],0===this._nextNote&&(this._sequenceStartTimer=setTimeout((function(){return s.sequenceStartCallback()}),1e3*(e-c))),this.isNote[this._nextNote])if(this._soundEndTime=t,this._sequenceSoundStartScheduled||(this._sequenceSoundStartScheduled=!0,this._sequenceSoundStartTimer=setTimeout((function(){return s.sequenceSoundStartCallback()}),1e3*(e-c))),"sine"===this._playMode)this.onOffNode.gain.setTargetAtTime(1,e+.0015,.001),this.onOffNode.gain.setTargetAtTime(0,t+.0015,.001),this.setFrequency(this._frequencies[this._nextNote],e);else{r=this._tZero+this._cTimings[this._nextNote+2],n=this._tZero+this._cTimings[this._nextNote+3];var u=U.getSounds();i=l.createBufferSource();try{i.buffer=u.onSample,i.start(e),r&&i.stop(r),i.connect(this.splitterNode)}catch(e){console.log("onSample not decoded yet")}i=l.createBufferSource();try{i.buffer=u.offSample,i.start(t),n&&i.stop(n),i.connect(this.splitterNode)}catch(e){console.log("offSample not decoded yet")}}else a=this._tZero+this._cTimings[this._nextNote+1];this._nextNote++,this._restartRequested&&(this._restartRequested=!1,c=l.currentTime,this._tZero=c+this.startPadding/1e3,this._nextNote=0),this._nextNote===this.sequenceLength&&(this.sequenceEndingCallback(),this._sequenceSoundStartScheduled&&(this._sequenceSoundEndTimer=setTimeout((function(){return s.sequenceSoundEndCallback()}),1e3*(this._soundEndTime-c))),o=a>this._soundEndTime?a:this._soundEndTime,this._sequenceEndTimer=setTimeout((function(){return s.sequenceEndCallback()}),1e3*(o-c)),(this.loop||this._queue.length>0)&&(this._tZero+=this._cTimings[this.sequenceLength],this._nextNote=0,this._sequenceSoundStartScheduled=!1,this._queue.length>0&&this._load(this._queue.shift())))}if(this._nextNote===this.sequenceLength){this._scheduling=!1,clearInterval(this._timer);var h=o+3*this._lookAheadTime;return this._stopTimer=setTimeout((function(){return s._stop()}),1e3*(h-c)),!1}return!0}},{key:"hasError",value:function(){return this._noAudio}},{key:"isPlaying",get:function(){return this._isPlaying}},{key:"isPaused",get:function(){return this._isPaused}},{key:"nextNote",get:function(){return this._nextNote}},{key:"audioType",get:function(){return 4}}],r&&Ue(t.prototype,r),n&&Ue(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function He(e){return He="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},He(e)}function Be(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ge(n.key),n)}}function Ge(e){var t=function(e,t){if("object"!==He(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==He(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===He(t)?t:String(t)}function Ze(){return Ze="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ke(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},Ze.apply(this,arguments)}function ze(e,t){return ze=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ze(e,t)}function Je(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Ke(e);if(t){var i=Ke(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===He(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function Ke(e){return Ke=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ke(e)}var Qe,Xe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ze(e,t)}(a,e);var t,r,n,i=Je(a);function a(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.defaultFrequency,n=t.startPadding,o=t.endPadding,s=t.volume,l=t.sequenceStartCallback,c=t.sequenceSoundStartCallback,u=t.sequenceEndingCallback,h=t.sequenceSoundEndCallback,d=t.sequenceEndCallback,f=t.allStoppedCallback,p=t.soundOnCallback,m=t.soundOffCallback,g=t.onSample,v=t.offSample,y=t.playMode;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this,{defaultFrequency:r,startPadding:n,endPadding:o,volume:s,sequenceStartCallback:l,sequenceSoundStartCallback:c,sequenceEndingCallback:u,sequenceSoundEndCallback:h,sequenceEndCallback:d,allStoppedCallback:f,onSample:g,offSample:v,playMode:y})).soundOnCallback=void 0!==p?p:function(){},e.soundOffCallback=void 0!==m?m:function(){},e._wasOn=!1,e._count=0,"sample"===y&&console.log('WARNING: The light does not yet work when using "sample" play mode'),e}return t=a,(r=[{key:"_initialiseAudio",value:function(){Ze(Ke(a.prototype),"_initialiseAudio",this).call(this),this.jsNode&&this.jsNode.disconnect();var e=U.getAudioContext();this.muteLightNode=e.createGain(),this.jsNode=e.createScriptProcessor(256,1,1),this.jsNode.connect(e.destination),this.jsNode.onaudioprocess=this._processSound.bind(this),this.splitterNode.connect(this.muteLightNode),this.muteLightNode.connect(this.jsNode),this.muteLight(!1)}},{key:"_processSound",value:function(e){for(var t=e.inputBuffer.getChannelData(0),r=0,n=0;n<t.length;n++)r+=Math.abs(t[n])>.1;var i=r>128;i&&!this._wasOn?this._on():!i&&this._wasOn&&this._off(),this._wasOn=i}},{key:"_on",value:function(){this.soundOnCallback()}},{key:"_off",value:function(){this.soundOffCallback()}},{key:"muteLight",value:function(e){var t=U.getAudioContext().currentTime;this.muteLightNode.gain.setValueAtTime(e?0:1,t)}},{key:"audioType",get:function(){return 5}}])&&Be(t.prototype,r),n&&Be(t,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(De);function Ye(e){var t=new B(Qe.morseCWWave);return void 0!==e&&t.loadText(e),t}var et,tt,rt,nt=$("#microphone"),it=$("#langSelect"),at=($("#log"),null),ot=!1;function st(e){tt.interimResults=e}function lt(){ot||(console.log("Ready to receive speech."),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:et;ot=!0,tt.onresult=function(t){for(var r=[],n=t.resultIndex;n<t.results.length;n++){for(var i=void 0,a=void 0,o=0;o<t.results[n].length;o++)if((a=t.results[n][o].confidence)>0){var s=t.results[n][o].transcript.toUpperCase().replace(/\.$/,"");if(null!==at){if(at.has(s)){i=s;break}}else i=s}void 0!==i&&r.push({text:i,index:n,isFinal:t.results[n].isFinal,confidence:a})}r.length>0&&e(r)},tt.onend=function(e){t(nt)&&e.timeStamp-rt>100&&(console.log("Reactivating mic."),tt.start())},tt.continuous=!0,tt.start()}())}function ct(e){tt.lang=e,it.val(e)}function ut(e){return ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ut(e)}function ht(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function dt(e,t,r){return(t=pt(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ft(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,pt(n.key),n)}}function pt(e){var t=function(e,t){if("object"!==ut(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==ut(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===ut(t)?t:String(t)}it.on("change",(function(){ct(it.find(":selected").val())}));var mt="•",gt="■",vt="highlightField",yt="PARIS VVV",bt=[0,4,6,9,11,14,18,22],St=yt.replace(/ /g,""),At="#timingChart",Ct="morseControls",_t={morseSound:{fallback:!0,alias:"sound"},morseLight:{fallback:!1,alias:"light"},morseVibrate:{fallback:!1,alias:"vibrate"},advancedSpeedMode:{fallback:!1},baseLength:{alias:"ditLength"},dahRatio:{},intraCSratio:{alias:"intraCharacterSpaceRatio"},interCSratio:{alias:"interCharacterSpaceRatio"},interWSratio:{alias:"interWordSpaceRatio"},wpm:{fallback:20},fwpm:{fallback:20,alias:"farnsworth"},frequency:{fallback:550,alias:"pitch"},volume:{fallback:80,min:0,max:100},startPadding:{fallback:0,min:0},downloadEndPadding:{fallback:1e3,min:0},playMode:{},key:{fallback:"computer"}},kt=[0,1,0,0,0],Pt=1e5,wt={computer:{".":kt,"-":kt,t:kt,h:kt," ":kt,"•":kt,"■":kt},paddle1:{".":kt,"-":kt,t:kt,h:kt," ":[0,1.075,0,.25,Pt],"•":[0,1.075,0,.25,Pt],"■":[0,1,0,.3,Pt]},paddle2:{".":kt,"-":kt,t:kt,h:kt," ":[0,1.1,0,.5,Pt],"•":[0,1.1,0,.5,Pt],"■":[0,1.01,0,.7,Pt]},paddle3:{".":kt,"-":kt,t:kt,h:kt," ":[0,1.4,0,1.2,Pt],"•":[0,1.4,0,1.2,Pt],"■":[0,1.3,0,1.6,Pt]},bug1:{".":kt,"-":[0,1,0,.3,Pt],t:kt,h:[0,1,0,.3,Pt]," ":[0,1,0,.3,Pt],"•":[0,1,0,.3,Pt],"■":[0,1,0,.3,Pt]},bug2:{".":[0,.8,0,0,0],"-":[0,1.07,0,.5,Pt],t:[0,.8,0,0,0],h:[0,1.07,0,.5,Pt]," ":[0,1.07,0,.5,Pt],"•":[0,1.07,0,.5,Pt],"■":[0,1.07,0,.5,Pt]},bug3:{".":[0,.6,0,0,0],"-":[0,1.2,0,.8,Pt],t:[0,.6,0,0,0],h:[0,1.2,0,.8,Pt]," ":[0,1.2,0,.8,Pt],"•":[0,1.2,0,.8,Pt],"■":[0,1.2,0,.8,Pt]},straight1:{".":[0,1.02,0,.12,Pt],"-":[0,1,0,.1,Pt],t:[0,1.02,0,.12,Pt],h:[0,1.02,0,.12,Pt]," ":[0,1.02,0,.12,Pt],"•":[0,.95,0,.2,Pt],"■":[0,1,0,.2,Pt]},straight2:{".":[0,1.115,0,.33,Pt],"-":[0,1,0,.3,Pt],t:[0,1.115,0,.33,Pt],h:[0,1.115,0,.33,Pt]," ":[0,1.115,0,.33,Pt],"•":[0,.95,0,.2,Pt],"■":[0,1,0,.3,Pt]},straight3:{".":[0,1.1,0,.6,Pt],"-":[0,1,0,.5,Pt],t:[0,1.1,0,.6,Pt],h:[0,1.1,0,.6,Pt]," ":[0,1.1,0,.6,Pt],"•":[0,.9,0,.4,Pt],"■":[0,1,0,.5,Pt]}},Et=function(){function o(e){var r=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#soundControl",c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"speed",u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"#light",h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:function(){},d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[".downloadEndPadding"];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.morse=e,this.state=s,this.controlCookie=c,this.changeCallback=h;var f=$(l);if(0===f.length)throw"Sound control element '"+l+"' does not exist";this.$wpm=f.find(".wpm"),this.$wpmError=f.find("#wpmError"),this.$fwpm=f.find(".fwpm"),this.$fwpmError=f.find("#fwpmError"),this.$equivalentWPM=f.find(".equivalentWPM"),this.$freq=f.find(".freq"),this.$volume=f.find(".volume"),this.$ditLength=f.find(".ditLength"),this.$dahRatio=f.find(".dahRatio"),this.$dahLength=f.find(".dahLength"),this.$intraCSratio=f.find(".intraCSratio"),this.$intraCSlength=f.find(".intraCSlength"),this.$interCSratio=f.find(".interCSratio"),this.$interCSlength=f.find(".interCSlength"),this.$interWSratio=f.find(".interWSratio"),this.$interWSlength=f.find(".interWSlength"),this.$startPadding=f.find(".startPadding"),this.$downloadEndPadding=f.find(".downloadEndPadding"),this.$playMode=f.find(".playMode"),this.$advancedSpeedSwitch=f.find(".advancedSpeedSwitch"),this.$useMorseSound=f.find(".morseSound"),this.$useMorseLight=f.find(".morseLight"),this.$useMorseVibrate=f.find(".morseVibrate"),this.$key=$(".key"),this.$light=$(u),this.$enlarge=this.$light.find(".icon-enlarge"),this.$shrink=this.$light.find(".icon-shrink"),this.$closeLight=this.$light.find("#closeLight"),this.$wpmInteger=$(".charSpeedSummary"),this.$fwpmInteger=$(".farnSpeedSummary"),this.$sliderSpeedV=$("#sliderSpeedV"),this.$sliderSpeedH=$("#sliderSpeedH"),this.$sliderOutputSpeed=$(".sliderOutputSpeed"),this.$sliderPitchV=$("#sliderPitchV"),this.$sliderPitchH=$("#sliderPitchH"),this.$sliderOutputPitch=$(".sliderOutputPitch"),this.$sliderVolumeV=$("#sliderVolumeV"),this.$sliderVolumeH=$("#sliderVolumeH"),this.$sliderOutputVolume=$(".sliderOutputVolume"),this.$playMorseTest=$("#testMorse"),this.$stopMorseTest=$("#stopMorse");for(var p=0,m=d.length;p<m;p++){var g=d[p];f.find(g).closest("div").hide()}a(this.$stopMorseTest),document.addEventListener("mousedown",this.testVibrate.bind(this),{once:!0}),document.addEventListener("touchend",this.testVibrate.bind(this),{once:!0}),this.morse.morsePlayer.soundOnCallback=function(){r.state.morseVibrate&&r.state.canVibrate&&navigator.vibrate(2*r.morse.morseCWWave.maxLength),r.state.morseLight&&r.$light.addClass("on")},this.morse.morsePlayer.soundOffCallback=function(){r.state.morseVibrate&&r.state.canVibrate&&navigator.vibrate(0),r.state.morseLight&&r.$light.removeClass("on")},this.timers={},w({dictionary:Ct,setValuesCallback:function(){return r.setValues()},variables:_t,comment:"Morse playback settings (shared across pages). For the advanced speed mode, the dit length is defined (in milliseconds) and other durations are set by ratios to the dit length."}),this.setValues(),this.$useMorseSound.on("click",(function(e){r.setMorseSound(!t($(e.currentTarget))),r.writeStorage()})),this.$useMorseLight.on("click",(function(e){r.setMorseLight(!t($(e.currentTarget))),r.writeStorage()})),this.$useMorseVibrate.on("click",(function(e){n($(e.currentTarget))&&(r.setMorseVibrate(!t($(e.currentTarget))),r.writeStorage())})),this.$freq.on("change",(function(){r.setFreq(r.$freq.val()),r.writeStorage()})),this.$volume.on("change",(function(){r.setVolume(r.$volume.val()),r.writeStorage()})),this.$wpm.on("change",(function(){r.setWPM(r.$wpm.val()),r.setFWPM(),r.setDitLength(),r.setDahRatio(),r.setDahLength(),r.setIntraCSratio(),r.setIntraCSlength(),r.setInterCSratio(),r.setInterCSlength(),r.setInterWSratio(),r.setInterWSlength(),r.setEffectiveWPM(),r.writeStorage()})),this.$fwpm.on("change",(function(){r.setFWPM(r.$fwpm.val()),r.setWPM(),r.setDitLength(),r.setDahRatio(),r.setDahLength(),r.setIntraCSratio(),r.setIntraCSlength(),r.setInterCSratio(),r.setInterCSlength(),r.setInterWSratio(),r.setInterWSlength(),r.setEffectiveWPM(),r.writeStorage()})),this.$ditLength.on("change",(function(){r.setDitLength(r.$ditLength.val()),r.setDahLength(),r.setIntraCSlength(),r.setInterCSlength(),r.setInterWSlength(),r.setWPM(),r.setFWPM(),r.setEffectiveWPM(),r.writeStorage()})),this.$dahRatio.on("change",(function(){r.setDahRatio(r.$dahRatio.val()),r.setDahLength(),r.setWPM(),r.setFWPM(),r.setEffectiveWPM(),r.writeStorage()})),this.$dahLength.on("change",(function(){r.setDahLength(r.$dahLength.val()),r.setDahRatio(),r.setWPM(),r.setFWPM(),r.setEffectiveWPM(),r.writeStorage()})),this.$intraCSratio.on("change",(function(){r.setIntraCSratio(r.$intraCSratio.val()),r.setIntraCSlength(),r.setWPM(),r.setFWPM(),r.setEffectiveWPM(),r.writeStorage()})),this.$intraCSlength.on("change",(function(){r.setIntraCSlength(r.$intraCSlength.val()),r.setIntraCSratio(),r.setWPM(),r.setFWPM(),r.setEffectiveWPM(),r.writeStorage()})),this.$interCSratio.on("change",(function(){r.setInterCSratio(r.$interCSratio.val()),r.setInterCSlength(),r.setWPM(),r.setFWPM(),r.setEffectiveWPM(),r.writeStorage()})),this.$interCSlength.on("change",(function(){r.setInterCSlength(r.$interCSlength.val()),r.setInterCSratio(),r.setWPM(),r.setFWPM(),r.setEffectiveWPM(),r.writeStorage()})),this.$interWSratio.on("change",(function(){r.setInterWSratio(r.$interWSratio.val()),r.setInterWSlength(),r.setWPM(),r.setFWPM(),r.setEffectiveWPM(),r.writeStorage()})),this.$interWSlength.on("change",(function(){r.setInterWSlength(r.$interWSlength.val()),r.setInterWSratio(),r.setWPM(),r.setFWPM(),r.setEffectiveWPM(),r.writeStorage()})),this.$startPadding.on("change",(function(){r.setStartPadding(r.$startPadding.val()),r.writeStorage()})),this.$downloadEndPadding.on("change",(function(){r.setDownloadEndPadding(r.$downloadEndPadding.val()),r.writeStorage()})),this.$playMode.on("change",(function(){r.setPlayMode(r.$playMode.find("option:selected").val()),r.writeStorage()})),this.$advancedSpeedSwitch.on("change",(function(){r.setAdvancedSpeedMode(r.$advancedSpeedSwitch.is(":checked")),r.writeStorage()})),this.$key.on("change",(function(e){r.setKey($(e.currentTarget).find("option:selected").val()),r.writeStorage()})),this.$wpmInteger.on("change",(function(e){r.setWPM(Math.round($(e.currentTarget).val())),r.$wpm.trigger("change")})),this.$fwpmInteger.on("change",(function(e){r.setFWPM(Math.round($(e.currentTarget).val())),r.$fwpm.trigger("change")}));var v=function(e){var t=e.target.value;t!=this.morse.morseCWWave.wpm&&(this.setWPM(t),this.setFWPM(t),this.$wpm.trigger("change"))};this.$sliderSpeedV.on("input change",v.bind(this)),this.$sliderSpeedH.on("input change",v.bind(this));var y=function(e){var t=e.target.value;t!=this.morse.morseCWWave.getFrequency()&&this.setFreq(t)};this.$sliderPitchV.on("input change",y.bind(this)),this.$sliderPitchH.on("input change",y.bind(this));var b=function(e){var t=e.target.value;t!=Math.round(100*this.morse.morsePlayer.volume)&&this.setVolume(t)};this.$sliderVolumeV.on("input change",b.bind(this)),this.$sliderVolumeH.on("input change",b.bind(this)),this.$enlarge.on("click",(function(){r.state.fullscreen=!0,r.$light.addClass("fullscreen"),r.$enlarge.hide(),r.$shrink.show()})),this.$shrink.on("click",(function(){r.state.fullscreen=!1,r.$light.removeClass("fullscreen"),r.$enlarge.show(),r.$shrink.hide()})),this.$shrink.hide(),this.$closeLight.on("click",(function(){r.setMorseLight(!1),r.writeStorage()})),this.$playMorseTest.on("click",(function(){i(r.$stopMorseTest),a(r.$playMorseTest);var t=Ye();t.loadText(yt);var n=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ht(Object(r),!0).forEach((function(t){dt(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ht(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},t.getSequence(!1));e.morsePlayer.stop(),e.cancellablePromise.rejectAllPromises("stop").then((function(){e.cancellablePromise.create("test",(function(t){e.morsePlayer.endPadding=0,e.morsePlayer.loop=!1,e.morsePlayer.play(n,{sequenceEndCallback:t})})).finally((function(){e.morsePlayer.restoreCallbacks(),i(r.$playMorseTest),a(r.$stopMorseTest)}))}))})),this.$stopMorseTest.on("click",(function(){n(r.$stopMorseTest)&&(e.morsePlayer.stop(),e.cancellablePromise.rejectAllPromises("stop"))})),$(document).on("opened.fndtn.reveal","#morseControlModal[data-reveal]",(function(){r.updateChart()})),$(window).on("keydown",(function(e){var t=document.activeElement.type;if("text"!==t&&"number"!==t&&!(e.altKey||e.ctrlKey||e.metaKey||"Enter"===e.key&&0===e.originalEvent.location))switch(e.key){case"Z":r.incrementWPM(-1);break;case"X":r.incrementWPM(1);break;case"z":r.incrementFWPM(-1);break;case"x":r.incrementFWPM(1);break;case"Escape":r.state.fullscreen&&r.$shrink.trigger("click")}}))}var s,l,c;return s=o,l=[{key:"setValues",value:function(){this.setMorseSound(this.readStorage("morseSound")),this.setMorseLight(this.readStorage("morseLight")),this.setMorseVibrate(this.readStorage("morseVibrate")),!0===this.readStorage("advancedSpeedMode")?(this.setDitLength(this.readStorage("baseLength")),this.setDahRatio(this.readStorage("dahRatio")),this.setDahLength(),this.setIntraCSratio(this.readStorage("intraCSratio")),this.setIntraCSlength(),this.setInterCSratio(this.readStorage("interCSratio")),this.setInterCSlength(),this.setInterWSratio(this.readStorage("interWSratio")),this.setInterWSlength(),this.setWPM(),this.setFWPM()):(this.setWPM(this.readStorage("wpm")),this.setFWPM(this.readStorage("fwpm"))),this.setEffectiveWPM(),this.setFreq(this.readStorage("frequency")),this.setVolume(this.readStorage("volume")),this.setStartPadding(this.readStorage("startPadding")),this.setDownloadEndPadding(this.readStorage("downloadEndPadding")),this.setPlayMode(this.readStorage("playMode")),this.setAdvancedSpeedMode(this.readStorage("advancedSpeedMode")),this.setKey(this.readStorage("key")),this.changeCallback()}},{key:"readStorage",value:function(e){return P({dictionary:Ct,key:e,cookie:"speed"})}},{key:"validate",value:function(e,t){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.dictionary,r=void 0===t?g:t,n=e.key,i=e.value,a=v[r][n].fallback;if(!isNaN(a))if(isNaN(i))i=a;else{var o=v[r][n].min;void 0!==o&&(i=Math.max(i,o));var s=v[r][n].max;void 0!==s&&(i=Math.min(i,s))}return i}({dictionary:Ct,key:e,value:t})}},{key:"testVibrate",value:function(){navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate;var e=navigator.userAgent.indexOf("Mobile")>-1;e&&console.log("Might be mobile"),void 0!==navigator.vibrate&&e?this.state.canVibrate=!0:(this.state.canVibrate=!1,console.log("Disabling vibration")),r(this.$useMorseVibrate,this.state.canVibrate)}},{key:"disablePlayMode",value:function(){this.setPlayMode("sine"),this.$playMode.parent().hide()}},{key:"setMorseSound",value:function(t){void 0===t&&(t=!0),this.state.morseSound=t,e(this.$useMorseSound,t),this.state.morseSound||this.state.morseLight||this.state.morseVibrate||this.setMorseLight(!0),this.morse.morsePlayer.muteAudio(!t)}},{key:"setMorseLight",value:function(t){void 0===t&&(t=!1),this.state.morseLight=t,e(this.$useMorseLight,t),t?this.$light.slideDown(400):this.$light.slideUp(400),this.state.morseSound||this.state.morseLight||this.state.morseVibrate||this.setMorseSound(!0)}},{key:"setMorseVibrate",value:function(t){void 0===t&&(t=!1),this.state.canVibrate||(t=!1),this.state.morseVibrate=t,e(this.$useMorseVibrate,t),this.state.morseSound||this.state.morseLight||this.state.morseVibrate||this.setMorseSound(!0),this.state.canVibrate&&navigator.vibrate(0)}},{key:"setWPM",value:function(e){if(void 0===e)this.setWPMfromModel();else{var t=xt(parseFloat(e));if(isNaN(t))this.setWPMfromModel();else{this.setWPMerror(!1);var r=this.morse.morseCWWave.wpm,n=parseFloat(this.$wpmInteger.val());t=this.morse.morseCWWave.setWPM(t),this.update(this.$wpm,t,r),this.update(this.$wpmInteger,Math.round(t),n),this.$sliderSpeedV.val(t),this.$sliderSpeedH.val(t),this.$sliderOutputSpeed.text(t)}}}},{key:"setWPMfromModel",value:function(){var e,t=parseFloat(this.$wpm.val()),r=parseFloat(this.$wpmInteger.val()),n=this.morse.morseCWWave.wpm;void 0===n?this.setWPMerror(!0):(this.setWPMerror(!1),n=xt(this.morse.morseCWWave.wpm),e=Math.round(n)),this.update(this.$wpm,n,t),this.update(this.$wpmInteger,e,r),this.$sliderSpeedV.val(n),this.$sliderSpeedH.val(n),this.$sliderOutputSpeed.text(n)}},{key:"setWPMerror",value:function(e){e?(this.$wpmError.show(),this.$wpm.attr("placeholder","---"),this.$wpmInteger.attr("placeholder","---")):(this.$wpmError.hide(),this.$wpm.attr("placeholder",""),this.$wpmInteger.attr("placeholder",""))}},{key:"incrementWPM",value:function(e){var t=this.morse.morseCWWave.wpm;void 0!==t&&(this.$wpm.val(xt(t+e)),this.$wpm.trigger("change"))}},{key:"setFWPM",value:function(e){if(void 0===e)this.setFWPMfromModel();else{var t=xt(parseFloat(e));if(isNaN(t))this.setFWPMfromModel();else{this.setFWPMerror(!1);var r=this.morse.morseCWWave.fwpm,n=parseFloat(this.$fwpmInteger.val());t=this.morse.morseCWWave.setFWPM(t),this.update(this.$fwpm,t,r),this.update(this.$fwpmInteger,Math.round(t),n)}}}},{key:"setFWPMfromModel",value:function(){var e,t=parseFloat(this.$fwpm.val()),r=parseFloat(this.$fwpmInteger.val()),n=this.morse.morseCWWave.fwpm;void 0===n?(this.setFWPMerror(!0),e=void 0):(this.setFWPMerror(!1),n=xt(this.morse.morseCWWave.fwpm),e=Math.round(n)),this.update(this.$fwpm,n,t),this.update(this.$fwpmInteger,e,r)}},{key:"setFWPMerror",value:function(e){e?(this.$fwpmError.show(),this.$fwpm.attr("placeholder","---"),this.$fwpmInteger.attr("placeholder","---")):(this.$fwpmError.hide(),this.$fwpm.attr("placeholder",""),this.$fwpmInteger.attr("placeholder",""))}},{key:"incrementFWPM",value:function(e){var t=this.morse.morseCWWave.fwpm;void 0!==t&&(this.$fwpm.val(xt(t+e)),this.$fwpm.trigger("change"))}},{key:"setFreq",value:function(e){var t=parseInt(e);return isNaN(t)?t=this.morse.morseCWWave.getFrequency():this.morse.morseCWWave.setFrequency(t),this.$freq.val(t),this.$sliderPitchV.val(t),this.$sliderPitchH.val(t),this.$sliderOutputPitch.text(t),t}},{key:"setVolume",value:function(e){var t=parseInt(e);return isNaN(t)?t=Math.round(100*this.morse.morsePlayer.volume):(t=Math.min(Math.max(0,t),100),this.morse.morsePlayer.volume=t/100),this.$volume.val(t),this.$sliderVolumeV.val(t),this.$sliderVolumeH.val(t),this.$sliderOutputVolume.text(t),t}},{key:"setDitLength",value:function(e){if(0!==this.$ditLength.length){var t=parseFloat(this.$ditLength.val()),r=parseFloat(e);return r=isNaN(r)?Math.round(this.morse.morseCWWave.lengths["."]):this.morse.morseCWWave.setLength(".",r),this.update(this.$ditLength,r,t),r}}},{key:"setDahRatio",value:function(e){if(0!==this.$dahRatio.length){var t=parseFloat(this.$dahRatio.val()),r=Math.abs(parseFloat(e));return r=isNaN(r)?xt(this.morse.morseCWWave.ratios["-"]):this.morse.morseCWWave.setRatio("-",r),this.update(this.$dahRatio,r,t),r}}},{key:"setDahLength",value:function(e){if(0!==this.$dahLength.length){var t=parseFloat(this.$dahLength.val()),r=parseFloat(e);return r=isNaN(r)?Math.round(this.morse.morseCWWave.lengths["-"]):this.morse.morseCWWave.setLength("-",r),this.update(this.$dahLength,r,t),r}}},{key:"setIntraCSratio",value:function(e){if(0!==this.$intraCSratio.length){var t=parseFloat(this.$intraCSratio.val()),r=-Math.abs(parseFloat(e));return isNaN(r)?r=xt(this.morse.morseCWWave.ratios[" "]):(r=this.morse.morseCWWave.setRatio(" ",r),this.morse.morseCWWave.setRatio("t",r),this.morse.morseCWWave.setRatio("d",r)),this.update(this.$intraCSratio,-r,t),r}}},{key:"setIntraCSlength",value:function(e){if(0!==this.$intraCSlength.length){var t=parseFloat(this.$intraCSlength.val()),r=-Math.abs(parseFloat(e));return isNaN(r)?r=Math.round(this.morse.morseCWWave.lengths[" "]):(r=this.morse.morseCWWave.setLength(" ",r),this.morse.morseCWWave.setLength("t",r),this.morse.morseCWWave.setLength("d",r)),this.update(this.$intraCSlength,-r,t),r}}},{key:"setInterCSratio",value:function(e){if(0!==this.$interCSratio.length){var t=parseFloat(this.$interCSratio.val()),r=-Math.abs(parseFloat(e));return r=isNaN(r)?xt(this.morse.morseCWWave.ratios[mt]):this.morse.morseCWWave.setRatio(mt,r),this.update(this.$interCSratio,-r,t),r}}},{key:"setInterCSlength",value:function(e){if(0!==this.$interCSlength.length){var t=parseFloat(this.$interCSlength.val()),r=-Math.abs(parseFloat(e));return r=isNaN(r)?Math.round(this.morse.morseCWWave.lengths[mt]):this.morse.morseCWWave.setLength(mt,r),this.update(this.$interCSlength,-r,t),r}}},{key:"setInterWSratio",value:function(e){if(0!==this.$interWSratio.length){var t=parseFloat(this.$interWSratio.val()),r=-Math.abs(parseFloat(e));return r=isNaN(r)?xt(this.morse.morseCWWave.ratios[gt]):this.morse.morseCWWave.setRatio(gt,r),this.update(this.$interWSratio,-r,t),r}}},{key:"setInterWSlength",value:function(e){if(0!==this.$interWSlength.length){var t=parseFloat(this.$interWSlength.val()),r=-Math.abs(parseFloat(e));return r=isNaN(r)?Math.round(this.morse.morseCWWave.lengths[gt]):this.morse.morseCWWave.setLength(gt,r),this.update(this.$interWSlength,-r,t),r}}},{key:"setEffectiveWPM",value:function(){this.$equivalentWPM.val(xt(this.morse.morseCWWave.effectiveWPM))}},{key:"setStartPadding",value:function(e){if(0!==this.$startPadding.length){var t=Math.abs(parseFloat(e));return isNaN(t)&&(t=this.morse.morsePlayer.startPadding),t=xt(t),this.$startPadding.val(t),this.morse.morsePlayer.startPadding=t,t}}},{key:"setDownloadEndPadding",value:function(e){if(0!==this.$downloadEndPadding.length){var t=Math.abs(parseFloat(e));return isNaN(t)&&(t=_t.downloadEndPadding.fallback),t=xt(t),this.$downloadEndPadding.val(t),this.state.downloadEndPadding=t,t}}},{key:"setPlayMode",value:function(e){if(0!==this.$playMode.length)return void 0===e&&(e=this.morse.morsePlayer.playMode),"sample"===e?(this.$freq.prop("disabled",!0),r(this.$useMorseLight,!1),this.$light.slideUp(400),r(this.$useMorseVibrate,!1),this.state.morseVibrate=!1,this.state.canVibrate&&navigator.vibrate(0)):(this.$freq.prop("disabled",!1),r(this.$useMorseLight,!0),this.state.canVibrate&&r(this.$useMorseVibrate,!0),this.setMorseLight(t(this.$useMorseLight)),this.setMorseVibrate(t(this.$useMorseVibrate))),this.$playMode.val(e),this.morse.morsePlayer.playMode=e,e}},{key:"setAdvancedSpeedMode",value:function(e){if(0!==this.$advancedSpeedSwitch.length){if(this.$advancedSpeedSwitch.prop("checked",e),this.state.advancedSpeedMode=e,e)this.setDitLength(),this.setDahRatio(),this.setDahLength(),this.setIntraCSratio(),this.setIntraCSlength(),this.setInterCSratio(),this.setInterCSlength(),this.setInterWSratio(),this.setInterWSlength(),this.setEffectiveWPM(),$("#advancedSpeed").slideDown();else{var t=this.morse.morseCWWave.effectiveCharacterWPM,r=this.morse.morseCWWave.effectiveWPM;this.setWPM(t),this.setFWPM(r),$("#advancedSpeed").slideUp()}return e}}},{key:"updateChart",value:function(){if(0!==$(At).length){var e=Ye();e.loadText(yt);for(var t=Math.abs(this.morse.morsePlayer.startPadding),r=e.timings,n=["x",0,t,t],i=["y",0,0,1],a=t,o=0,s=r.length;o<s;o++){var l=r[o];a+=Math.abs(l),n.push(a,a),l>0?i.push(1,0):i.push(0,1)}for(var c=908*(a+100)/5080,u=[],h={},d=0;d<bt.length;d++){var f=Math.round(n[4*bt[d]+2]);u.push(f),h[f]=c>800?St[d]+": ":""}var p="Time / ms";c>800&&(p="Letter: Time / ms"),c3.generate({bindto:At,transition:{duration:0},size:{height:150,width:c},data:{x:"x",columns:[n,i],types:{y:"area"},colors:{y:"#3e7f93"}},legend:{hide:!0},axis:{x:{tick:{values:u,format:function(e){return"".concat(h[e]).concat(e)}},min:0,height:50,padding:{left:50,right:50},label:{text:p,position:"outer-center"}},y:{show:!1}},point:{show:!1},tooltip:{show:!1}})}}},{key:"setKey",value:function(e){if(0!=this.$key.length){this.$key.val(e);var t=wt[e];for(var r in t)this.morse.morseCWWave.setVariation(r,{sysOffset:t[r][0],sysSlope:t[r][1],rndRange:t[r][2],rndSlope:t[r][3],stdDev:t[r][4]});this.state.key=e,this.writeStorage()}}},{key:"writeStorage",value:function(){var e={morseSound:this.state.morseSound,morseLight:this.state.morseLight,morseVibrate:this.state.morseVibrate,frequency:this.morse.morseCWWave.getFrequency(),volume:Math.round(100*this.morse.morsePlayer.volume),startPadding:this.morse.morsePlayer.startPadding,downloadEndPadding:this.state.downloadEndPadding,playMode:this.morse.morsePlayer.playMode,advancedSpeedMode:this.state.advancedSpeedMode,key:this.state.key};this.state.advancedSpeedMode?"international"===this.morse.morseCWWave.dictionary.id&&(e.baseLength=xt(this.morse.morseCWWave.baseLength),e.dahRatio=xt(this.morse.morseCWWave.ratios["-"]),e.intraCSratio=xt(this.morse.morseCWWave.ratios[" "]),e.interCSratio=xt(this.morse.morseCWWave.ratios[mt]),e.interWSratio=xt(this.morse.morseCWWave.ratios[gt])):(e.wpm=this.morse.morseCWWave.wpm,e.fwpm=this.morse.morseCWWave.fwpm),k({dictionary:Ct,value:e})&&(this.changeCallback(),this.updateChart())}},{key:"update",value:function(e,t,r){if(void 0!==e[0]){var n=e[0].id;void 0===r||isNaN(r)&&isNaN(t)||r==t||(e.removeClass(vt),void 0!==this.timers[n]&&(clearTimeout(this.timers[n]),this.timers[n]=void 0),setTimeout((function(){e.addClass(vt)}),5),this.timers[n]=setTimeout((function(){e.removeClass(vt)}),2005)),e.val(t)}}}],l&&ft(s.prototype,l),c&&ft(s,c),Object.defineProperty(s,"prototype",{writable:!1}),o}();function xt(e){return Math.round(100*e)/100}function Mt(e){return Mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Mt(e)}function Wt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Rt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Wt(Object(r),!0).forEach((function(t){$t(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Wt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function $t(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==Mt(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Mt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===Mt(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Ot=["2023-01-15: initial release."],Tt=$("#messageBox"),Lt=$("#live"),Nt=$("#live .played"),qt=$("#live .playing"),It=$("#live .unplayed"),Vt=$("#live .queued"),jt=$("#archive"),Ut=$("#config"),Ft=$(".reveal-modal.soundControl"),Dt=$("#stop"),Ht=$("#clear"),Bt=$("#keyboard"),Gt=$("#microphone"),Zt=$("#useInterim"),zt=$("#speechError"),Jt={messageText:"",messagePrevious:"",messageCurrent:"",speechFinal:"",useKeyboard:!1,unplayedIndex:0,playedIndex:0,playingIndex:0,error:[],noSpeechCounter:0};function Kt(){var e=$("<div/>");jt.append(e),e.append(Lt.html()),Nt.text(""),qt.text(""),Vt.text(""),It.text(""),Tt.scrollTop(1e9)}function Qt(t){e(Gt,t),r(Zt,!t),t?(Jt.speechFinal="",ar(),lt()):ot&&(console.log("Not listening to mic."),tt.abort(),ot=!1)}function Xt(t){Jt.useKeyboard=t,e(Bt,t),t||(Jt.messagePrevious=Jt.messageText,Jt.messageCurrent="")}function Yt(e){ar(),Jt.noSpeechCounter=0;for(var t="",r=0,n=e.length;r<n;r++){var i=e[r];i.isFinal?Jt.speechFinal+=i.text:t+=i.text}Jt.messageCurrent=Jt.speechFinal+t,Jt.messageText=Jt.messagePrevious+Jt.messageCurrent,It.text(Jt.messageText.substring(Jt.unplayedIndex)),Tt.scrollTop(1e9),er()}function er(){i(Dt),lr.morsePlayer.isScheduling||tr()}function tr(){var e=function(){if(Jt.messageText.length>Jt.unplayedIndex){var e=Jt.messageText[Jt.unplayedIndex],t=" "===e;return lr.morseMessage.loadText(t?"[ ]":e),lr.morseMessage.hasError&&(Jt.error[Jt.unplayedIndex]=!0),Vt.text(Vt.text()+e),It.text(It.text().substring(1)),Jt.unplayedIndex+=1,e}return null}();if(null!==e){if(lr.morseMessage.hasError)return rr(),void tr();var t=Rt({},lr.morseMessage.sequence),r=Math.abs(lr.morseCWWave.lengths["•"]);" "===e?t.timings[0]=t.timings[0]-r:(t.timings.push(-r),t.frequencies.push(0)),lr.morsePlayer.queue(t,!0)}}function rr(){var e=Jt.messageText[Jt.playingIndex];if(void 0!==e){var t=Jt.error[Jt.playingIndex];Jt.playingIndex+=1,qt.text(qt.text()+e),Vt.text(Vt.text().substring(1)),t&&nr()}}function nr(){var e=Jt.messageText[Jt.playedIndex];if(void 0!==e){var t=Jt.error[Jt.playedIndex];Jt.playedIndex+=1,t?Nt.append('<span class="errorChar">'.concat(e,"</span>")):Nt.append(e),qt.text(qt.text().substring(1))}}function ir(){a(Dt),Kt()}function ar(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];""===t?zt.text(""):(e=r?"warning":"speechError",zt.html('<span class="'.concat(e,'">').concat(t,"</span>")))}function or(e,t){var r,n=!1;switch(e){case"no-speech":n=!0,Jt.noSpeechCounter+=1,r="No speech can be heard",Jt.noSpeechCounter>3&&(r="The microphone was deactivated because nothing has been heard for a while",Qt(!1));break;case"aborted":case"service-not-allowed":case"bad-grammar":break;case"audio-capture":Qt(!1),r="No microphone can be found";break;case"network":Qt(!1),r=navigator.onLine?"You are online but there is no speech recognition service":"You need to be online for speech recognition to work";break;case"not-allowed-user-choice":case"not-allowed-ua-settings":Qt(!1),r="Please enable the microphone in your browser settings";break;case"language-not-supported":Qt(!1),r="Please choose a different speech recognition language"}void 0!==r&&ar(r,n)}function sr(e,t){!function(e){var t=e.model,r=e.apiLevel,n=e.soundDegradedCallback,i=e.startPadding,a=e.endPadding,o=e.sequenceStartCallback,s=e.sequenceSoundStartCallback,l=e.sequenceEndingCallback,c=e.sequenceSoundEndCallback,u=e.sequenceEndCallback,h=e.allStoppedCallback,d=e.soundOnCallback,f=e.soundOffCallback,p=e.onSample,m=e.offSample,g=e.playMode,v=e.dictionary,y=e.dictionaryOptions,b=e.wpm,S=e.fwpm,A=e.frequency,C=e.volume,_=e.sampleRate;Qe=t,t.morseCWWave=new Le({dictionary:v,dictionaryOptions:y,wpm:b,fwpm:S,frequency:A,sampleRate:_}),t.morseMessage=new B(t.morseCWWave),U.hasAudioContext&&r>3&&U.init(),U.hasAudioContext?t.morsePlayer=5===r?new Xe({defaultFrequency:A,startPadding:i,endPadding:a,volume:C,sequenceStartCallback:o,sequenceSoundStartCallback:s,sequenceEndingCallback:l,sequenceSoundEndCallback:c,sequenceEndCallback:u,allStoppedCallback:h,soundOnCallback:d,soundOffCallback:f,onSample:p,offSample:m,playMode:g}):new De({defaultFrequency:A,startPadding:i,endPadding:a,volume:C,sequenceStartCallback:o,sequenceSoundStartCallback:s,sequenceEndingCallback:l,sequenceSoundEndCallback:c,sequenceEndCallback:u,allStoppedCallback:h,onSample:p,offSample:m,playMode:g}):(console.log("No AudioContext available"),t.morsePlayer=new Ve({XAudioServerClass:XAudioServer,morseCWWave:t.morseCWWave,startPadding:i,endPadding:a,volume:C}),void 0!==n&&n()),console.log("Player type: "+t.morsePlayer.audioType),t.morsePlayer.audioType}(Rt({model:e,apiLevel:5,soundDegradedCallback:function(){$("button").addClass("ie")},sequenceEndingCallback:tr,sequenceStartCallback:rr,sequenceEndCallback:nr,allStoppedCallback:ir},t))}Gt.on("click",(function(){n($(this))&&(t(Gt)?Qt(!1):(Xt(!1),Qt(!0)))})),Zt.on("click",(function(){var e;n($(this))&&st("true"===(e=$(this)).attr("aria-pressed")?(e.attr("aria-pressed","false"),!1):(e.attr("aria-pressed","true"),!0))})),Bt.on("click",(function(){t(Bt)?Xt(!1):(Qt(!1),Xt(!0))})),Ut.on("click",(function(){Ft.foundation("reveal","open")})),Dt.on("click",(function(){n(Dt)&&(a(Dt),Kt(),lr.morsePlayer.stop(),lr.morsePlayer.clearAllTimings(),t(Gt)&&Qt(!1),Jt.messagePrevious=Jt.messageText,Jt.messageCurrent="",Jt.playedIndex=Jt.playingIndex=Jt.unplayedIndex=Jt.messagePrevious.length)})),Ht.on("click",(function(){Nt.text(""),qt.text(""),Vt.text(""),It.text(""),jt.text(""),t(Gt)&&Qt(!1),Jt.messageText=Jt.messagePrevious=Jt.messageCurrent="",Jt.playedIndex=Jt.playingIndex=Jt.unplayedIndex=0,Jt.error=[]})),$(window).on("keydown",(function(e){Jt.useKeyboard||Bt.trigger("click");var t=document.activeElement.type;"text"!==t&&"number"!==t&&"textarea"!==t&&(e.altKey||e.ctrlKey||e.metaKey||"Enter"===e.key&&0===e.originalEvent.location||1!==e.key.length&&"Backspace"!==e.key||(!function(e){"Backspace"===e?Jt.messageText.length>Jt.unplayedIndex&&(Jt.messageCurrent=Jt.messageCurrent.slice(0,-1)):Jt.messageCurrent+=e;Jt.messageText=Jt.messagePrevious+Jt.messageCurrent,It.text(Jt.messageText.substring(Jt.unplayedIndex)),Tt.scrollTop(1e9),er()}(e.key),e.preventDefault(),e.stopPropagation()))}));var lr=lr||{},cr={dictionary:"international",dictionaryOptions:["accents","tags"],freq:550,volume:.8,wpm:20,fwpm:20,playMode:"sine"},ur={};try{for(var hr in morseOptions,console.log("Using some page options"),morseOptions)cr[hr]=morseOptions[hr],ur[hr]=!0}catch(e){console.log("Using all defaults")}for(var dr in cr)console.log(dr+": "+cr[dr]+(ur[dr]?" *":""));$(document).ready((function(){L("machine",Ot,$("#changelog")),sr(lr,cr),lr.soundControl=new Et(lr,Jt,".soundControl"),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.speechCallback,r=e.errorCallback;if(window.SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition||null,null===window.SpeechRecognition)return console.log("No speech recognition available"),a(nt),!1;tt=new window.SpeechRecognition;var n=navigator.language;return ct(n=n.replace(/([\w\d]+-[\w\d]+).*/i,"$1")),st(!0),tt.onstart=function(e){rt=e.timeStamp},tt.onerror=function(e){var t;"not-allowed"==e.error&&(t=e.timeStamp-rt<100?"not-allowed-ua-settings":"not-allowed-user-choice"),r(void 0!==t?t:e.error,e.message)},et=t,!0}({speechCallback:Yt,errorCallback:or})||(ar("Speech recognition is not supported by this browser"),a(Zt)),Xt(!0),function(){var e=!0;2==lr.morsePlayer.audioType&&(e=!1),Jt.canPlay=!0,lr.morsePlayer.hasError()&&(a($play),a(Dt),Jt.canPlay=!1,console.log("Disabling sound playing"));var t="";e||(t+=localeMessages.quality),Jt.canPlay||(t+=localeMessages.function),t.length>0&&(t='<div class="row"><div class="large-12 columns"><div class="warning"><p class="first">'+localeMessages.warning+'</p><p class="last">'+t+localeMessages.alternatives+"</p></div></div></div>",$("#postWarning").before(t))}()}))}()})();